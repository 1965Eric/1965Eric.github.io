<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Section 2 - Linear Models Overview | Data Science Linear Regression</title>
  <meta name="description" content="3 Section 2 - Linear Models Overview | Data Science Linear Regression" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Section 2 - Linear Models Overview | Data Science Linear Regression" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Section 2 - Linear Models Overview | Data Science Linear Regression" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-1-introduction-to-regression-overview.html"/>
<link rel="next" href="section-3-confounding-overview.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="learning-objectives.html"><a href="learning-objectives.html"><i class="fa fa-check"></i><b>1</b> Learning Objectives</a>
<ul>
<li class="chapter" data-level="1.1" data-path="learning-objectives.html"><a href="learning-objectives.html#course-overview"><i class="fa fa-check"></i><b>1.1</b> Course Overview</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="learning-objectives.html"><a href="learning-objectives.html#introduction-to-linear-regression"><i class="fa fa-check"></i><b>1.1.1</b> Introduction to Linear Regression</a></li>
<li class="chapter" data-level="1.1.2" data-path="learning-objectives.html"><a href="learning-objectives.html#linear-models"><i class="fa fa-check"></i><b>1.1.2</b> Linear Models</a></li>
<li class="chapter" data-level="1.1.3" data-path="learning-objectives.html"><a href="learning-objectives.html#confounding"><i class="fa fa-check"></i><b>1.1.3</b> Confounding</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html"><i class="fa fa-check"></i><b>2</b> Section 1 - Introduction to Regression Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#motivating-example-moneyball"><i class="fa fa-check"></i><b>2.1</b> Motivating Example: Moneyball</a></li>
<li class="chapter" data-level="2.2" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#baseball-basics"><i class="fa fa-check"></i><b>2.2</b> Baseball basics</a></li>
<li class="chapter" data-level="2.3" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#bases-on-balls-or-stolen-bases"><i class="fa fa-check"></i><b>2.3</b> Bases on Balls or Stolen Bases?</a></li>
<li class="chapter" data-level="2.4" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#assessment---baseball-as-a-motivating-example"><i class="fa fa-check"></i><b>2.4</b> Assessment - Baseball as a Motivating Example</a></li>
<li class="chapter" data-level="2.5" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#correlation"><i class="fa fa-check"></i><b>2.5</b> Correlation</a></li>
<li class="chapter" data-level="2.6" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#correlation-coefficient"><i class="fa fa-check"></i><b>2.6</b> Correlation Coefficient</a></li>
<li class="chapter" data-level="2.7" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#sample-correlation-is-a-random-variable"><i class="fa fa-check"></i><b>2.7</b> Sample Correlation is a Random Variable</a></li>
<li class="chapter" data-level="2.8" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#assessment---correlation"><i class="fa fa-check"></i><b>2.8</b> Assessment - Correlation</a></li>
<li class="chapter" data-level="2.9" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#anscombes-quartetstratification"><i class="fa fa-check"></i><b>2.9</b> Anscombe’s Quartet/Stratification</a></li>
<li class="chapter" data-level="2.10" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#bivariate-normal-distribution"><i class="fa fa-check"></i><b>2.10</b> Bivariate Normal Distribution</a></li>
<li class="chapter" data-level="2.11" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#variance-explained"><i class="fa fa-check"></i><b>2.11</b> Variance Explained</a></li>
<li class="chapter" data-level="2.12" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#there-are-two-regression-lines"><i class="fa fa-check"></i><b>2.12</b> There are Two Regression Lines</a></li>
<li class="chapter" data-level="2.13" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#assessment---stratification-and-variance-explained-part-1"><i class="fa fa-check"></i><b>2.13</b> Assessment - Stratification and Variance Explained, Part 1</a></li>
<li class="chapter" data-level="2.14" data-path="section-1-introduction-to-regression-overview.html"><a href="section-1-introduction-to-regression-overview.html#assessment---stratification-and-variance-explained-part-2"><i class="fa fa-check"></i><b>2.14</b> Assessment - Stratification and Variance Explained, Part 2</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html"><i class="fa fa-check"></i><b>3</b> Section 2 - Linear Models Overview</a>
<ul>
<li class="chapter" data-level="3.1" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#confounding-are-bbs-more-predictive"><i class="fa fa-check"></i><b>3.1</b> Confounding: Are BBs More Predictive?</a></li>
<li class="chapter" data-level="3.2" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#stratification-and-multivariate-regression"><i class="fa fa-check"></i><b>3.2</b> Stratification and Multivariate Regression</a></li>
<li class="chapter" data-level="3.3" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#linear-models-1"><i class="fa fa-check"></i><b>3.3</b> Linear Models</a></li>
<li class="chapter" data-level="3.4" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#assessment-introduction-to-linear-models"><i class="fa fa-check"></i><b>3.4</b> Assessment: Introduction to Linear Models</a></li>
<li class="chapter" data-level="3.5" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#least-squares-estimates-lse"><i class="fa fa-check"></i><b>3.5</b> Least Squares Estimates (LSE)</a></li>
<li class="chapter" data-level="3.6" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#the-lm-function"><i class="fa fa-check"></i><b>3.6</b> The lm Function</a></li>
<li class="chapter" data-level="3.7" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#lse-are-random-variables"><i class="fa fa-check"></i><b>3.7</b> LSE are Random Variables</a></li>
<li class="chapter" data-level="3.8" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#advanced-note-on-lse"><i class="fa fa-check"></i><b>3.8</b> Advanced Note on LSE</a></li>
<li class="chapter" data-level="3.9" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#predicted-variables-are-random-variables"><i class="fa fa-check"></i><b>3.9</b> Predicted Variables are Random Variables</a></li>
<li class="chapter" data-level="3.10" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#assessment---least-squares-estimates-lse-part-1"><i class="fa fa-check"></i><b>3.10</b> Assessment - Least Squares Estimates (LSE), part 1</a></li>
<li class="chapter" data-level="3.11" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#assessment---least-squares-estimates-part-2"><i class="fa fa-check"></i><b>3.11</b> Assessment - Least Squares Estimates, part 2</a></li>
<li class="chapter" data-level="3.12" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#advanced-dplyr-tibbles"><i class="fa fa-check"></i><b>3.12</b> Advanced dplyr: Tibbles</a></li>
<li class="chapter" data-level="3.13" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#tibbles-differences-from-data-frames"><i class="fa fa-check"></i><b>3.13</b> Tibbles: Differences from Data Frames</a></li>
<li class="chapter" data-level="3.14" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#do"><i class="fa fa-check"></i><b>3.14</b> do</a></li>
<li class="chapter" data-level="3.15" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#broom"><i class="fa fa-check"></i><b>3.15</b> broom</a></li>
<li class="chapter" data-level="3.16" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#assessment---tibbles-do-and-broom-part-1"><i class="fa fa-check"></i><b>3.16</b> Assessment - Tibbles, do, and broom, part 1</a></li>
<li class="chapter" data-level="3.17" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#assessment---tibbles-do-and-broom-part-2"><i class="fa fa-check"></i><b>3.17</b> Assessment - Tibbles, do, and broom, part 2</a></li>
<li class="chapter" data-level="3.18" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#building-a-better-offensive-metric-for-baseball"><i class="fa fa-check"></i><b>3.18</b> Building a Better Offensive Metric for Baseball</a></li>
<li class="chapter" data-level="3.19" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#building-a-better-offensive-metric-for-baseball-linear-programming"><i class="fa fa-check"></i><b>3.19</b> Building a Better Offensive Metric for Baseball: Linear Programming</a></li>
<li class="chapter" data-level="3.20" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#on-base-plus-slugging-ops"><i class="fa fa-check"></i><b>3.20</b> On Base Plus Slugging (OPS)</a></li>
<li class="chapter" data-level="3.21" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#regression-fallacy"><i class="fa fa-check"></i><b>3.21</b> Regression Fallacy</a></li>
<li class="chapter" data-level="3.22" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#measurement-error-models"><i class="fa fa-check"></i><b>3.22</b> Measurement Error Models</a></li>
<li class="chapter" data-level="3.23" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#assessment---regression-and-baseball-part-1"><i class="fa fa-check"></i><b>3.23</b> Assessment - Regression and Baseball, part 1</a></li>
<li class="chapter" data-level="3.24" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#assessment---regression-and-baseball-part-2"><i class="fa fa-check"></i><b>3.24</b> Assessment - Regression and Baseball, part 2</a></li>
<li class="chapter" data-level="3.25" data-path="section-2-linear-models-overview.html"><a href="section-2-linear-models-overview.html#assessment---linear-models"><i class="fa fa-check"></i><b>3.25</b> Assessment - Linear Models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-3-confounding-overview.html"><a href="section-3-confounding-overview.html"><i class="fa fa-check"></i><b>4</b> Section 3 - Confounding Overview</a>
<ul>
<li class="chapter" data-level="4.1" data-path="section-3-confounding-overview.html"><a href="section-3-confounding-overview.html#correlation-is-not-causation-spurious-correlation"><i class="fa fa-check"></i><b>4.1</b> Correlation is Not Causation: Spurious Correlation</a></li>
<li class="chapter" data-level="4.2" data-path="section-3-confounding-overview.html"><a href="section-3-confounding-overview.html#correlation-is-not-causation-outliers"><i class="fa fa-check"></i><b>4.2</b> Correlation is Not Causation: Outliers</a></li>
<li class="chapter" data-level="4.3" data-path="section-3-confounding-overview.html"><a href="section-3-confounding-overview.html#correlation-is-not-causation-reversing-cause-and-effect"><i class="fa fa-check"></i><b>4.3</b> Correlation is Not Causation: Reversing Cause and Effect</a></li>
<li class="chapter" data-level="4.4" data-path="section-3-confounding-overview.html"><a href="section-3-confounding-overview.html#correlation-is-not-causation-confounders"><i class="fa fa-check"></i><b>4.4</b> Correlation is Not Causation: Confounders</a></li>
<li class="chapter" data-level="4.5" data-path="section-3-confounding-overview.html"><a href="section-3-confounding-overview.html#simpsons-paradox"><i class="fa fa-check"></i><b>4.5</b> Simpson’s Paradox</a></li>
<li class="chapter" data-level="4.6" data-path="section-3-confounding-overview.html"><a href="section-3-confounding-overview.html#assessment---correlation-is-not-causation"><i class="fa fa-check"></i><b>4.6</b> Assessment - Correlation is Not Causation</a></li>
<li class="chapter" data-level="4.7" data-path="section-3-confounding-overview.html"><a href="section-3-confounding-overview.html#assessment---confounding"><i class="fa fa-check"></i><b>4.7</b> Assessment - Confounding</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science Linear Regression</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-2---linear-models-overview" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Section 2 - Linear Models Overview</h1>
<p>In the <strong>Linear Models</strong> section, you will learn how to do linear regression.</p>
<p>After completing this section, you will be able to:</p>
<ul>
<li>Use <strong>multivariate regression</strong> to adjust for confounders.</li>
<li>Write <strong>linear models</strong> to describe the relationship between two or more variables.</li>
<li>Calculate the <strong>least squares estimates</strong> for a regression model using the <strong>lm</strong> function.</li>
<li>Understand the differences between <strong>tibbles</strong> and <strong>data frames</strong>.</li>
<li>Use the <code>do()</code> function to bridge R functions and the tidyverse.</li>
<li>Use the <code>tidy()</code>, <code>glance()</code>, and <code>augment()</code> functions from the <strong>broom</strong> package.</li>
<li>Apply linear regression to <strong>measurement error models</strong>.</li>
</ul>
<p>This section has four parts: <strong>Introduction to Linear Models, Least Squares Estimates, Tibbles, do, and broom</strong>, and <strong>Regression and Baseball</strong>.</p>
<div id="confounding-are-bbs-more-predictive" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Confounding: Are BBs More Predictive?</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/linear-models.html#confounding" target="_blank">here</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>Association is not causation!</li>
<li>Although it may appear that BB cause runs, it is actually the HR that cause most of these runs. We say that BB are <strong>confounded</strong> with HR.</li>
<li>Regression can help us account for confounding.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="section-2-linear-models-overview.html#cb78-1" aria-hidden="true"></a><span class="co"># find regression line for predicting runs from BBs</span></span>
<span id="cb78-2"><a href="section-2-linear-models-overview.html#cb78-2" aria-hidden="true"></a>bb_slope &lt;-<span class="st"> </span>Teams <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-3"><a href="section-2-linear-models-overview.html#cb78-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1961</span><span class="op">:</span><span class="dv">2001</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-4"><a href="section-2-linear-models-overview.html#cb78-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">BB_per_game =</span> BB<span class="op">/</span>G, <span class="dt">R_per_game =</span> R<span class="op">/</span>G) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-5"><a href="section-2-linear-models-overview.html#cb78-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">lm</span>(R_per_game <span class="op">~</span><span class="st"> </span>BB_per_game, <span class="dt">data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-6"><a href="section-2-linear-models-overview.html#cb78-6" aria-hidden="true"></a><span class="st">  </span>.<span class="op">$</span>coef <span class="op">%&gt;%</span></span>
<span id="cb78-7"><a href="section-2-linear-models-overview.html#cb78-7" aria-hidden="true"></a><span class="st">  </span>.[<span class="dv">2</span>]</span>
<span id="cb78-8"><a href="section-2-linear-models-overview.html#cb78-8" aria-hidden="true"></a>bb_slope</span></code></pre></div>
<pre><code>## BB_per_game 
##   0.7353288</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="section-2-linear-models-overview.html#cb80-1" aria-hidden="true"></a><span class="co"># compute regression line for predicting runs from singles</span></span>
<span id="cb80-2"><a href="section-2-linear-models-overview.html#cb80-2" aria-hidden="true"></a>singles_slope &lt;-<span class="st"> </span>Teams <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb80-3"><a href="section-2-linear-models-overview.html#cb80-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1961</span><span class="op">:</span><span class="dv">2001</span> ) <span class="op">%&gt;%</span></span>
<span id="cb80-4"><a href="section-2-linear-models-overview.html#cb80-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Singles_per_game =</span> (H<span class="op">-</span>HR<span class="op">-</span>X2B<span class="op">-</span>X3B)<span class="op">/</span>G, <span class="dt">R_per_game =</span> R<span class="op">/</span>G) <span class="op">%&gt;%</span></span>
<span id="cb80-5"><a href="section-2-linear-models-overview.html#cb80-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">lm</span>(R_per_game <span class="op">~</span><span class="st"> </span>Singles_per_game, <span class="dt">data =</span> .) <span class="op">%&gt;%</span></span>
<span id="cb80-6"><a href="section-2-linear-models-overview.html#cb80-6" aria-hidden="true"></a><span class="st">  </span>.<span class="op">$</span>coef  <span class="op">%&gt;%</span></span>
<span id="cb80-7"><a href="section-2-linear-models-overview.html#cb80-7" aria-hidden="true"></a><span class="st">  </span>.[<span class="dv">2</span>]</span>
<span id="cb80-8"><a href="section-2-linear-models-overview.html#cb80-8" aria-hidden="true"></a>singles_slope</span></code></pre></div>
<pre><code>## Singles_per_game 
##        0.4494253</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="section-2-linear-models-overview.html#cb82-1" aria-hidden="true"></a><span class="co"># calculate correlation between HR, BB and singles</span></span>
<span id="cb82-2"><a href="section-2-linear-models-overview.html#cb82-2" aria-hidden="true"></a>Teams <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-3"><a href="section-2-linear-models-overview.html#cb82-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1961</span><span class="op">:</span><span class="dv">2001</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-4"><a href="section-2-linear-models-overview.html#cb82-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Singles =</span> (H<span class="op">-</span>HR<span class="op">-</span>X2B<span class="op">-</span>X3B)<span class="op">/</span>G, <span class="dt">BB =</span> BB<span class="op">/</span>G, <span class="dt">HR =</span> HR<span class="op">/</span>G) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb82-5"><a href="section-2-linear-models-overview.html#cb82-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">cor</span>(BB, HR), <span class="kw">cor</span>(Singles, HR), <span class="kw">cor</span>(BB,Singles))</span></code></pre></div>
<pre><code>##   cor(BB, HR) cor(Singles, HR) cor(BB, Singles)
## 1   0.4039313       -0.1737435      -0.05603822</code></pre>
</div>
<div id="stratification-and-multivariate-regression" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Stratification and Multivariate Regression</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/linear-models.html#multivariate-regression" target="_blank">here</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>A first approach to check confounding is to keep HRs fixed at a certain value and then examine the relationship between BB and runs.</li>
<li>The slopes of BB after stratifying on HR are reduced, but they are not 0, which indicates that BB are helpful for producing runs, just not as much as previously thought.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="section-2-linear-models-overview.html#cb84-1" aria-hidden="true"></a><span class="co"># stratify HR per game to nearest 10, filter out strata with few points</span></span>
<span id="cb84-2"><a href="section-2-linear-models-overview.html#cb84-2" aria-hidden="true"></a>dat &lt;-<span class="st"> </span>Teams <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1961</span><span class="op">:</span><span class="dv">2001</span>) <span class="op">%&gt;%</span></span>
<span id="cb84-3"><a href="section-2-linear-models-overview.html#cb84-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">HR_strata =</span> <span class="kw">round</span>(HR<span class="op">/</span>G, <span class="dv">1</span>), </span>
<span id="cb84-4"><a href="section-2-linear-models-overview.html#cb84-4" aria-hidden="true"></a>         <span class="dt">BB_per_game =</span> BB <span class="op">/</span><span class="st"> </span>G,</span>
<span id="cb84-5"><a href="section-2-linear-models-overview.html#cb84-5" aria-hidden="true"></a>         <span class="dt">R_per_game =</span> R <span class="op">/</span><span class="st"> </span>G) <span class="op">%&gt;%</span></span>
<span id="cb84-6"><a href="section-2-linear-models-overview.html#cb84-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(HR_strata <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.4</span> <span class="op">&amp;</span><span class="st"> </span>HR_strata <span class="op">&lt;=</span><span class="fl">1.2</span>)</span>
<span id="cb84-7"><a href="section-2-linear-models-overview.html#cb84-7" aria-hidden="true"></a>  </span>
<span id="cb84-8"><a href="section-2-linear-models-overview.html#cb84-8" aria-hidden="true"></a><span class="co"># scatterplot for each HR stratum</span></span>
<span id="cb84-9"><a href="section-2-linear-models-overview.html#cb84-9" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb84-10"><a href="section-2-linear-models-overview.html#cb84-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(BB_per_game, R_per_game)) <span class="op">+</span><span class="st">  </span></span>
<span id="cb84-11"><a href="section-2-linear-models-overview.html#cb84-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb84-12"><a href="section-2-linear-models-overview.html#cb84-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="op">+</span></span>
<span id="cb84-13"><a href="section-2-linear-models-overview.html#cb84-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>HR_strata)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="img/figures/unnamed-chunk-34-1.png" width="672" /></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="section-2-linear-models-overview.html#cb86-1" aria-hidden="true"></a><span class="co"># calculate slope of regression line after stratifying by HR</span></span>
<span id="cb86-2"><a href="section-2-linear-models-overview.html#cb86-2" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb86-3"><a href="section-2-linear-models-overview.html#cb86-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(HR_strata) <span class="op">%&gt;%</span></span>
<span id="cb86-4"><a href="section-2-linear-models-overview.html#cb86-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">slope =</span> <span class="kw">cor</span>(BB_per_game, R_per_game)<span class="op">*</span><span class="kw">sd</span>(R_per_game)<span class="op">/</span><span class="kw">sd</span>(BB_per_game))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 9 x 2
##   HR_strata slope
##       &lt;dbl&gt; &lt;dbl&gt;
## 1       0.4 0.734
## 2       0.5 0.566
## 3       0.6 0.412
## 4       0.7 0.285
## 5       0.8 0.365
## 6       0.9 0.261
## 7       1   0.512
## 8       1.1 0.454
## 9       1.2 0.440</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="section-2-linear-models-overview.html#cb89-1" aria-hidden="true"></a><span class="co"># stratify by BB</span></span>
<span id="cb89-2"><a href="section-2-linear-models-overview.html#cb89-2" aria-hidden="true"></a>dat &lt;-<span class="st"> </span>Teams <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1961</span><span class="op">:</span><span class="dv">2001</span>) <span class="op">%&gt;%</span></span>
<span id="cb89-3"><a href="section-2-linear-models-overview.html#cb89-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">BB_strata =</span> <span class="kw">round</span>(BB<span class="op">/</span>G, <span class="dv">1</span>), </span>
<span id="cb89-4"><a href="section-2-linear-models-overview.html#cb89-4" aria-hidden="true"></a>         <span class="dt">HR_per_game =</span> HR <span class="op">/</span><span class="st"> </span>G,</span>
<span id="cb89-5"><a href="section-2-linear-models-overview.html#cb89-5" aria-hidden="true"></a>         <span class="dt">R_per_game =</span> R <span class="op">/</span><span class="st"> </span>G) <span class="op">%&gt;%</span></span>
<span id="cb89-6"><a href="section-2-linear-models-overview.html#cb89-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(BB_strata <span class="op">&gt;=</span><span class="st"> </span><span class="fl">2.8</span> <span class="op">&amp;</span><span class="st"> </span>BB_strata <span class="op">&lt;=</span><span class="fl">3.9</span>) </span>
<span id="cb89-7"><a href="section-2-linear-models-overview.html#cb89-7" aria-hidden="true"></a></span>
<span id="cb89-8"><a href="section-2-linear-models-overview.html#cb89-8" aria-hidden="true"></a><span class="co"># scatterplot for each BB stratum</span></span>
<span id="cb89-9"><a href="section-2-linear-models-overview.html#cb89-9" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(HR_per_game, R_per_game)) <span class="op">+</span><span class="st">  </span></span>
<span id="cb89-10"><a href="section-2-linear-models-overview.html#cb89-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb89-11"><a href="section-2-linear-models-overview.html#cb89-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="op">+</span></span>
<span id="cb89-12"><a href="section-2-linear-models-overview.html#cb89-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>BB_strata)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="img/figures/unnamed-chunk-34-2.png" width="672" /></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="section-2-linear-models-overview.html#cb91-1" aria-hidden="true"></a><span class="co"># slope of regression line after stratifying by BB</span></span>
<span id="cb91-2"><a href="section-2-linear-models-overview.html#cb91-2" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb91-3"><a href="section-2-linear-models-overview.html#cb91-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(BB_strata) <span class="op">%&gt;%</span></span>
<span id="cb91-4"><a href="section-2-linear-models-overview.html#cb91-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">slope =</span> <span class="kw">cor</span>(HR_per_game, R_per_game)<span class="op">*</span><span class="kw">sd</span>(R_per_game)<span class="op">/</span><span class="kw">sd</span>(HR_per_game))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 12 x 2
##    BB_strata slope
##        &lt;dbl&gt; &lt;dbl&gt;
##  1       2.8  1.52
##  2       2.9  1.57
##  3       3    1.52
##  4       3.1  1.49
##  5       3.2  1.58
##  6       3.3  1.56
##  7       3.4  1.48
##  8       3.5  1.63
##  9       3.6  1.83
## 10       3.7  1.45
## 11       3.8  1.70
## 12       3.9  1.30</code></pre>
</div>
<div id="linear-models-1" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Linear Models</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/linear-models.html#lse" target="_blank">here</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>“Linear” here does not refer to lines, but rather to the fact that the conditional expectation is a linear combination of known quantities.</li>
<li>In Galton’s model, we assume <span class="math inline">\(Y\)</span> (son’s height) is a linear combination of a constant and <span class="math inline">\(X\)</span> (father’s height) plus random noise. We further assume that <span class="math inline">\(\epsilon_i\)</span> are independent from each other, have expected value 0 and the standard deviation <span class="math inline">\(\sigma\)</span> which does not depend on i.</li>
<li>Note that if we further assume that <span class="math inline">\(\epsilon\)</span> is normally distributed, then the model is exactly the same one we derived earlier by assuming bivariate normal data.</li>
<li>We can subtract the mean from <span class="math inline">\(X\)</span> to make <span class="math inline">\(\beta_0\)</span> more interpretable.</li>
</ul>
</div>
<div id="assessment-introduction-to-linear-models" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Assessment: Introduction to Linear Models</h2>
<ol style="list-style-type: decimal">
<li>When we stratified our regression lines for runs per game vs. bases on balls by the number of home runs, what happened?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. The slope of runs per game vs. bases on balls within each stratum was reduced because we removed confounding by home runs.</li>
<li><input type="checkbox" disabled="" />
B. The slope of runs per game vs. bases on balls within each stratum was reduced because there were fewer data points.</li>
<li><input type="checkbox" disabled="" />
C. The slope of runs per game vs. bases on balls within each stratum increased after we removed confounding by home runs.</li>
<li><input type="checkbox" disabled="" />
D. The slope of runs per game vs. bases on balls within each stratum stayed about the same as the original slope.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>We run a linear model for sons’ heights vs. fathers’ heights using the Galton height data, and get the following results:</li>
</ol>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="section-2-linear-models-overview.html#cb94-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">lm</span>(son <span class="op">~</span><span class="st"> </span>father, <span class="dt">data =</span> galton_heights)</span>
<span id="cb94-2"><a href="section-2-linear-models-overview.html#cb94-2" aria-hidden="true"></a></span>
<span id="cb94-3"><a href="section-2-linear-models-overview.html#cb94-3" aria-hidden="true"></a>Call<span class="op">:</span></span>
<span id="cb94-4"><a href="section-2-linear-models-overview.html#cb94-4" aria-hidden="true"></a><span class="kw">lm</span>(<span class="dt">formula =</span> son <span class="op">~</span><span class="st"> </span>father, <span class="dt">data =</span> galton_heights)</span>
<span id="cb94-5"><a href="section-2-linear-models-overview.html#cb94-5" aria-hidden="true"></a></span>
<span id="cb94-6"><a href="section-2-linear-models-overview.html#cb94-6" aria-hidden="true"></a>Coefficients<span class="op">:</span></span>
<span id="cb94-7"><a href="section-2-linear-models-overview.html#cb94-7" aria-hidden="true"></a>(Intercept)    father  </span>
<span id="cb94-8"><a href="section-2-linear-models-overview.html#cb94-8" aria-hidden="true"></a>    <span class="fl">35.71</span>       <span class="fl">0.50</span>  </span></code></pre></div>
<p>Interpret the numeric coefficient for “father.”</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. For every inch we increase the son’s height, the predicted father’s height increases by 0.5 inches.</li>
<li><input type="checkbox" disabled="" checked="" />
B. For every inch we increase the father’s height, the predicted son’s height grows by 0.5 inches.</li>
<li><input type="checkbox" disabled="" />
C. For every inch we increase the father’s height, the predicted son’s height is 0.5 times greater.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>We want the intercept term for our model to be more interpretable, so we run the same model as before but now we subtract the mean of fathers’ heights from each individual father’s height to create a new variable centered at zero.</li>
</ol>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="section-2-linear-models-overview.html#cb95-1" aria-hidden="true"></a>galton_heights &lt;-<span class="st"> </span>galton_heights <span class="op">%&gt;%</span></span>
<span id="cb95-2"><a href="section-2-linear-models-overview.html#cb95-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">father_centered=</span>father <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(father))</span></code></pre></div>
<p>We run a linear model using this centered fathers’ height variable.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="section-2-linear-models-overview.html#cb96-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">lm</span>(son <span class="op">~</span><span class="st"> </span>father_centered, <span class="dt">data =</span> galton_heights)</span>
<span id="cb96-2"><a href="section-2-linear-models-overview.html#cb96-2" aria-hidden="true"></a></span>
<span id="cb96-3"><a href="section-2-linear-models-overview.html#cb96-3" aria-hidden="true"></a>Call<span class="op">:</span></span>
<span id="cb96-4"><a href="section-2-linear-models-overview.html#cb96-4" aria-hidden="true"></a><span class="kw">lm</span>(<span class="dt">formula =</span> son <span class="op">~</span><span class="st"> </span>father_centered, <span class="dt">data =</span> galton_heights)</span>
<span id="cb96-5"><a href="section-2-linear-models-overview.html#cb96-5" aria-hidden="true"></a></span>
<span id="cb96-6"><a href="section-2-linear-models-overview.html#cb96-6" aria-hidden="true"></a>Coefficients<span class="op">:</span></span>
<span id="cb96-7"><a href="section-2-linear-models-overview.html#cb96-7" aria-hidden="true"></a>(Intercept)    father_centered  </span>
<span id="cb96-8"><a href="section-2-linear-models-overview.html#cb96-8" aria-hidden="true"></a>    <span class="fl">70.45</span>          <span class="fl">0.50</span>  </span></code></pre></div>
<p>Interpret the numeric coefficient for the intercept.</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. The height of a son of a father of average height is 70.45 inches.</li>
<li><input type="checkbox" disabled="" />
B. The height of a son when a father’s height is zero is 70.45 inches.</li>
<li><input type="checkbox" disabled="" />
C. The height of an average father is 70.45 inches.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Suppose we fit a multivariate regression model for expected runs based on BB and HR:</li>
</ol>
<p><span class="math inline">\(E[R|BB=x_1, HR=x_2] = \beta_0+\beta_1x_1+\beta_2x_2\)</span></p>
<p>Suppose we fix <span class="math inline">\(BB = x_1\)</span>. Then we observe a linear relationship between runs and HR with intercept of:</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. <span class="math inline">\(\beta_0\)</span></li>
<li><input type="checkbox" disabled="" />
B. <span class="math inline">\(\beta_0 + \beta_2x_2\)</span></li>
<li><input type="checkbox" disabled="" checked="" />
C. <span class="math inline">\(\beta_0 + \beta_1x_1\)</span></li>
<li><input type="checkbox" disabled="" />
D. <span class="math inline">\(\beta_0 + \beta_2x_1\)</span></li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>Which of the following are assumptions for the errors <span class="math inline">\(\epsilon_i\)</span> in a linear regression model?
Check ALL correct answers.</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. The <span class="math inline">\(\epsilon_i\)</span> are independent of each other</li>
<li><input type="checkbox" disabled="" checked="" />
B. The <span class="math inline">\(\epsilon_i\)</span> have expected value 0</li>
<li><input type="checkbox" disabled="" checked="" />
C. The variance of <span class="math inline">\(\epsilon_i\)</span> is a constant</li>
</ul>
</div>
<div id="least-squares-estimates-lse" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Least Squares Estimates (LSE)</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/linear-models.html#lse" target="_blank">here</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>For regression, we aim to find the coefficient values that minimize the distance of the fitted model to the data.</li>
<li>Residual sum of squares (RSS) measures the distance between the true value and the predicted value given by the regression line. The values that minimize the RSS are called the least squares estimates (LSE).</li>
<li>We can use partial derivatives to get the values for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> in Galton’s data.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="section-2-linear-models-overview.html#cb97-1" aria-hidden="true"></a><span class="co"># compute RSS for any pair of beta0 and beta1 in Galton&#39;s data</span></span>
<span id="cb97-2"><a href="section-2-linear-models-overview.html#cb97-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1983</span>)</span>
<span id="cb97-3"><a href="section-2-linear-models-overview.html#cb97-3" aria-hidden="true"></a>galton_heights &lt;-<span class="st"> </span>GaltonFamilies <span class="op">%&gt;%</span></span>
<span id="cb97-4"><a href="section-2-linear-models-overview.html#cb97-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;male&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb97-5"><a href="section-2-linear-models-overview.html#cb97-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(family) <span class="op">%&gt;%</span></span>
<span id="cb97-6"><a href="section-2-linear-models-overview.html#cb97-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb97-7"><a href="section-2-linear-models-overview.html#cb97-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb97-8"><a href="section-2-linear-models-overview.html#cb97-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(father, childHeight) <span class="op">%&gt;%</span></span>
<span id="cb97-9"><a href="section-2-linear-models-overview.html#cb97-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">son =</span> childHeight)</span>
<span id="cb97-10"><a href="section-2-linear-models-overview.html#cb97-10" aria-hidden="true"></a>rss &lt;-<span class="st"> </span><span class="cf">function</span>(beta0, beta1, data){</span>
<span id="cb97-11"><a href="section-2-linear-models-overview.html#cb97-11" aria-hidden="true"></a>    resid &lt;-<span class="st"> </span>galton_heights<span class="op">$</span>son <span class="op">-</span><span class="st"> </span>(beta0<span class="op">+</span>beta1<span class="op">*</span>galton_heights<span class="op">$</span>father)</span>
<span id="cb97-12"><a href="section-2-linear-models-overview.html#cb97-12" aria-hidden="true"></a>    <span class="kw">return</span>(<span class="kw">sum</span>(resid<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb97-13"><a href="section-2-linear-models-overview.html#cb97-13" aria-hidden="true"></a>}</span>
<span id="cb97-14"><a href="section-2-linear-models-overview.html#cb97-14" aria-hidden="true"></a></span>
<span id="cb97-15"><a href="section-2-linear-models-overview.html#cb97-15" aria-hidden="true"></a><span class="co"># plot RSS as a function of beta1 when beta0=25</span></span>
<span id="cb97-16"><a href="section-2-linear-models-overview.html#cb97-16" aria-hidden="true"></a>beta1 =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">len=</span><span class="kw">nrow</span>(galton_heights))</span>
<span id="cb97-17"><a href="section-2-linear-models-overview.html#cb97-17" aria-hidden="true"></a>results &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">beta1 =</span> beta1,</span>
<span id="cb97-18"><a href="section-2-linear-models-overview.html#cb97-18" aria-hidden="true"></a>                      <span class="dt">rss =</span> <span class="kw">sapply</span>(beta1, rss, <span class="dt">beta0 =</span> <span class="dv">25</span>))</span>
<span id="cb97-19"><a href="section-2-linear-models-overview.html#cb97-19" aria-hidden="true"></a>results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(beta1, rss)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb97-20"><a href="section-2-linear-models-overview.html#cb97-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(beta1, rss))</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-38-1.png" width="672" /></p>
</div>
<div id="the-lm-function" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> The lm Function</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/linear-models.html#the-lm-function" target="_blank">here</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>When calling the <code>lm()</code> function, the variable that we want to predict is put to the left of the <code>~</code> symbol, and the variables that we use to predict is put to the right of the <code>~</code> symbol. The intercept is added automatically.</li>
<li>LSEs are random variables.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="section-2-linear-models-overview.html#cb98-1" aria-hidden="true"></a><span class="co"># fit regression line to predict son&#39;s height from father&#39;s height</span></span>
<span id="cb98-2"><a href="section-2-linear-models-overview.html#cb98-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">lm</span>(son <span class="op">~</span><span class="st"> </span>father, <span class="dt">data =</span> galton_heights)</span>
<span id="cb98-3"><a href="section-2-linear-models-overview.html#cb98-3" aria-hidden="true"></a>fit</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = son ~ father, data = galton_heights)
## 
## Coefficients:
## (Intercept)       father  
##     38.7646       0.4411</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="section-2-linear-models-overview.html#cb100-1" aria-hidden="true"></a><span class="co"># summary statistics</span></span>
<span id="cb100-2"><a href="section-2-linear-models-overview.html#cb100-2" aria-hidden="true"></a><span class="kw">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = son ~ father, data = galton_heights)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -9.4228 -1.7022  0.0333  1.5670  9.3567 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 38.76457    5.41093   7.164 2.03e-11 ***
## father       0.44112    0.07825   5.637 6.72e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.659 on 177 degrees of freedom
## Multiple R-squared:  0.1522, Adjusted R-squared:  0.1474 
## F-statistic: 31.78 on 1 and 177 DF,  p-value: 6.719e-08</code></pre>
</div>
<div id="lse-are-random-variables" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> LSE are Random Variables</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/linear-models.html#lse-are-random-variables" target="_blank">here</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>Because they are derived from the samples, LSE are random variables.</li>
<li><span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> appear to be normally distributed because the central limit theorem plays a role.</li>
<li>The t-statistic depends on the assumption that <span class="math inline">\(\epsilon\)</span> follows a normal distribution.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="section-2-linear-models-overview.html#cb102-1" aria-hidden="true"></a><span class="co"># Monte Carlo simulation</span></span>
<span id="cb102-2"><a href="section-2-linear-models-overview.html#cb102-2" aria-hidden="true"></a>B &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb102-3"><a href="section-2-linear-models-overview.html#cb102-3" aria-hidden="true"></a>N &lt;-<span class="st"> </span><span class="dv">50</span></span>
<span id="cb102-4"><a href="section-2-linear-models-overview.html#cb102-4" aria-hidden="true"></a>lse &lt;-<span class="st"> </span><span class="kw">replicate</span>(B, {</span>
<span id="cb102-5"><a href="section-2-linear-models-overview.html#cb102-5" aria-hidden="true"></a>  <span class="kw">sample_n</span>(galton_heights, N, <span class="dt">replace =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-6"><a href="section-2-linear-models-overview.html#cb102-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">lm</span>(son <span class="op">~</span><span class="st"> </span>father, <span class="dt">data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-7"><a href="section-2-linear-models-overview.html#cb102-7" aria-hidden="true"></a><span class="st">    </span>.<span class="op">$</span>coef </span>
<span id="cb102-8"><a href="section-2-linear-models-overview.html#cb102-8" aria-hidden="true"></a>})</span>
<span id="cb102-9"><a href="section-2-linear-models-overview.html#cb102-9" aria-hidden="true"></a>lse &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">beta_0 =</span> lse[<span class="dv">1</span>,], <span class="dt">beta_1 =</span> lse[<span class="dv">2</span>,]) </span>
<span id="cb102-10"><a href="section-2-linear-models-overview.html#cb102-10" aria-hidden="true"></a></span>
<span id="cb102-11"><a href="section-2-linear-models-overview.html#cb102-11" aria-hidden="true"></a><span class="co"># Plot the distribution of beta_0 and beta_1</span></span>
<span id="cb102-12"><a href="section-2-linear-models-overview.html#cb102-12" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(gridExtra)) <span class="kw">install.packages</span>(<span class="st">&quot;gridExtra&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: gridExtra</code></pre>
<pre><code>## 
## Attaching package: &#39;gridExtra&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     combine</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="section-2-linear-models-overview.html#cb106-1" aria-hidden="true"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb106-2"><a href="section-2-linear-models-overview.html#cb106-2" aria-hidden="true"></a>p1 &lt;-<span class="st"> </span>lse <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(beta_<span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">5</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) </span>
<span id="cb106-3"><a href="section-2-linear-models-overview.html#cb106-3" aria-hidden="true"></a>p2 &lt;-<span class="st"> </span>lse <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(beta_<span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.1</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) </span>
<span id="cb106-4"><a href="section-2-linear-models-overview.html#cb106-4" aria-hidden="true"></a><span class="kw">grid.arrange</span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-40-1.png" width="672" /></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="section-2-linear-models-overview.html#cb107-1" aria-hidden="true"></a><span class="co"># summary statistics</span></span>
<span id="cb107-2"><a href="section-2-linear-models-overview.html#cb107-2" aria-hidden="true"></a><span class="kw">sample_n</span>(galton_heights, N, <span class="dt">replace =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb107-3"><a href="section-2-linear-models-overview.html#cb107-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">lm</span>(son <span class="op">~</span><span class="st"> </span>father, <span class="dt">data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb107-4"><a href="section-2-linear-models-overview.html#cb107-4" aria-hidden="true"></a><span class="st">  </span>summary <span class="op">%&gt;%</span></span>
<span id="cb107-5"><a href="section-2-linear-models-overview.html#cb107-5" aria-hidden="true"></a><span class="st">  </span>.<span class="op">$</span>coef</span></code></pre></div>
<pre><code>##               Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 34.4729422  8.6021831 4.007464 0.0002129225
## father       0.4990193  0.1240572 4.022493 0.0002030210</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="section-2-linear-models-overview.html#cb109-1" aria-hidden="true"></a>lse <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">se_0 =</span> <span class="kw">sd</span>(beta_<span class="dv">0</span>), <span class="dt">se_1 =</span> <span class="kw">sd</span>(beta_<span class="dv">1</span>))</span></code></pre></div>
<pre><code>##       se_0      se_1
## 1 9.683973 0.1411404</code></pre>
</div>
<div id="advanced-note-on-lse" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Advanced Note on LSE</h2>
<p>Although interpretation is not straight-forward, it is also useful to know that the LSE can be strongly correlated, which can be seen using this code:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="section-2-linear-models-overview.html#cb111-1" aria-hidden="true"></a>lse <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="kw">cor</span>(beta_<span class="dv">0</span>, beta_<span class="dv">1</span>))</span></code></pre></div>
<pre><code>##   cor(beta_0, beta_1)
## 1          -0.9993386</code></pre>
<p>However, the correlation depends on how the predictors are defined or transformed.</p>
<p>Here we standardize the father heights, which changes <span class="math inline">\(x_i\)</span> to <span class="math inline">\(x_i - \bar{x}\)</span>.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="section-2-linear-models-overview.html#cb113-1" aria-hidden="true"></a>B &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb113-2"><a href="section-2-linear-models-overview.html#cb113-2" aria-hidden="true"></a>N &lt;-<span class="st"> </span><span class="dv">50</span></span>
<span id="cb113-3"><a href="section-2-linear-models-overview.html#cb113-3" aria-hidden="true"></a>lse &lt;-<span class="st"> </span><span class="kw">replicate</span>(B, {</span>
<span id="cb113-4"><a href="section-2-linear-models-overview.html#cb113-4" aria-hidden="true"></a>      <span class="kw">sample_n</span>(galton_heights, N, <span class="dt">replace =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb113-5"><a href="section-2-linear-models-overview.html#cb113-5" aria-hidden="true"></a><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">father =</span> father <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(father)) <span class="op">%&gt;%</span></span>
<span id="cb113-6"><a href="section-2-linear-models-overview.html#cb113-6" aria-hidden="true"></a><span class="st">      </span><span class="kw">lm</span>(son <span class="op">~</span><span class="st"> </span>father, <span class="dt">data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span>.<span class="op">$</span>coef </span>
<span id="cb113-7"><a href="section-2-linear-models-overview.html#cb113-7" aria-hidden="true"></a>})</span></code></pre></div>
<p>Observe what happens to the correlation in this case:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="section-2-linear-models-overview.html#cb114-1" aria-hidden="true"></a><span class="kw">cor</span>(lse[<span class="dv">1</span>,], lse[<span class="dv">2</span>,]) </span></code></pre></div>
<pre><code>## [1] 0.1100929</code></pre>
</div>
<div id="predicted-variables-are-random-variables" class="section level2" number="3.9">
<h2><span class="header-section-number">3.9</span> Predicted Variables are Random Variables</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/linear-models.html#predicted-values-are-random-variables" target="_blank">here</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>The predicted value is often denoted as <span class="math inline">\(\hat{Y}\)</span>, which is a random variable. Mathematical theory tells us what the standard error of the predicted value is.</li>
<li>The <code>predict()</code> function in R can give us predictions directly.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="section-2-linear-models-overview.html#cb116-1" aria-hidden="true"></a><span class="co"># plot predictions and confidence intervals</span></span>
<span id="cb116-2"><a href="section-2-linear-models-overview.html#cb116-2" aria-hidden="true"></a>galton_heights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(son, father)) <span class="op">+</span></span>
<span id="cb116-3"><a href="section-2-linear-models-overview.html#cb116-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb116-4"><a href="section-2-linear-models-overview.html#cb116-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="img/figures/unnamed-chunk-44-1.png" width="672" /></p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="section-2-linear-models-overview.html#cb118-1" aria-hidden="true"></a><span class="co"># predict Y directly</span></span>
<span id="cb118-2"><a href="section-2-linear-models-overview.html#cb118-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span>galton_heights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">lm</span>(son <span class="op">~</span><span class="st"> </span>father, <span class="dt">data =</span> .) </span>
<span id="cb118-3"><a href="section-2-linear-models-overview.html#cb118-3" aria-hidden="true"></a>Y_hat &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)</span>
<span id="cb118-4"><a href="section-2-linear-models-overview.html#cb118-4" aria-hidden="true"></a><span class="kw">names</span>(Y_hat)</span></code></pre></div>
<pre><code>## [1] &quot;fit&quot;            &quot;se.fit&quot;         &quot;df&quot;             &quot;residual.scale&quot;</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="section-2-linear-models-overview.html#cb120-1" aria-hidden="true"></a><span class="co"># plot best fit line</span></span>
<span id="cb120-2"><a href="section-2-linear-models-overview.html#cb120-2" aria-hidden="true"></a>galton_heights <span class="op">%&gt;%</span></span>
<span id="cb120-3"><a href="section-2-linear-models-overview.html#cb120-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Y_hat =</span> <span class="kw">predict</span>(<span class="kw">lm</span>(son <span class="op">~</span><span class="st"> </span>father, <span class="dt">data=</span>.))) <span class="op">%&gt;%</span></span>
<span id="cb120-4"><a href="section-2-linear-models-overview.html#cb120-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(father, Y_hat))<span class="op">+</span></span>
<span id="cb120-5"><a href="section-2-linear-models-overview.html#cb120-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-44-2.png" width="672" /></p>
</div>
<div id="assessment---least-squares-estimates-lse-part-1" class="section level2" number="3.10">
<h2><span class="header-section-number">3.10</span> Assessment - Least Squares Estimates (LSE), part 1</h2>
<ol style="list-style-type: decimal">
<li>The following code was used in the video to plot RSS with <span class="math inline">\(\beta_0=25\)</span>.</li>
</ol>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="section-2-linear-models-overview.html#cb121-1" aria-hidden="true"></a>beta1 =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">len=</span><span class="kw">nrow</span>(galton_heights))</span>
<span id="cb121-2"><a href="section-2-linear-models-overview.html#cb121-2" aria-hidden="true"></a>results &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">beta1 =</span> beta1,</span>
<span id="cb121-3"><a href="section-2-linear-models-overview.html#cb121-3" aria-hidden="true"></a>                      <span class="dt">rss =</span> <span class="kw">sapply</span>(beta1, rss, <span class="dt">beta0 =</span> <span class="dv">25</span>))</span>
<span id="cb121-4"><a href="section-2-linear-models-overview.html#cb121-4" aria-hidden="true"></a>results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(beta1, rss)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb121-5"><a href="section-2-linear-models-overview.html#cb121-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(beta1, rss), <span class="dt">col=</span><span class="dv">2</span>)</span></code></pre></div>
<p>In a model for sons’ heights vs fathers’ heights, what is the least squares estimate (LSE) for <span class="math inline">\(\beta_1\)</span> if we assume <span class="math inline">\(\hat{\beta}_{0}\)</span> is 36? Hint: modify the code above to do your analysis.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="section-2-linear-models-overview.html#cb122-1" aria-hidden="true"></a><span class="co"># compute RSS for any pair of beta0 and beta1 in Galton&#39;s data</span></span>
<span id="cb122-2"><a href="section-2-linear-models-overview.html#cb122-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1983</span>)</span>
<span id="cb122-3"><a href="section-2-linear-models-overview.html#cb122-3" aria-hidden="true"></a>galton_heights &lt;-<span class="st"> </span>GaltonFamilies <span class="op">%&gt;%</span></span>
<span id="cb122-4"><a href="section-2-linear-models-overview.html#cb122-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;male&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb122-5"><a href="section-2-linear-models-overview.html#cb122-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(family) <span class="op">%&gt;%</span></span>
<span id="cb122-6"><a href="section-2-linear-models-overview.html#cb122-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb122-7"><a href="section-2-linear-models-overview.html#cb122-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb122-8"><a href="section-2-linear-models-overview.html#cb122-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(father, childHeight) <span class="op">%&gt;%</span></span>
<span id="cb122-9"><a href="section-2-linear-models-overview.html#cb122-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">son =</span> childHeight)</span>
<span id="cb122-10"><a href="section-2-linear-models-overview.html#cb122-10" aria-hidden="true"></a>rss &lt;-<span class="st"> </span><span class="cf">function</span>(beta0, beta1, data){</span>
<span id="cb122-11"><a href="section-2-linear-models-overview.html#cb122-11" aria-hidden="true"></a>    resid &lt;-<span class="st"> </span>galton_heights<span class="op">$</span>son <span class="op">-</span><span class="st"> </span>(beta0<span class="op">+</span>beta1<span class="op">*</span>galton_heights<span class="op">$</span>father)</span>
<span id="cb122-12"><a href="section-2-linear-models-overview.html#cb122-12" aria-hidden="true"></a>    <span class="kw">return</span>(<span class="kw">sum</span>(resid<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb122-13"><a href="section-2-linear-models-overview.html#cb122-13" aria-hidden="true"></a>}</span>
<span id="cb122-14"><a href="section-2-linear-models-overview.html#cb122-14" aria-hidden="true"></a></span>
<span id="cb122-15"><a href="section-2-linear-models-overview.html#cb122-15" aria-hidden="true"></a><span class="co"># plot RSS as a function of beta1 when beta0=36</span></span>
<span id="cb122-16"><a href="section-2-linear-models-overview.html#cb122-16" aria-hidden="true"></a>beta1 =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">len=</span><span class="kw">nrow</span>(galton_heights))</span>
<span id="cb122-17"><a href="section-2-linear-models-overview.html#cb122-17" aria-hidden="true"></a>results &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">beta1 =</span> beta1,</span>
<span id="cb122-18"><a href="section-2-linear-models-overview.html#cb122-18" aria-hidden="true"></a>                      <span class="dt">rss =</span> <span class="kw">sapply</span>(beta1, rss, <span class="dt">beta0 =</span> <span class="dv">36</span>))</span>
<span id="cb122-19"><a href="section-2-linear-models-overview.html#cb122-19" aria-hidden="true"></a>results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(beta1, rss)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb122-20"><a href="section-2-linear-models-overview.html#cb122-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(beta1, rss))</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-46-1.png" width="672" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. 0.65</li>
<li><input type="checkbox" disabled="" checked="" />
B. 0.5</li>
<li><input type="checkbox" disabled="" />
C. 0.2</li>
<li><input type="checkbox" disabled="" />
D. 12</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><p>The least squares estimates for the parameters <span class="math inline">\(\beta_0, \beta_1, \dots, \beta_n\)</span> <strong>minimize</strong> the residual sum of squares.</p></li>
<li><p>Load the <code>Lahman</code> library and filter the <code>Teams</code> data frame to the years 1961-2001.</p></li>
</ol>
<p>Run a linear model in R predicting the number of runs per game based on the number of bases on balls and the number of home runs. Remember to first limit your data to 1961-2001.</p>
<p>What is the coefficient for bases on balls?</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="section-2-linear-models-overview.html#cb123-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span>Teams <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1961</span><span class="op">:</span><span class="dv">2001</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb123-2"><a href="section-2-linear-models-overview.html#cb123-2" aria-hidden="true"></a><span class="kw">mutate</span>(<span class="dt">R_per_game =</span> R <span class="op">/</span><span class="st"> </span>G, <span class="dt">BB_per_game =</span> BB <span class="op">/</span><span class="st"> </span>G, <span class="dt">HR_per_game =</span> HR <span class="op">/</span><span class="st"> </span>G) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb123-3"><a href="section-2-linear-models-overview.html#cb123-3" aria-hidden="true"></a><span class="kw">lm</span>(R_per_game <span class="op">~</span><span class="st"> </span>BB_per_game <span class="op">+</span><span class="st"> </span>HR_per_game, <span class="dt">data =</span> .)</span>
<span id="cb123-4"><a href="section-2-linear-models-overview.html#cb123-4" aria-hidden="true"></a></span>
<span id="cb123-5"><a href="section-2-linear-models-overview.html#cb123-5" aria-hidden="true"></a><span class="kw">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = R_per_game ~ BB_per_game + HR_per_game, data = .)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.87325 -0.24507 -0.01449  0.23866  1.24218 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.74430    0.08236   21.18   &lt;2e-16 ***
## BB_per_game  0.38742    0.02701   14.34   &lt;2e-16 ***
## HR_per_game  1.56117    0.04896   31.89   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3484 on 1023 degrees of freedom
## Multiple R-squared:  0.6503, Adjusted R-squared:  0.6496 
## F-statistic: 951.2 on 2 and 1023 DF,  p-value: &lt; 2.2e-16</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. 0.39</li>
<li><input type="checkbox" disabled="" />
B. 1.56</li>
<li><input type="checkbox" disabled="" />
C. 1.74</li>
<li><input type="checkbox" disabled="" />
D. 0.027</li>
</ul>
<p>The coefficient for bases on balls is 0.39; the coefficient for home runs is 1.56; the intercept is 1.74; the standard error for the BB coefficient is 0.027.</p>
<ol start="4" style="list-style-type: decimal">
<li>We run a Monte Carlo simulation where we repeatedly take samples of N = 100 from the Galton heights data and compute the regression slope coefficients for each sample:</li>
</ol>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="section-2-linear-models-overview.html#cb125-1" aria-hidden="true"></a>B &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb125-2"><a href="section-2-linear-models-overview.html#cb125-2" aria-hidden="true"></a>N &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb125-3"><a href="section-2-linear-models-overview.html#cb125-3" aria-hidden="true"></a>lse &lt;-<span class="st"> </span><span class="kw">replicate</span>(B, {</span>
<span id="cb125-4"><a href="section-2-linear-models-overview.html#cb125-4" aria-hidden="true"></a>    <span class="kw">sample_n</span>(galton_heights, N, <span class="dt">replace =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb125-5"><a href="section-2-linear-models-overview.html#cb125-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">lm</span>(son <span class="op">~</span><span class="st"> </span>father, <span class="dt">data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span>.<span class="op">$</span>coef </span>
<span id="cb125-6"><a href="section-2-linear-models-overview.html#cb125-6" aria-hidden="true"></a>})</span>
<span id="cb125-7"><a href="section-2-linear-models-overview.html#cb125-7" aria-hidden="true"></a></span>
<span id="cb125-8"><a href="section-2-linear-models-overview.html#cb125-8" aria-hidden="true"></a>lse &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">beta_0 =</span> lse[<span class="dv">1</span>,], <span class="dt">beta_1 =</span> lse[<span class="dv">2</span>,])</span></code></pre></div>
<p>What does the central limit theorem tell us about the variables beta_0 and beta_1?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. They are approximately normally distributed.</li>
<li><input type="checkbox" disabled="" checked="" />
B. The expected value of each is the true value of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> (assuming the Galton heights data is a complete population).</li>
<li><input type="checkbox" disabled="" />
C. The central limit theorem does not apply in this situation.</li>
<li><input type="checkbox" disabled="" />
D. It allows us to test the hypothesis that <span class="math inline">\(\beta_0 = 0\)</span> and <span class="math inline">\(\beta_0 = 1\)</span></li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>In an earlier video, we ran the following linear model and looked at a summary of the results.</li>
</ol>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="section-2-linear-models-overview.html#cb126-1" aria-hidden="true"></a><span class="op">$</span>\beta_<span class="dv">0</span><span class="op">$</span></span>
<span id="cb126-2"><a href="section-2-linear-models-overview.html#cb126-2" aria-hidden="true"></a><span class="er">&gt;</span><span class="st"> </span>mod &lt;-<span class="st"> </span><span class="kw">lm</span>(son <span class="op">~</span><span class="st"> </span>father, <span class="dt">data =</span> galton_heights)</span>
<span id="cb126-3"><a href="section-2-linear-models-overview.html#cb126-3" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(mod)</span>
<span id="cb126-4"><a href="section-2-linear-models-overview.html#cb126-4" aria-hidden="true"></a></span>
<span id="cb126-5"><a href="section-2-linear-models-overview.html#cb126-5" aria-hidden="true"></a>Call<span class="op">:</span></span>
<span id="cb126-6"><a href="section-2-linear-models-overview.html#cb126-6" aria-hidden="true"></a><span class="kw">lm</span>(<span class="dt">formula =</span> son <span class="op">~</span><span class="st"> </span>father, <span class="dt">data =</span> galton_heights)</span>
<span id="cb126-7"><a href="section-2-linear-models-overview.html#cb126-7" aria-hidden="true"></a></span>
<span id="cb126-8"><a href="section-2-linear-models-overview.html#cb126-8" aria-hidden="true"></a>Residuals<span class="op">:</span></span>
<span id="cb126-9"><a href="section-2-linear-models-overview.html#cb126-9" aria-hidden="true"></a><span class="st">   </span>Min     1Q  Median     3Q    Max </span>
<span id="cb126-10"><a href="section-2-linear-models-overview.html#cb126-10" aria-hidden="true"></a><span class="fl">-5.902</span>  <span class="fl">-1.405</span>  <span class="fl">0.092</span>    <span class="fl">1.342</span>  <span class="fl">8.092</span> </span>
<span id="cb126-11"><a href="section-2-linear-models-overview.html#cb126-11" aria-hidden="true"></a></span>
<span id="cb126-12"><a href="section-2-linear-models-overview.html#cb126-12" aria-hidden="true"></a>Coefficients<span class="op">:</span></span>
<span id="cb126-13"><a href="section-2-linear-models-overview.html#cb126-13" aria-hidden="true"></a><span class="st">                 </span>Estimate  Std. Error  t value     <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>t<span class="op">|</span>)  </span>
<span id="cb126-14"><a href="section-2-linear-models-overview.html#cb126-14" aria-hidden="true"></a>(Intercept)     <span class="fl">35.7125</span>     <span class="fl">4.5174</span>       <span class="fl">7.91</span>    <span class="fl">2.8e-13</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb126-15"><a href="section-2-linear-models-overview.html#cb126-15" aria-hidden="true"></a>father           <span class="fl">0.5028</span>     <span class="fl">0.0653</span>       <span class="fl">7.70</span>    <span class="fl">9.5e-13</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb126-16"><a href="section-2-linear-models-overview.html#cb126-16" aria-hidden="true"></a><span class="op">---</span></span>
<span id="cb126-17"><a href="section-2-linear-models-overview.html#cb126-17" aria-hidden="true"></a>Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> ‘<span class="op">**</span><span class="er">*</span>’ <span class="fl">0.001</span> ‘<span class="op">**</span>’ <span class="fl">0.01</span> ‘<span class="op">*</span>’ <span class="fl">0.05</span> ‘.’ <span class="fl">0.1</span> ‘ ’ <span class="dv">1</span></span>
<span id="cb126-18"><a href="section-2-linear-models-overview.html#cb126-18" aria-hidden="true"></a><span class="op">$</span>\beta_<span class="dv">0</span><span class="op">$</span></span></code></pre></div>
<p>What null hypothesis is the second p-value (the one in the father row) testing?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. <span class="math inline">\(\beta_1 = 1\)</span>, where <span class="math inline">\(\beta_1\)</span> is the coefficient for the variable “father.”</li>
<li><input type="checkbox" disabled="" />
B. <span class="math inline">\(\beta_1 = 0.503\)</span>, where <span class="math inline">\(\beta_1\)</span> is the coefficient for the variable “father.”</li>
<li><input type="checkbox" disabled="" checked="" />
C. <span class="math inline">\(\beta_1 = 0\)</span>, where <span class="math inline">\(\beta_1\)</span> is the coefficient for the variable “father.”</li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li>Which R code(s) below would properly plot the predictions and confidence intervals for our linear model of sons’ heights?</li>
</ol>
<p>Select ALL that apply.</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A.</li>
</ul>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="section-2-linear-models-overview.html#cb127-1" aria-hidden="true"></a>          galton_heights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(father, son)) <span class="op">+</span></span>
<span id="cb127-2"><a href="section-2-linear-models-overview.html#cb127-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb127-3"><a href="section-2-linear-models-overview.html#cb127-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
B.</li>
</ul>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="section-2-linear-models-overview.html#cb128-1" aria-hidden="true"></a>          galton_heights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(father, son)) <span class="op">+</span></span>
<span id="cb128-2"><a href="section-2-linear-models-overview.html#cb128-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb128-3"><a href="section-2-linear-models-overview.html#cb128-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
C.</li>
</ul>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="section-2-linear-models-overview.html#cb129-1" aria-hidden="true"></a>          model &lt;-<span class="st"> </span><span class="kw">lm</span>(son <span class="op">~</span><span class="st"> </span>father, <span class="dt">data =</span> galton_heights)</span>
<span id="cb129-2"><a href="section-2-linear-models-overview.html#cb129-2" aria-hidden="true"></a>predictions &lt;-<span class="st"> </span><span class="kw">predict</span>(model, <span class="dt">interval =</span> <span class="kw">c</span>(<span class="st">&quot;confidence&quot;</span>), <span class="dt">level =</span> <span class="fl">0.95</span>)</span>
<span id="cb129-3"><a href="section-2-linear-models-overview.html#cb129-3" aria-hidden="true"></a>data &lt;-<span class="st"> </span><span class="kw">as.tibble</span>(predictions) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="dt">father =</span> galton_heights<span class="op">$</span>father)</span>
<span id="cb129-4"><a href="section-2-linear-models-overview.html#cb129-4" aria-hidden="true"></a></span>
<span id="cb129-5"><a href="section-2-linear-models-overview.html#cb129-5" aria-hidden="true"></a><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x =</span> father, <span class="dt">y =</span> fit)) <span class="op">+</span></span>
<span id="cb129-6"><a href="section-2-linear-models-overview.html#cb129-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb129-7"><a href="section-2-linear-models-overview.html#cb129-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>lwr, <span class="dt">ymax=</span>upr), <span class="dt">alpha=</span><span class="fl">0.2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb129-8"><a href="section-2-linear-models-overview.html#cb129-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">data =</span> galton_heights, <span class="kw">aes</span>(<span class="dt">x =</span> father, <span class="dt">y =</span> son))</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
D.</li>
</ul>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="section-2-linear-models-overview.html#cb130-1" aria-hidden="true"></a>          model &lt;-<span class="st"> </span><span class="kw">lm</span>(son <span class="op">~</span><span class="st"> </span>father, <span class="dt">data =</span> galton_heights)</span>
<span id="cb130-2"><a href="section-2-linear-models-overview.html#cb130-2" aria-hidden="true"></a>predictions &lt;-<span class="st"> </span><span class="kw">predict</span>(model)</span>
<span id="cb130-3"><a href="section-2-linear-models-overview.html#cb130-3" aria-hidden="true"></a>data &lt;-<span class="st"> </span><span class="kw">as.tibble</span>(predictions) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="dt">father =</span> galton_heights<span class="op">$</span>father)</span>
<span id="cb130-4"><a href="section-2-linear-models-overview.html#cb130-4" aria-hidden="true"></a></span>
<span id="cb130-5"><a href="section-2-linear-models-overview.html#cb130-5" aria-hidden="true"></a><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x =</span> father, <span class="dt">y =</span> fit)) <span class="op">+</span></span>
<span id="cb130-6"><a href="section-2-linear-models-overview.html#cb130-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb130-7"><a href="section-2-linear-models-overview.html#cb130-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">data =</span> galton_heights, <span class="kw">aes</span>(<span class="dt">x =</span> father, <span class="dt">y =</span> son))</span></code></pre></div>
</div>
<div id="assessment---least-squares-estimates-part-2" class="section level2" number="3.11">
<h2><span class="header-section-number">3.11</span> Assessment - Least Squares Estimates, part 2</h2>
<p>In Questions 7 and 8, you’ll look again at female heights from GaltonFamilies.</p>
<p>Define <code>female_heights</code>, a set of mother and daughter heights sampled from <code>GaltonFamilies</code>, as follows:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="section-2-linear-models-overview.html#cb131-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1989</span>, <span class="dt">sample.kind=</span><span class="st">&quot;Rounding&quot;</span>) <span class="co">#if you are using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1989, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="section-2-linear-models-overview.html#cb133-1" aria-hidden="true"></a><span class="kw">options</span>(<span class="dt">digits =</span> <span class="dv">3</span>)    <span class="co"># report 3 significant digits</span></span>
<span id="cb133-2"><a href="section-2-linear-models-overview.html#cb133-2" aria-hidden="true"></a></span>
<span id="cb133-3"><a href="section-2-linear-models-overview.html#cb133-3" aria-hidden="true"></a>female_heights &lt;-<span class="st"> </span>GaltonFamilies <span class="op">%&gt;%</span><span class="st">     </span></span>
<span id="cb133-4"><a href="section-2-linear-models-overview.html#cb133-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;female&quot;</span>) <span class="op">%&gt;%</span><span class="st">     </span></span>
<span id="cb133-5"><a href="section-2-linear-models-overview.html#cb133-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(family) <span class="op">%&gt;%</span><span class="st">     </span></span>
<span id="cb133-6"><a href="section-2-linear-models-overview.html#cb133-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">sample_n</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st">     </span></span>
<span id="cb133-7"><a href="section-2-linear-models-overview.html#cb133-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st">     </span></span>
<span id="cb133-8"><a href="section-2-linear-models-overview.html#cb133-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">select</span>(mother, childHeight) <span class="op">%&gt;%</span><span class="st">     </span></span>
<span id="cb133-9"><a href="section-2-linear-models-overview.html#cb133-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">daughter =</span> childHeight)</span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>Fit a linear regression model predicting the mothers’ heights using daughters’ heights.</li>
</ol>
<p>What is the slope of the model?</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="section-2-linear-models-overview.html#cb134-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">lm</span>(mother <span class="op">~</span><span class="st"> </span>daughter, <span class="dt">data =</span> female_heights)</span>
<span id="cb134-2"><a href="section-2-linear-models-overview.html#cb134-2" aria-hidden="true"></a>fit<span class="op">$</span>coef[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## daughter 
##     0.31</code></pre>
<p>What the intercept of the model?</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="section-2-linear-models-overview.html#cb136-1" aria-hidden="true"></a>fit<span class="op">$</span>coef[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## (Intercept) 
##        44.2</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Predict mothers’ heights using the model.</li>
</ol>
<p>What is the predicted height of the first mother in the dataset?</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="section-2-linear-models-overview.html#cb138-1" aria-hidden="true"></a><span class="kw">predict</span>(fit)[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>##    1 
## 65.6</code></pre>
<p>What is the actual height of the first mother in the dataset?</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="section-2-linear-models-overview.html#cb140-1" aria-hidden="true"></a>female_heights<span class="op">$</span>mother[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 67</code></pre>
<p>We have shown how BB and singles have similar predictive power for scoring runs. Another way to compare the usefulness of these baseball metrics is by assessing how stable they are across the years. Because we have to pick players based on their previous performances, we will prefer metrics that are more stable. In these exercises, we will compare the stability of singles and BBs.</p>
<p>Before we get started, we want to generate two tables: one for 2002 and another for the average of 1999-2001 seasons. We want to define per plate appearance statistics, keeping only players with more than 100 plate appearances. Here is how we create the 2002 table:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="section-2-linear-models-overview.html#cb142-1" aria-hidden="true"></a>bat_<span class="dv">02</span> &lt;-<span class="st"> </span>Batting <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yearID <span class="op">==</span><span class="st"> </span><span class="dv">2002</span>) <span class="op">%&gt;%</span></span>
<span id="cb142-2"><a href="section-2-linear-models-overview.html#cb142-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">pa =</span> AB <span class="op">+</span><span class="st"> </span>BB, <span class="dt">singles =</span> (H <span class="op">-</span><span class="st"> </span>X2B <span class="op">-</span><span class="st"> </span>X3B <span class="op">-</span><span class="st"> </span>HR)<span class="op">/</span>pa, <span class="dt">bb =</span> BB<span class="op">/</span>pa) <span class="op">%&gt;%</span></span>
<span id="cb142-3"><a href="section-2-linear-models-overview.html#cb142-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(pa <span class="op">&gt;=</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span></span>
<span id="cb142-4"><a href="section-2-linear-models-overview.html#cb142-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">select</span>(playerID, singles, bb)</span></code></pre></div>
<ol start="9" style="list-style-type: decimal">
<li>Now compute a similar table but with rates computed over 1999-2001. Keep only rows from 1999-2001 where players have 100 or more plate appearances, calculate each player’s single rate and BB rate per season, then calculate the average single rate (<code>mean_singles</code>) and average BB rate (<code>mean_bb</code>) per player over those three seasons.</li>
</ol>
<p>How many players had a single rate <code>mean_singles</code> of greater than 0.2 per plate appearance over 1999-2001?</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="section-2-linear-models-overview.html#cb143-1" aria-hidden="true"></a>bat_<span class="dv">99</span>_<span class="dv">01</span> &lt;-<span class="st"> </span>Batting <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1999</span><span class="op">:</span><span class="dv">2001</span>) <span class="op">%&gt;%</span></span>
<span id="cb143-2"><a href="section-2-linear-models-overview.html#cb143-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">pa =</span> AB <span class="op">+</span><span class="st"> </span>BB, <span class="dt">singles =</span> (H <span class="op">-</span><span class="st"> </span>X2B <span class="op">-</span><span class="st"> </span>X3B <span class="op">-</span><span class="st"> </span>HR)<span class="op">/</span>pa, <span class="dt">bb =</span> BB<span class="op">/</span>pa) <span class="op">%&gt;%</span></span>
<span id="cb143-3"><a href="section-2-linear-models-overview.html#cb143-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(pa <span class="op">&gt;=</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span></span>
<span id="cb143-4"><a href="section-2-linear-models-overview.html#cb143-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></span>
<span id="cb143-5"><a href="section-2-linear-models-overview.html#cb143-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">mean_singles =</span> <span class="kw">mean</span>(singles), <span class="dt">mean_bb =</span> <span class="kw">mean</span>(bb))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="section-2-linear-models-overview.html#cb145-1" aria-hidden="true"></a><span class="kw">sum</span>(bat_<span class="dv">99</span>_<span class="dv">01</span><span class="op">$</span>mean_singles <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.2</span>)</span></code></pre></div>
<pre><code>## [1] 46</code></pre>
<p>How many players had a BB rate <code>mean_bb</code> of greater than 0.2 per plate appearance over 1999-2001?</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="section-2-linear-models-overview.html#cb147-1" aria-hidden="true"></a><span class="kw">sum</span>(bat_<span class="dv">99</span>_<span class="dv">01</span><span class="op">$</span>mean_bb <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.2</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<ol start="10" style="list-style-type: decimal">
<li>Use <code>inner_join()</code> to combine the `<code>bat_02</code> table with the table of 1999-2001 rate averages you created in the previous question.</li>
</ol>
<p>What is the correlation between 2002 singles rates and 1999-2001 average singles rates?</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="section-2-linear-models-overview.html#cb149-1" aria-hidden="true"></a>dat &lt;-<span class="st"> </span><span class="kw">inner_join</span>(bat_<span class="dv">02</span>, bat_<span class="dv">99</span>_<span class="dv">01</span>)</span></code></pre></div>
<pre><code>## Joining, by = &quot;playerID&quot;</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="section-2-linear-models-overview.html#cb151-1" aria-hidden="true"></a><span class="kw">cor</span>(dat<span class="op">$</span>singles, dat<span class="op">$</span>mean_singles)</span></code></pre></div>
<pre><code>## [1] 0.551</code></pre>
<p>What is the correlation between 2002 BB rates and 1999-2001 average BB rates?</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="section-2-linear-models-overview.html#cb153-1" aria-hidden="true"></a><span class="kw">cor</span>(dat<span class="op">$</span>bb, dat<span class="op">$</span>mean_bb)</span></code></pre></div>
<pre><code>## [1] 0.717</code></pre>
<ol start="11" style="list-style-type: decimal">
<li>Make scatterplots of <code>mean_singles</code> versus <code>singles</code> and <code>mean_bb</code> versus <code>bb</code>.</li>
</ol>
<p>Are either of these distributions bivariate normal?</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="section-2-linear-models-overview.html#cb155-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span></span>
<span id="cb155-2"><a href="section-2-linear-models-overview.html#cb155-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(singles, mean_singles)) <span class="op">+</span></span>
<span id="cb155-3"><a href="section-2-linear-models-overview.html#cb155-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-64-1.png" width="672" /></p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="section-2-linear-models-overview.html#cb156-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span></span>
<span id="cb156-2"><a href="section-2-linear-models-overview.html#cb156-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(bb, mean_bb)) <span class="op">+</span></span>
<span id="cb156-3"><a href="section-2-linear-models-overview.html#cb156-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-64-2.png" width="672" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. Neither distribution is bivariate normal.</li>
<li><input type="checkbox" disabled="" />
B. <code>singles</code> and <code>mean_singles</code> are bivariate normal, but <code>bb</code> and <code>mean_bb</code> are not.</li>
<li><input type="checkbox" disabled="" />
C. <code>bb</code> and <code>mean_bb</code> are bivariate normal, but <code>singles</code> and <code>mean_singles</code> are not.</li>
<li><input type="checkbox" disabled="" checked="" />
D. Both distributions are bivariate normal.</li>
</ul>
<ol start="12" style="list-style-type: decimal">
<li>Fit a linear model to predict 2002 <code>singles</code> given 1999-2001 <code>mean_singles</code>.</li>
</ol>
<p>What is the coefficient of <code>mean_singles</code>, the slope of the fit?</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="section-2-linear-models-overview.html#cb157-1" aria-hidden="true"></a>fit_singles &lt;-<span class="st"> </span><span class="kw">lm</span>(singles <span class="op">~</span><span class="st"> </span>mean_singles, <span class="dt">data =</span> dat)</span>
<span id="cb157-2"><a href="section-2-linear-models-overview.html#cb157-2" aria-hidden="true"></a>fit_singles<span class="op">$</span>coef[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## mean_singles 
##        0.588</code></pre>
<p>Fit a linear model to predict 2002 <code>bb</code> given 1999-2001 <code>mean_bb</code>.</p>
<p>What is the coefficient of <code>mean_bb</code>, the slope of the fit?</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="section-2-linear-models-overview.html#cb159-1" aria-hidden="true"></a>fit_bb &lt;-<span class="st"> </span><span class="kw">lm</span>(bb <span class="op">~</span><span class="st"> </span>mean_bb, <span class="dt">data =</span> dat)</span>
<span id="cb159-2"><a href="section-2-linear-models-overview.html#cb159-2" aria-hidden="true"></a>fit_bb<span class="op">$</span>coef[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## mean_bb 
##   0.829</code></pre>
</div>
<div id="advanced-dplyr-tibbles" class="section level2" number="3.12">
<h2><span class="header-section-number">3.12</span> Advanced dplyr: Tibbles</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/linear-models.html#linear-regression-in-the-tidyverse" target="_blank">here</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>Tibbles can be regarded as a modern version of data frames and are the default data structure in the tidyverse.</li>
<li>Some functions that do not work properly with data frames do work with tibbles.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="section-2-linear-models-overview.html#cb161-1" aria-hidden="true"></a><span class="co"># stratify by HR</span></span>
<span id="cb161-2"><a href="section-2-linear-models-overview.html#cb161-2" aria-hidden="true"></a>dat &lt;-<span class="st"> </span>Teams <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1961</span><span class="op">:</span><span class="dv">2001</span>) <span class="op">%&gt;%</span></span>
<span id="cb161-3"><a href="section-2-linear-models-overview.html#cb161-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">HR =</span> <span class="kw">round</span>(HR<span class="op">/</span>G, <span class="dv">1</span>), </span>
<span id="cb161-4"><a href="section-2-linear-models-overview.html#cb161-4" aria-hidden="true"></a>         <span class="dt">BB =</span> BB<span class="op">/</span>G,</span>
<span id="cb161-5"><a href="section-2-linear-models-overview.html#cb161-5" aria-hidden="true"></a>         <span class="dt">R =</span> R<span class="op">/</span>G) <span class="op">%&gt;%</span></span>
<span id="cb161-6"><a href="section-2-linear-models-overview.html#cb161-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(HR, BB, R) <span class="op">%&gt;%</span></span>
<span id="cb161-7"><a href="section-2-linear-models-overview.html#cb161-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(HR <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.4</span> <span class="op">&amp;</span><span class="st"> </span>HR<span class="op">&lt;=</span><span class="fl">1.2</span>)</span>
<span id="cb161-8"><a href="section-2-linear-models-overview.html#cb161-8" aria-hidden="true"></a>  </span>
<span id="cb161-9"><a href="section-2-linear-models-overview.html#cb161-9" aria-hidden="true"></a><span class="co"># calculate slope of regression lines to predict runs by BB in different HR strata</span></span>
<span id="cb161-10"><a href="section-2-linear-models-overview.html#cb161-10" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb161-11"><a href="section-2-linear-models-overview.html#cb161-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span></span>
<span id="cb161-12"><a href="section-2-linear-models-overview.html#cb161-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">slope =</span> <span class="kw">cor</span>(BB,R)<span class="op">*</span><span class="kw">sd</span>(R)<span class="op">/</span><span class="kw">sd</span>(BB))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 9 x 2
##      HR slope
##   &lt;dbl&gt; &lt;dbl&gt;
## 1   0.4 0.734
## 2   0.5 0.566
## 3   0.6 0.412
## 4   0.7 0.285
## 5   0.8 0.365
## 6   0.9 0.261
## 7   1   0.512
## 8   1.1 0.454
## 9   1.2 0.440</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="section-2-linear-models-overview.html#cb164-1" aria-hidden="true"></a><span class="co"># use lm to get estimated slopes - lm does not work with grouped tibbles</span></span>
<span id="cb164-2"><a href="section-2-linear-models-overview.html#cb164-2" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb164-3"><a href="section-2-linear-models-overview.html#cb164-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span></span>
<span id="cb164-4"><a href="section-2-linear-models-overview.html#cb164-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB, <span class="dt">data =</span> .) <span class="op">%&gt;%</span></span>
<span id="cb164-5"><a href="section-2-linear-models-overview.html#cb164-5" aria-hidden="true"></a><span class="st">  </span>.<span class="op">$</span>coef</span></code></pre></div>
<pre><code>## (Intercept)          BB 
##       2.198       0.638</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="section-2-linear-models-overview.html#cb166-1" aria-hidden="true"></a><span class="co"># inspect a grouped tibble</span></span>
<span id="cb166-2"><a href="section-2-linear-models-overview.html#cb166-2" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
## # Groups:   HR [5]
##      HR    BB     R
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1   0.9  3.56  4.24
## 2   0.7  3.97  4.47
## 3   0.8  3.37  4.69
## 4   1.1  3.46  4.42
## 5   1    2.75  4.61
## 6   0.9  3.06  4.58</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="section-2-linear-models-overview.html#cb168-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</span></code></pre></div>
<pre><code>## [1] &quot;grouped_df&quot; &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
</div>
<div id="tibbles-differences-from-data-frames" class="section level2" number="3.13">
<h2><span class="header-section-number">3.13</span> Tibbles: Differences from Data Frames</h2>
<p><strong>Key points</strong></p>
<ul>
<li>Tibbles are more readable than data frames.</li>
<li>If you subset a data frame, you may not get a data frame. If you subset a tibble, you always get a tibble.</li>
<li>Tibbles can hold more complex objects such as lists or functions.</li>
<li>Tibbles can be grouped.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="section-2-linear-models-overview.html#cb170-1" aria-hidden="true"></a><span class="co"># inspect data frame and tibble</span></span>
<span id="cb170-2"><a href="section-2-linear-models-overview.html#cb170-2" aria-hidden="true"></a><span class="kw">head</span>(Teams)</span></code></pre></div>
<pre><code>##   yearID lgID teamID franchID divID Rank  G Ghome  W  L DivWin WCWin LgWin WSWin   R   AB   H X2B X3B HR BB SO SB CS HBP SF  RA  ER  ERA CG SHO SV IPouts  HA HRA BBA SOA   E DP
## 1   1871   NA    BS1      BNA  &lt;NA&gt;    3 31    NA 20 10   &lt;NA&gt;  &lt;NA&gt;     N  &lt;NA&gt; 401 1372 426  70  37  3 60 19 73 16  NA NA 303 109 3.55 22   1  3    828 367   2  42  23 243 24
## 2   1871   NA    CH1      CNA  &lt;NA&gt;    2 28    NA 19  9   &lt;NA&gt;  &lt;NA&gt;     N  &lt;NA&gt; 302 1196 323  52  21 10 60 22 69 21  NA NA 241  77 2.76 25   0  1    753 308   6  28  22 229 16
## 3   1871   NA    CL1      CFC  &lt;NA&gt;    8 29    NA 10 19   &lt;NA&gt;  &lt;NA&gt;     N  &lt;NA&gt; 249 1186 328  35  40  7 26 25 18  8  NA NA 341 116 4.11 23   0  0    762 346  13  53  34 234 15
## 4   1871   NA    FW1      KEK  &lt;NA&gt;    7 19    NA  7 12   &lt;NA&gt;  &lt;NA&gt;     N  &lt;NA&gt; 137  746 178  19   8  2 33  9 16  4  NA NA 243  97 5.17 19   1  0    507 261   5  21  17 163  8
## 5   1871   NA    NY2      NNA  &lt;NA&gt;    5 33    NA 16 17   &lt;NA&gt;  &lt;NA&gt;     N  &lt;NA&gt; 302 1404 403  43  21  1 33 15 46 15  NA NA 313 121 3.72 32   1  0    879 373   7  42  22 235 14
## 6   1871   NA    PH1      PNA  &lt;NA&gt;    1 28    NA 21  7   &lt;NA&gt;  &lt;NA&gt;     Y  &lt;NA&gt; 376 1281 410  66  27  9 46 23 56 12  NA NA 266 137 4.95 27   0  0    747 329   3  53  16 194 13
##      FP                    name                         park attendance BPF PPF teamIDBR teamIDlahman45 teamIDretro
## 1 0.834    Boston Red Stockings          South End Grounds I         NA 103  98      BOS            BS1         BS1
## 2 0.829 Chicago White Stockings      Union Base-Ball Grounds         NA 104 102      CHI            CH1         CH1
## 3 0.818  Cleveland Forest Citys National Association Grounds         NA  96 100      CLE            CL1         CL1
## 4 0.803    Fort Wayne Kekiongas               Hamilton Field         NA 101 107      KEK            FW1         FW1
## 5 0.840        New York Mutuals     Union Grounds (Brooklyn)         NA  90  88      NYU            NY2         NY2
## 6 0.845  Philadelphia Athletics     Jefferson Street Grounds         NA 102  98      ATH            PH1         PH1</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="section-2-linear-models-overview.html#cb172-1" aria-hidden="true"></a><span class="kw">as_tibble</span>(Teams)</span></code></pre></div>
<pre><code>## # A tibble: 2,925 x 48
##    yearID lgID  teamID franchID divID  Rank     G Ghome     W     L DivWin WCWin LgWin WSWin     R    AB     H   X2B   X3B    HR    BB    SO    SB    CS   HBP    SF    RA    ER   ERA
##     &lt;int&gt; &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1   1871 NA    BS1    BNA      &lt;NA&gt;      3    31    NA    20    10 &lt;NA&gt;   &lt;NA&gt;  N     &lt;NA&gt;    401  1372   426    70    37     3    60    19    73    16    NA    NA   303   109  3.55
##  2   1871 NA    CH1    CNA      &lt;NA&gt;      2    28    NA    19     9 &lt;NA&gt;   &lt;NA&gt;  N     &lt;NA&gt;    302  1196   323    52    21    10    60    22    69    21    NA    NA   241    77  2.76
##  3   1871 NA    CL1    CFC      &lt;NA&gt;      8    29    NA    10    19 &lt;NA&gt;   &lt;NA&gt;  N     &lt;NA&gt;    249  1186   328    35    40     7    26    25    18     8    NA    NA   341   116  4.11
##  4   1871 NA    FW1    KEK      &lt;NA&gt;      7    19    NA     7    12 &lt;NA&gt;   &lt;NA&gt;  N     &lt;NA&gt;    137   746   178    19     8     2    33     9    16     4    NA    NA   243    97  5.17
##  5   1871 NA    NY2    NNA      &lt;NA&gt;      5    33    NA    16    17 &lt;NA&gt;   &lt;NA&gt;  N     &lt;NA&gt;    302  1404   403    43    21     1    33    15    46    15    NA    NA   313   121  3.72
##  6   1871 NA    PH1    PNA      &lt;NA&gt;      1    28    NA    21     7 &lt;NA&gt;   &lt;NA&gt;  Y     &lt;NA&gt;    376  1281   410    66    27     9    46    23    56    12    NA    NA   266   137  4.95
##  7   1871 NA    RC1    ROK      &lt;NA&gt;      9    25    NA     4    21 &lt;NA&gt;   &lt;NA&gt;  N     &lt;NA&gt;    231  1036   274    44    25     3    38    30    53    10    NA    NA   287   108  4.3 
##  8   1871 NA    TRO    TRO      &lt;NA&gt;      6    29    NA    13    15 &lt;NA&gt;   &lt;NA&gt;  N     &lt;NA&gt;    351  1248   384    51    34     6    49    19    62    24    NA    NA   362   153  5.51
##  9   1871 NA    WS3    OLY      &lt;NA&gt;      4    32    NA    15    15 &lt;NA&gt;   &lt;NA&gt;  N     &lt;NA&gt;    310  1353   375    54    26     6    48    13    48    13    NA    NA   303   137  4.37
## 10   1872 NA    BL1    BLC      &lt;NA&gt;      2    58    NA    35    19 &lt;NA&gt;   &lt;NA&gt;  N     &lt;NA&gt;    617  2571   753   106    31    14    29    28    53    18    NA    NA   434   166  2.9 
## # … with 2,915 more rows, and 19 more variables: CG &lt;int&gt;, SHO &lt;int&gt;, SV &lt;int&gt;, IPouts &lt;int&gt;, HA &lt;int&gt;, HRA &lt;int&gt;, BBA &lt;int&gt;, SOA &lt;int&gt;, E &lt;int&gt;, DP &lt;int&gt;, FP &lt;dbl&gt;, name &lt;chr&gt;,
## #   park &lt;chr&gt;, attendance &lt;int&gt;, BPF &lt;int&gt;, PPF &lt;int&gt;, teamIDBR &lt;chr&gt;, teamIDlahman45 &lt;chr&gt;, teamIDretro &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="section-2-linear-models-overview.html#cb174-1" aria-hidden="true"></a><span class="co"># Note that the function was formerly called as.tibble()</span></span>
<span id="cb174-2"><a href="section-2-linear-models-overview.html#cb174-2" aria-hidden="true"></a></span>
<span id="cb174-3"><a href="section-2-linear-models-overview.html#cb174-3" aria-hidden="true"></a><span class="co"># subsetting a data frame sometimes generates vectors</span></span>
<span id="cb174-4"><a href="section-2-linear-models-overview.html#cb174-4" aria-hidden="true"></a><span class="kw">class</span>(Teams[,<span class="dv">20</span>])</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="section-2-linear-models-overview.html#cb176-1" aria-hidden="true"></a><span class="co"># subsetting a tibble always generates tibbles</span></span>
<span id="cb176-2"><a href="section-2-linear-models-overview.html#cb176-2" aria-hidden="true"></a><span class="kw">class</span>(<span class="kw">as_tibble</span>(Teams[,<span class="dv">20</span>]))</span></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="section-2-linear-models-overview.html#cb178-1" aria-hidden="true"></a><span class="co"># pulling a vector out of a tibble</span></span>
<span id="cb178-2"><a href="section-2-linear-models-overview.html#cb178-2" aria-hidden="true"></a><span class="kw">class</span>(<span class="kw">as_tibble</span>(Teams)<span class="op">$</span>HR)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="section-2-linear-models-overview.html#cb180-1" aria-hidden="true"></a><span class="co"># access a non-existing column in a data frame or a tibble</span></span>
<span id="cb180-2"><a href="section-2-linear-models-overview.html#cb180-2" aria-hidden="true"></a>Teams<span class="op">$</span>hr</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="section-2-linear-models-overview.html#cb182-1" aria-hidden="true"></a><span class="kw">as_tibble</span>(Teams)<span class="op">$</span>HR</span></code></pre></div>
<pre><code>##    [1]   3  10   7   2   1   9   3   6   6  14   0   1   7   0   2   4   4   5   0   0   9   0   6  13   0   5   4   8   2   1   1  17   4   2   7   6   2   2  15   0   2   0   2   7
##   [45]   7   5   0   0   0   0   9   8   4   2   6   2   7   2   4   0   6   4   9   1   2   3   5   3   2   8   2  20   3   4   8  12   5   4   3  20   4   7   7   8   5   8  12   5
##   [89]  12   7  17  11   5   7  18   4  15  15  20   5  19   9   5  11  18  11  12  16   8   5  34  13   8  15  34  13  14  24   6  20   3  21  13   7   2  39  32  17  16  36  19 142
##  [133]  10  16  40  36  26  31  20   6  17   0  22  22  26  14   7  21   2   7  11  32   0   8   2   6   4  23  17  14  22  54  26  25  19  16  21  30  20   6   5  17   8   8  16  24
##  [177]  53  45  53  19  20  21  18  21  26  16  20  30  23  31  25  53  80  14  37  55  33  27  48  21  29  47  20  39  47  19  25  56  77  12  32  51  34  19  14  55  31  16  14  36
##  [221]  30  20  47  42  79  25  36  52  62  18  22  52  43  44  42  58  25  20   2  13  43  34  31  58  67  31  27  21  16  27  15  25  66  24  23  49  20  35  31  48  14  24  30  23
##  [265]  52  53  60  40  22  20  28  17  13  46  55  21  29  57  19  30  30  34  26  44  26  18  39  50  38  45  37  27  45  65  32  29  32  19  61  80  37  10  23  33  42 103  65  61
##  [309]  37  42  45  40  48  54  59  25  41  54  55  36  29  34  32  61  27  39  55  23  28  36  34  20  28  37  40  49  27  37  45  19  24  45  38  22  16  40  31  40  25  32  36  12
##  [353]  17  53  18  19  18  32  34  33  14  13  36  17  27  39  27  13  12  40  23  31  29  47  47  26  48  33  33  23  29  26  36  24  37  32  28  32  18  38  12  29  26  19  35  24
##  [397]  29  39  33  33  42  19  14  14   6  18  33  22   6  38   5  18  29  10  47  48  15  25  14   9  28  31  12  20  18  32  12  34  12   8  17  26  15  24  14  22  21  27  11  31
##  [441]  27  31  23  15  10  24  10  29  29  17  11  12  27  18  13  39  23  24  16  22  16  20  22  13  25  16   7  20  16  12  10  14  17  32  12  12  20   9  26  18  18  22   5  13
##  [485]  15  11  11  23  15  22  12  19  10  18  12  14  28  17   3  19  14  18  19  20  13  21  11  25  20  17   8  20  16  14   4  20  22  10  19  26  16  21  12  25  10  15   9  43
##  [529]  25  31   7  34  23   9  28  31  20  19  22  33  12  15   9  35  28  37  20  54  21  20  30  41  25  35  60  49  17  26  16  29  32  35  17  43  21  12  19  47  18  22  43  39
##  [573]  19  27  20  17  39  32  24  59  27  16  24  30   8  33  73  35  18  15  19  32  18  42  31  35  38  19  52  42  16  10  25  33  39  30  12  29  62  18  34  17  26  33  18  36
##  [617]  14  36  14  17  40  25  50  53  15  20  23  28  17  24  31  16  58  24  20  19  23  20  12  14  28  22  17  46  14  16  17  42  35  19  42  20  14  25  12  14  25  22  18  17
##  [661]  26  13  25  39  27  17  38   9  15  26   4  15  10  13   8  21  15   9  13  13  20  22  25  15   5  27   4  33  25  24  25  21  20  24  23  40  45  35  42  17  31  18  24  22
##  [705]  28  23  37  34  18  35  30  46 115  44  64  16  50  32  36  17  59  61  35  37  20  42  58  75 134  82  88  37  67  83  42  45  56  32  45  42  45  32  54  80  95 111 116  52
##  [749]  98 107  45  34  62  32  42  90  45  59  41  85 105  53 112  49  82  63  26  30  72  25  41  66  36  41  35  95  98  63  94  44  67  67  22  41  64  41  38  86  44  52  50 114
##  [793] 110  76 100  78 110 109  56  32  40  16  32  66  35  27  36  73 121  61  75  44  72  90  43  28  39  37  36  74  29  26  51 109 158  56  57  54  55  84  29  38  66  52  24  92
##  [837]  32  34  62 118 133  89  85  52  63 113  40  28  99  33  37 139  34  62 110 136 142 122 153  60  46 100  48  47 122  66  63 171  74  72  82 143 152 125 126  86  75 104  57  37
##  [881]  71  34  27  84  21  71  43 101 155 118  81  41  76  60  49  53 110  63  36  69  47  78  80 116 160 172 122  48  67  76  61  50  62  54  43  72  34  50  57  82 144 139  60  39
##  [925]  64  57  60  51  79  83  71 101  55 100  74 126 135 144  56  52  62 104  51  69  59  75  74  88  73  93 106 123 104 112  92  66  73  86  32  86  33  67  60  76  82 123  94  97
##  [969] 182  72 103  60  79  88  62 100  37  63  67  96  73 103 150 111 174  94 103  47  71  94  47  98  61  54  67  65 110 113 137 125
##  [ reached getOption(&quot;max.print&quot;) -- omitted 1925 entries ]</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="section-2-linear-models-overview.html#cb184-1" aria-hidden="true"></a><span class="co"># create a tibble with complex objects</span></span>
<span id="cb184-2"><a href="section-2-linear-models-overview.html#cb184-2" aria-hidden="true"></a><span class="kw">tibble</span>(<span class="dt">id =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="dt">func =</span> <span class="kw">c</span>(mean, median, sd))</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##      id func  
##   &lt;dbl&gt; &lt;list&gt;
## 1     1 &lt;fn&gt;  
## 2     2 &lt;fn&gt;  
## 3     3 &lt;fn&gt;</code></pre>
</div>
<div id="do" class="section level2" number="3.14">
<h2><span class="header-section-number">3.14</span> do</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/linear-models.html#linear-regression-in-the-tidyverse" target="_blank">here</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>The <code>do()</code> function serves as a bridge between R functions, such as <code>lm()</code>, and the tidyverse.</li>
<li>We have to specify a column when using the <code>do()</code> function, otherwise we will get an error.</li>
<li>If the data frame being returned has more than one row, the rows will be concatenated appropriately.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="section-2-linear-models-overview.html#cb186-1" aria-hidden="true"></a><span class="co"># use do to fit a regression line to each HR stratum</span></span>
<span id="cb186-2"><a href="section-2-linear-models-overview.html#cb186-2" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb186-3"><a href="section-2-linear-models-overview.html#cb186-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span></span>
<span id="cb186-4"><a href="section-2-linear-models-overview.html#cb186-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">do</span>(<span class="dt">fit =</span> <span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB, <span class="dt">data =</span> .))</span></code></pre></div>
<pre><code>## # A tibble: 9 x 2
## # Rowwise: 
##      HR fit   
##   &lt;dbl&gt; &lt;list&gt;
## 1   0.4 &lt;lm&gt;  
## 2   0.5 &lt;lm&gt;  
## 3   0.6 &lt;lm&gt;  
## 4   0.7 &lt;lm&gt;  
## 5   0.8 &lt;lm&gt;  
## 6   0.9 &lt;lm&gt;  
## 7   1   &lt;lm&gt;  
## 8   1.1 &lt;lm&gt;  
## 9   1.2 &lt;lm&gt;</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="section-2-linear-models-overview.html#cb188-1" aria-hidden="true"></a><span class="co"># using do without a column name gives an error</span></span>
<span id="cb188-2"><a href="section-2-linear-models-overview.html#cb188-2" aria-hidden="true"></a>dat <span class="op">%&gt;%</span></span>
<span id="cb188-3"><a href="section-2-linear-models-overview.html#cb188-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span></span>
<span id="cb188-4"><a href="section-2-linear-models-overview.html#cb188-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">do</span>(<span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB, <span class="dt">data =</span> .))</span></code></pre></div>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="section-2-linear-models-overview.html#cb189-1" aria-hidden="true"></a><span class="co"># define a function to extract slope from lm</span></span>
<span id="cb189-2"><a href="section-2-linear-models-overview.html#cb189-2" aria-hidden="true"></a>get_slope &lt;-<span class="st"> </span><span class="cf">function</span>(data){</span>
<span id="cb189-3"><a href="section-2-linear-models-overview.html#cb189-3" aria-hidden="true"></a>  fit &lt;-<span class="st"> </span><span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB, <span class="dt">data =</span> data)</span>
<span id="cb189-4"><a href="section-2-linear-models-overview.html#cb189-4" aria-hidden="true"></a>  <span class="kw">data.frame</span>(<span class="dt">slope =</span> fit<span class="op">$</span>coefficients[<span class="dv">2</span>], </span>
<span id="cb189-5"><a href="section-2-linear-models-overview.html#cb189-5" aria-hidden="true"></a>             <span class="dt">se =</span> <span class="kw">summary</span>(fit)<span class="op">$</span>coefficient[<span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb189-6"><a href="section-2-linear-models-overview.html#cb189-6" aria-hidden="true"></a>}</span>
<span id="cb189-7"><a href="section-2-linear-models-overview.html#cb189-7" aria-hidden="true"></a></span>
<span id="cb189-8"><a href="section-2-linear-models-overview.html#cb189-8" aria-hidden="true"></a><span class="co"># return the desired data frame</span></span>
<span id="cb189-9"><a href="section-2-linear-models-overview.html#cb189-9" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb189-10"><a href="section-2-linear-models-overview.html#cb189-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span></span>
<span id="cb189-11"><a href="section-2-linear-models-overview.html#cb189-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="kw">get_slope</span>(.))</span></code></pre></div>
<pre><code>## # A tibble: 9 x 3
## # Groups:   HR [9]
##      HR slope     se
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1   0.4 0.734 0.208 
## 2   0.5 0.566 0.110 
## 3   0.6 0.412 0.0974
## 4   0.7 0.285 0.0705
## 5   0.8 0.365 0.0653
## 6   0.9 0.261 0.0751
## 7   1   0.512 0.0751
## 8   1.1 0.454 0.0855
## 9   1.2 0.440 0.0801</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="section-2-linear-models-overview.html#cb191-1" aria-hidden="true"></a><span class="co"># not the desired output: a column containing data frames</span></span>
<span id="cb191-2"><a href="section-2-linear-models-overview.html#cb191-2" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb191-3"><a href="section-2-linear-models-overview.html#cb191-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span></span>
<span id="cb191-4"><a href="section-2-linear-models-overview.html#cb191-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="dt">slope =</span> <span class="kw">get_slope</span>(.))</span></code></pre></div>
<pre><code>## # A tibble: 9 x 2
## # Rowwise: 
##      HR slope           
##   &lt;dbl&gt; &lt;list&gt;          
## 1   0.4 &lt;df[,2] [1 × 2]&gt;
## 2   0.5 &lt;df[,2] [1 × 2]&gt;
## 3   0.6 &lt;df[,2] [1 × 2]&gt;
## 4   0.7 &lt;df[,2] [1 × 2]&gt;
## 5   0.8 &lt;df[,2] [1 × 2]&gt;
## 6   0.9 &lt;df[,2] [1 × 2]&gt;
## 7   1   &lt;df[,2] [1 × 2]&gt;
## 8   1.1 &lt;df[,2] [1 × 2]&gt;
## 9   1.2 &lt;df[,2] [1 × 2]&gt;</code></pre>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="section-2-linear-models-overview.html#cb193-1" aria-hidden="true"></a><span class="co"># data frames with multiple rows will be concatenated appropriately</span></span>
<span id="cb193-2"><a href="section-2-linear-models-overview.html#cb193-2" aria-hidden="true"></a>get_lse &lt;-<span class="st"> </span><span class="cf">function</span>(data){</span>
<span id="cb193-3"><a href="section-2-linear-models-overview.html#cb193-3" aria-hidden="true"></a>  fit &lt;-<span class="st"> </span><span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB, <span class="dt">data =</span> data)</span>
<span id="cb193-4"><a href="section-2-linear-models-overview.html#cb193-4" aria-hidden="true"></a>  <span class="kw">data.frame</span>(<span class="dt">term =</span> <span class="kw">names</span>(fit<span class="op">$</span>coefficients),</span>
<span id="cb193-5"><a href="section-2-linear-models-overview.html#cb193-5" aria-hidden="true"></a>    <span class="dt">estimate =</span> fit<span class="op">$</span>coefficients, </span>
<span id="cb193-6"><a href="section-2-linear-models-overview.html#cb193-6" aria-hidden="true"></a>    <span class="dt">se =</span> <span class="kw">summary</span>(fit)<span class="op">$</span>coefficient[,<span class="dv">2</span>])</span>
<span id="cb193-7"><a href="section-2-linear-models-overview.html#cb193-7" aria-hidden="true"></a>}</span>
<span id="cb193-8"><a href="section-2-linear-models-overview.html#cb193-8" aria-hidden="true"></a></span>
<span id="cb193-9"><a href="section-2-linear-models-overview.html#cb193-9" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb193-10"><a href="section-2-linear-models-overview.html#cb193-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span></span>
<span id="cb193-11"><a href="section-2-linear-models-overview.html#cb193-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="kw">get_lse</span>(.))</span></code></pre></div>
<pre><code>## # A tibble: 18 x 4
## # Groups:   HR [9]
##       HR term        estimate     se
##    &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;
##  1   0.4 (Intercept)    1.36  0.631 
##  2   0.4 BB             0.734 0.208 
##  3   0.5 (Intercept)    2.01  0.344 
##  4   0.5 BB             0.566 0.110 
##  5   0.6 (Intercept)    2.53  0.305 
##  6   0.6 BB             0.412 0.0974
##  7   0.7 (Intercept)    3.21  0.225 
##  8   0.7 BB             0.285 0.0705
##  9   0.8 (Intercept)    3.07  0.213 
## 10   0.8 BB             0.365 0.0653
## 11   0.9 (Intercept)    3.54  0.251 
## 12   0.9 BB             0.261 0.0751
## 13   1   (Intercept)    2.88  0.256 
## 14   1   BB             0.512 0.0751
## 15   1.1 (Intercept)    3.21  0.300 
## 16   1.1 BB             0.454 0.0855
## 17   1.2 (Intercept)    3.40  0.291 
## 18   1.2 BB             0.440 0.0801</code></pre>
</div>
<div id="broom" class="section level2" number="3.15">
<h2><span class="header-section-number">3.15</span> broom</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/linear-models.html#the-broom-package" target="_blank">here</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>The <strong>broom</strong> package has three main functions, all of which extract information from the object returned by <strong>lm</strong> and return it in a <strong>tidyverse</strong> friendly data frame.</li>
<li>The <code>tidy()</code> function returns estimates and related information as a data frame.</li>
<li>The functions <code>glance()</code> and <code>augment()</code> relate to model specific and observation specific outcomes respectively.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="section-2-linear-models-overview.html#cb195-1" aria-hidden="true"></a><span class="co"># use tidy to return lm estimates and related information as a data frame</span></span>
<span id="cb195-2"><a href="section-2-linear-models-overview.html#cb195-2" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(broom)) <span class="kw">install.packages</span>(<span class="st">&quot;broom&quot;</span>)</span>
<span id="cb195-3"><a href="section-2-linear-models-overview.html#cb195-3" aria-hidden="true"></a></span>
<span id="cb195-4"><a href="section-2-linear-models-overview.html#cb195-4" aria-hidden="true"></a><span class="kw">library</span>(broom)</span>
<span id="cb195-5"><a href="section-2-linear-models-overview.html#cb195-5" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB, <span class="dt">data =</span> dat)</span>
<span id="cb195-6"><a href="section-2-linear-models-overview.html#cb195-6" aria-hidden="true"></a><span class="kw">tidy</span>(fit)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)    2.20     0.113       19.4 1.12e-70
## 2 BB             0.638    0.0344      18.5 1.35e-65</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="section-2-linear-models-overview.html#cb197-1" aria-hidden="true"></a><span class="co"># add confidence intervals with tidy</span></span>
<span id="cb197-2"><a href="section-2-linear-models-overview.html#cb197-2" aria-hidden="true"></a><span class="kw">tidy</span>(fit, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   term        estimate std.error statistic  p.value conf.low conf.high
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)    2.20     0.113       19.4 1.12e-70    1.98      2.42 
## 2 BB             0.638    0.0344      18.5 1.35e-65    0.570     0.705</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="section-2-linear-models-overview.html#cb199-1" aria-hidden="true"></a><span class="co"># pipeline with lm, do, tidy</span></span>
<span id="cb199-2"><a href="section-2-linear-models-overview.html#cb199-2" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb199-3"><a href="section-2-linear-models-overview.html#cb199-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span></span>
<span id="cb199-4"><a href="section-2-linear-models-overview.html#cb199-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB, <span class="dt">data =</span> .), <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb199-5"><a href="section-2-linear-models-overview.html#cb199-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;BB&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb199-6"><a href="section-2-linear-models-overview.html#cb199-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(HR, estimate, conf.low, conf.high)</span></code></pre></div>
<pre><code>## # A tibble: 9 x 4
## # Groups:   HR [9]
##      HR estimate conf.low conf.high
##   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1   0.4    0.734    0.308     1.16 
## 2   0.5    0.566    0.346     0.786
## 3   0.6    0.412    0.219     0.605
## 4   0.7    0.285    0.146     0.425
## 5   0.8    0.365    0.236     0.494
## 6   0.9    0.261    0.112     0.409
## 7   1      0.512    0.363     0.660
## 8   1.1    0.454    0.284     0.624
## 9   1.2    0.440    0.280     0.601</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="section-2-linear-models-overview.html#cb201-1" aria-hidden="true"></a><span class="co"># make ggplots</span></span>
<span id="cb201-2"><a href="section-2-linear-models-overview.html#cb201-2" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb201-3"><a href="section-2-linear-models-overview.html#cb201-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span></span>
<span id="cb201-4"><a href="section-2-linear-models-overview.html#cb201-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB, <span class="dt">data =</span> .), <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb201-5"><a href="section-2-linear-models-overview.html#cb201-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;BB&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb201-6"><a href="section-2-linear-models-overview.html#cb201-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(HR, estimate, conf.low, conf.high) <span class="op">%&gt;%</span></span>
<span id="cb201-7"><a href="section-2-linear-models-overview.html#cb201-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(HR, <span class="dt">y =</span> estimate, <span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high)) <span class="op">+</span></span>
<span id="cb201-8"><a href="section-2-linear-models-overview.html#cb201-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_errorbar</span>() <span class="op">+</span></span>
<span id="cb201-9"><a href="section-2-linear-models-overview.html#cb201-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-72-1.png" width="672" /></p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="section-2-linear-models-overview.html#cb202-1" aria-hidden="true"></a><span class="co"># inspect with glance</span></span>
<span id="cb202-2"><a href="section-2-linear-models-overview.html#cb202-2" aria-hidden="true"></a><span class="kw">glance</span>(fit)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 12
##   r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC deviance df.residual  nobs
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
## 1     0.266         0.265 0.454      343. 1.35e-65     1  -596. 1199. 1214.     195.         947   949</code></pre>
</div>
<div id="assessment---tibbles-do-and-broom-part-1" class="section level2" number="3.16">
<h2><span class="header-section-number">3.16</span> Assessment - Tibbles, do, and broom, part 1</h2>
<ol style="list-style-type: decimal">
<li>As seen in the videos, what problem do we encounter when we try to run a linear model on our baseball data, grouping by home runs?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. There is not enough data in some levels to run the model.</li>
<li><input type="checkbox" disabled="" checked="" />
B. The <code>lm()</code> function does not know how to handle grouped tibbles.</li>
<li><input type="checkbox" disabled="" />
C. The results of the <code>lm()</code> function cannot be put into a tidy format.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Tibbles are similar to what other class in R?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. Vectors</li>
<li><input type="checkbox" disabled="" />
B. Matrices</li>
<li><input type="checkbox" disabled="" checked="" />
C. Data frames</li>
<li><input type="checkbox" disabled="" />
D. Lists</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>What are some advantages of tibbles compared to data frames?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. Tibbles display better.</li>
<li><input type="checkbox" disabled="" checked="" />
B. If you subset a tibble, you always get back a tibble.</li>
<li><input type="checkbox" disabled="" checked="" />
C. Tibbles can have complex entries.</li>
<li><input type="checkbox" disabled="" checked="" />
D. Tibbles can be grouped.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>What are two advantages of the do command, when applied to the tidyverse?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. It is faster than normal functions.</li>
<li><input type="checkbox" disabled="" />
B. It returns useful error messages.</li>
<li><input type="checkbox" disabled="" checked="" />
C. It understands grouped tibbles.</li>
<li><input type="checkbox" disabled="" checked="" />
D. It always returns a data.frame.</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>You want to take the tibble <code>dat</code>, which we used in the video on the <code>do()</code> function, and run the linear model R ~ BB for each strata of HR. Then you want to add three new columns to your grouped tibble: the coefficient, standard error, and p-value for the BB term in the model.</li>
</ol>
<p>You’ve already written the function <code>get_slope()</code>, shown below.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="section-2-linear-models-overview.html#cb204-1" aria-hidden="true"></a>get_slope &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</span>
<span id="cb204-2"><a href="section-2-linear-models-overview.html#cb204-2" aria-hidden="true"></a>  fit &lt;-<span class="st"> </span><span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB, <span class="dt">data =</span> data)</span>
<span id="cb204-3"><a href="section-2-linear-models-overview.html#cb204-3" aria-hidden="true"></a>  sum.fit &lt;-<span class="st"> </span><span class="kw">summary</span>(fit)</span>
<span id="cb204-4"><a href="section-2-linear-models-overview.html#cb204-4" aria-hidden="true"></a></span>
<span id="cb204-5"><a href="section-2-linear-models-overview.html#cb204-5" aria-hidden="true"></a>  <span class="kw">data.frame</span>(<span class="dt">slope =</span> sum.fit<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="st">&quot;Estimate&quot;</span>], </span>
<span id="cb204-6"><a href="section-2-linear-models-overview.html#cb204-6" aria-hidden="true"></a>             <span class="dt">se =</span> sum.fit<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="st">&quot;Std. Error&quot;</span>],</span>
<span id="cb204-7"><a href="section-2-linear-models-overview.html#cb204-7" aria-hidden="true"></a>             <span class="dt">pvalue =</span> sum.fit<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="st">&quot;Pr(&gt;|t|)&quot;</span>])</span>
<span id="cb204-8"><a href="section-2-linear-models-overview.html#cb204-8" aria-hidden="true"></a>}</span></code></pre></div>
<p>What additional code could you write to accomplish your goal?</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="section-2-linear-models-overview.html#cb205-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb205-2"><a href="section-2-linear-models-overview.html#cb205-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb205-3"><a href="section-2-linear-models-overview.html#cb205-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="kw">get_slope</span>(.))</span></code></pre></div>
<pre><code>## # A tibble: 9 x 4
## # Groups:   HR [9]
##      HR slope     se   pvalue
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
## 1   0.4 0.734 0.208  1.54e- 3
## 2   0.5 0.566 0.110  3.02e- 6
## 3   0.6 0.412 0.0974 4.80e- 5
## 4   0.7 0.285 0.0705 7.93e- 5
## 5   0.8 0.365 0.0653 9.13e- 8
## 6   0.9 0.261 0.0751 6.85e- 4
## 7   1   0.512 0.0751 3.28e-10
## 8   1.1 0.454 0.0855 1.03e- 6
## 9   1.2 0.440 0.0801 1.07e- 6</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A.</li>
</ul>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="section-2-linear-models-overview.html#cb207-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb207-2"><a href="section-2-linear-models-overview.html#cb207-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb207-3"><a href="section-2-linear-models-overview.html#cb207-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(get_slope)</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
B.</li>
</ul>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="section-2-linear-models-overview.html#cb208-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb208-2"><a href="section-2-linear-models-overview.html#cb208-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb208-3"><a href="section-2-linear-models-overview.html#cb208-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="kw">get_slope</span>(.))</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
C.</li>
</ul>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="section-2-linear-models-overview.html#cb209-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb209-2"><a href="section-2-linear-models-overview.html#cb209-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(HR) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb209-3"><a href="section-2-linear-models-overview.html#cb209-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="dt">slope =</span> <span class="kw">get_slope</span>(.))</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
D.</li>
</ul>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="section-2-linear-models-overview.html#cb210-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb210-2"><a href="section-2-linear-models-overview.html#cb210-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="kw">get_slope</span>(.))</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>The output of a broom function is always what?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. A data.frame</li>
<li><input type="checkbox" disabled="" />
B. A list</li>
<li><input type="checkbox" disabled="" />
C. A vector</li>
</ul>
<ol start="7" style="list-style-type: decimal">
<li>You want to know whether the relationship between home runs and runs per game varies by baseball league.</li>
</ol>
<p>You create the following dataset:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="section-2-linear-models-overview.html#cb211-1" aria-hidden="true"></a>dat &lt;-<span class="st"> </span>Teams <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1961</span><span class="op">:</span><span class="dv">2001</span>) <span class="op">%&gt;%</span></span>
<span id="cb211-2"><a href="section-2-linear-models-overview.html#cb211-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">HR =</span> HR<span class="op">/</span>G,</span>
<span id="cb211-3"><a href="section-2-linear-models-overview.html#cb211-3" aria-hidden="true"></a>         <span class="dt">R =</span> R<span class="op">/</span>G) <span class="op">%&gt;%</span></span>
<span id="cb211-4"><a href="section-2-linear-models-overview.html#cb211-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(lgID, HR, BB, R)</span></code></pre></div>
<p>What code would help you quickly answer this question?</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="section-2-linear-models-overview.html#cb212-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb212-2"><a href="section-2-linear-models-overview.html#cb212-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(lgID) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb212-3"><a href="section-2-linear-models-overview.html#cb212-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>HR, <span class="dt">data =</span> .), <span class="dt">conf.int =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb212-4"><a href="section-2-linear-models-overview.html#cb212-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;HR&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 8
## # Groups:   lgID [2]
##   lgID  term  estimate std.error statistic  p.value conf.low conf.high
##   &lt;fct&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 AL    HR        1.90    0.0734      25.9 1.29e-95     1.75      2.04
## 2 NL    HR        1.76    0.0671      26.2 1.16e-95     1.62      1.89</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A.</li>
</ul>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="section-2-linear-models-overview.html#cb214-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb214-2"><a href="section-2-linear-models-overview.html#cb214-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(lgID) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb214-3"><a href="section-2-linear-models-overview.html#cb214-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>HR, <span class="dt">data =</span> .), <span class="dt">conf.int =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb214-4"><a href="section-2-linear-models-overview.html#cb214-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;HR&quot;</span>)</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
B.</li>
</ul>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="section-2-linear-models-overview.html#cb215-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb215-2"><a href="section-2-linear-models-overview.html#cb215-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(lgID) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb215-3"><a href="section-2-linear-models-overview.html#cb215-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="kw">glance</span>(<span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>HR, <span class="dt">data =</span> .)))</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
C.</li>
</ul>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="section-2-linear-models-overview.html#cb216-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb216-2"><a href="section-2-linear-models-overview.html#cb216-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>HR, <span class="dt">data =</span> .), <span class="dt">conf.int =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb216-3"><a href="section-2-linear-models-overview.html#cb216-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;HR&quot;</span>)</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
D.</li>
</ul>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="section-2-linear-models-overview.html#cb217-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb217-2"><a href="section-2-linear-models-overview.html#cb217-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(lgID) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb217-3"><a href="section-2-linear-models-overview.html#cb217-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="dt">mod =</span> <span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>HR, <span class="dt">data =</span> .))</span></code></pre></div>
</div>
<div id="assessment---tibbles-do-and-broom-part-2" class="section level2" number="3.17">
<h2><span class="header-section-number">3.17</span> Assessment - Tibbles, do, and broom, part 2</h2>
<p>We have investigated the relationship between fathers’ heights and sons’ heights. But what about other parent-child relationships? Does one parent’s height have a stronger association with child height? How does the child’s gender affect this relationship in heights? Are any differences that we observe statistically significant?</p>
<p>The <code>galton</code> dataset is a sample of one male and one female child from each family in the <code>GaltonFamilies</code> dataset. The <code>pair</code> column denotes whether the pair is father and daughter, father and son, mother and daughter, or mother and son.</p>
<p>Create the <code>galton</code> dataset using the code below:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="section-2-linear-models-overview.html#cb218-1" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;GaltonFamilies&quot;</span>)</span>
<span id="cb218-2"><a href="section-2-linear-models-overview.html#cb218-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>) <span class="co"># if you are using R 3.5 or earlier</span></span>
<span id="cb218-3"><a href="section-2-linear-models-overview.html#cb218-3" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if you are using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="section-2-linear-models-overview.html#cb220-1" aria-hidden="true"></a>galton &lt;-<span class="st"> </span>GaltonFamilies <span class="op">%&gt;%</span></span>
<span id="cb220-2"><a href="section-2-linear-models-overview.html#cb220-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(family, gender) <span class="op">%&gt;%</span></span>
<span id="cb220-3"><a href="section-2-linear-models-overview.html#cb220-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">sample_n</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb220-4"><a href="section-2-linear-models-overview.html#cb220-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb220-5"><a href="section-2-linear-models-overview.html#cb220-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">gather</span>(parent, parentHeight, father<span class="op">:</span>mother) <span class="op">%&gt;%</span></span>
<span id="cb220-6"><a href="section-2-linear-models-overview.html#cb220-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">child =</span> <span class="kw">ifelse</span>(gender <span class="op">==</span><span class="st"> &quot;female&quot;</span>, <span class="st">&quot;daughter&quot;</span>, <span class="st">&quot;son&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb220-7"><a href="section-2-linear-models-overview.html#cb220-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">unite</span>(pair, <span class="kw">c</span>(<span class="st">&quot;parent&quot;</span>, <span class="st">&quot;child&quot;</span>))</span>
<span id="cb220-8"><a href="section-2-linear-models-overview.html#cb220-8" aria-hidden="true"></a></span>
<span id="cb220-9"><a href="section-2-linear-models-overview.html#cb220-9" aria-hidden="true"></a>galton</span></code></pre></div>
<pre><code>## # A tibble: 710 x 8
##    family midparentHeight children childNum gender childHeight pair            parentHeight
##    &lt;fct&gt;            &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt; &lt;fct&gt;        &lt;dbl&gt; &lt;chr&gt;                  &lt;dbl&gt;
##  1 001               75.4        4        2 female        69.2 father_daughter         78.5
##  2 001               75.4        4        1 male          73.2 father_son              78.5
##  3 002               73.7        4        4 female        65.5 father_daughter         75.5
##  4 002               73.7        4        2 male          72.5 father_son              75.5
##  5 003               72.1        2        2 female        68   father_daughter         75  
##  6 003               72.1        2        1 male          71   father_son              75  
##  7 004               72.1        5        5 female        63   father_daughter         75  
##  8 004               72.1        5        2 male          68.5 father_son              75  
##  9 005               69.1        6        5 female        62.5 father_daughter         75  
## 10 005               69.1        6        1 male          72   father_son              75  
## # … with 700 more rows</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Group by <code>pair</code> and summarize the number of observations in each group.</li>
</ol>
<p>How many father-daughter pairs are in the dataset?</p>
<p>How many mother-son pairs are in the dataset?</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="section-2-linear-models-overview.html#cb222-1" aria-hidden="true"></a>galton <span class="op">%&gt;%</span></span>
<span id="cb222-2"><a href="section-2-linear-models-overview.html#cb222-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(pair) <span class="op">%&gt;%</span></span>
<span id="cb222-3"><a href="section-2-linear-models-overview.html#cb222-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>())</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 4 x 2
##   pair                n
##   &lt;chr&gt;           &lt;int&gt;
## 1 father_daughter   176
## 2 father_son        179
## 3 mother_daughter   176
## 4 mother_son        179</code></pre>
<ol start="9" style="list-style-type: decimal">
<li>Calculate the correlation coefficients for fathers and daughters, fathers and sons, mothers and daughters and mothers and sons.</li>
</ol>
<p>Which pair has the <strong>strongest</strong> correlation in heights?</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="section-2-linear-models-overview.html#cb225-1" aria-hidden="true"></a>galton <span class="op">%&gt;%</span></span>
<span id="cb225-2"><a href="section-2-linear-models-overview.html#cb225-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(pair) <span class="op">%&gt;%</span></span>
<span id="cb225-3"><a href="section-2-linear-models-overview.html#cb225-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">cor =</span> <span class="kw">cor</span>(parentHeight, childHeight)) <span class="op">%&gt;%</span></span>
<span id="cb225-4"><a href="section-2-linear-models-overview.html#cb225-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(cor <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(cor))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 1 x 2
##   pair         cor
##   &lt;chr&gt;      &lt;dbl&gt;
## 1 father_son 0.430</code></pre>
<p>Which pair has the <strong>weakest</strong> correlation in heights?</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="section-2-linear-models-overview.html#cb228-1" aria-hidden="true"></a>galton <span class="op">%&gt;%</span></span>
<span id="cb228-2"><a href="section-2-linear-models-overview.html#cb228-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(pair) <span class="op">%&gt;%</span></span>
<span id="cb228-3"><a href="section-2-linear-models-overview.html#cb228-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">cor =</span> <span class="kw">cor</span>(parentHeight, childHeight)) <span class="op">%&gt;%</span></span>
<span id="cb228-4"><a href="section-2-linear-models-overview.html#cb228-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(cor <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(cor))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 1 x 2
##   pair         cor
##   &lt;chr&gt;      &lt;dbl&gt;
## 1 mother_son 0.343</code></pre>
<p>Question 10 has two parts. The information here applies to both parts.</p>
<p>Use <code>lm()</code> and the <strong>broom</strong> package to fit regression lines for each parent-child pair type. Compute the least squares estimates, standard errors, confidence intervals and p-values for the <code>parentHeight</code> coefficient for each pair.</p>
<p>10a. What is the estimate of the father-daughter coefficient?</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="section-2-linear-models-overview.html#cb231-1" aria-hidden="true"></a>galton <span class="op">%&gt;%</span></span>
<span id="cb231-2"><a href="section-2-linear-models-overview.html#cb231-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(pair) <span class="op">%&gt;%</span></span>
<span id="cb231-3"><a href="section-2-linear-models-overview.html#cb231-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(childHeight <span class="op">~</span><span class="st"> </span>parentHeight, <span class="dt">data =</span> .), <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb231-4"><a href="section-2-linear-models-overview.html#cb231-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;parentHeight&quot;</span>, pair <span class="op">==</span><span class="st"> &quot;father_daughter&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb231-5"><a href="section-2-linear-models-overview.html#cb231-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">pull</span>(estimate)</span></code></pre></div>
<pre><code>## [1] 0.345</code></pre>
<p>For every 1-inch increase in mother’s height, how many inches does the typical son’s height increase?</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="section-2-linear-models-overview.html#cb233-1" aria-hidden="true"></a>galton <span class="op">%&gt;%</span></span>
<span id="cb233-2"><a href="section-2-linear-models-overview.html#cb233-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(pair) <span class="op">%&gt;%</span></span>
<span id="cb233-3"><a href="section-2-linear-models-overview.html#cb233-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(childHeight <span class="op">~</span><span class="st"> </span>parentHeight, <span class="dt">data =</span> .), <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb233-4"><a href="section-2-linear-models-overview.html#cb233-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;parentHeight&quot;</span>, pair <span class="op">==</span><span class="st"> &quot;mother_son&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb233-5"><a href="section-2-linear-models-overview.html#cb233-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">pull</span>(estimate)</span></code></pre></div>
<pre><code>## [1] 0.381</code></pre>
<p>10b. Which sets of parent-child heights are significantly correlated at a p-value cut off of .05?</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="section-2-linear-models-overview.html#cb235-1" aria-hidden="true"></a>galton <span class="op">%&gt;%</span></span>
<span id="cb235-2"><a href="section-2-linear-models-overview.html#cb235-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(pair) <span class="op">%&gt;%</span></span>
<span id="cb235-3"><a href="section-2-linear-models-overview.html#cb235-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(childHeight <span class="op">~</span><span class="st"> </span>parentHeight, <span class="dt">data =</span> .), <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb235-4"><a href="section-2-linear-models-overview.html#cb235-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;parentHeight&quot;</span> <span class="op">&amp;</span><span class="st"> </span>p.value <span class="op">&lt;</span><span class="st"> </span><span class="fl">.05</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 8
## # Groups:   pair [4]
##   pair            term         estimate std.error statistic       p.value conf.low conf.high
##   &lt;chr&gt;           &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 father_daughter parentHeight    0.345    0.0599      5.77 0.0000000356     0.227     0.464
## 2 father_son      parentHeight    0.443    0.0700      6.33 0.00000000194    0.305     0.581
## 3 mother_daughter parentHeight    0.394    0.0720      5.47 0.000000156      0.252     0.536
## 4 mother_son      parentHeight    0.381    0.0784      4.86 0.00000259       0.226     0.535</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. father-daughter</li>
<li><input type="checkbox" disabled="" checked="" />
B. father-son</li>
<li><input type="checkbox" disabled="" checked="" />
C. mother-daughter</li>
<li><input type="checkbox" disabled="" checked="" />
D. mother-son</li>
</ul>
<p>Which of the following statements are true?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. All of the confidence intervals overlap each other.</li>
<li><input type="checkbox" disabled="" />
B. At least one confidence interval covers zero.</li>
<li><input type="checkbox" disabled="" checked="" />
C. The confidence intervals involving mothers’ heights are larger than the confidence intervals involving fathers’ heights.</li>
<li><input type="checkbox" disabled="" />
D. The confidence intervals involving daughters’ heights are larger than the confidence intervals involving sons’ heights.</li>
<li><input type="checkbox" disabled="" checked="" />
E. The data are consistent with inheritance of height being independent of the child’s gender.</li>
<li><input type="checkbox" disabled="" checked="" />
F. The data are consistent with inheritance of height being independent of the parent’s gender.</li>
</ul>
</div>
<div id="building-a-better-offensive-metric-for-baseball" class="section level2" number="3.18">
<h2><span class="header-section-number">3.18</span> Building a Better Offensive Metric for Baseball</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/linear-models.html#case-study-moneyball-continued" target="_blank">here</a></p>
<p><em>Code</em></p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="section-2-linear-models-overview.html#cb237-1" aria-hidden="true"></a><span class="co"># linear regression with two variables</span></span>
<span id="cb237-2"><a href="section-2-linear-models-overview.html#cb237-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span>Teams <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb237-3"><a href="section-2-linear-models-overview.html#cb237-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1961</span><span class="op">:</span><span class="dv">2001</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb237-4"><a href="section-2-linear-models-overview.html#cb237-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">BB =</span> BB<span class="op">/</span>G, <span class="dt">HR =</span> HR<span class="op">/</span>G,  <span class="dt">R =</span> R<span class="op">/</span>G) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb237-5"><a href="section-2-linear-models-overview.html#cb237-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB <span class="op">+</span><span class="st"> </span>HR, <span class="dt">data =</span> .)</span>
<span id="cb237-6"><a href="section-2-linear-models-overview.html#cb237-6" aria-hidden="true"></a>  <span class="kw">tidy</span>(fit, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 7
##   term        estimate std.error statistic   p.value conf.low conf.high
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)    1.74     0.0824      21.2 7.62e- 83    1.58      1.91 
## 2 BB             0.387    0.0270      14.3 1.20e- 42    0.334     0.440
## 3 HR             1.56     0.0490      31.9 1.78e-155    1.47      1.66</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="section-2-linear-models-overview.html#cb239-1" aria-hidden="true"></a><span class="co"># regression with BB, singles, doubles, triples, HR</span></span>
<span id="cb239-2"><a href="section-2-linear-models-overview.html#cb239-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span>Teams <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb239-3"><a href="section-2-linear-models-overview.html#cb239-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1961</span><span class="op">:</span><span class="dv">2001</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb239-4"><a href="section-2-linear-models-overview.html#cb239-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">BB =</span> BB <span class="op">/</span><span class="st"> </span>G, </span>
<span id="cb239-5"><a href="section-2-linear-models-overview.html#cb239-5" aria-hidden="true"></a>         <span class="dt">singles =</span> (H <span class="op">-</span><span class="st"> </span>X2B <span class="op">-</span><span class="st"> </span>X3B <span class="op">-</span><span class="st"> </span>HR) <span class="op">/</span><span class="st"> </span>G, </span>
<span id="cb239-6"><a href="section-2-linear-models-overview.html#cb239-6" aria-hidden="true"></a>         <span class="dt">doubles =</span> X2B <span class="op">/</span><span class="st"> </span>G, </span>
<span id="cb239-7"><a href="section-2-linear-models-overview.html#cb239-7" aria-hidden="true"></a>         <span class="dt">triples =</span> X3B <span class="op">/</span><span class="st"> </span>G, </span>
<span id="cb239-8"><a href="section-2-linear-models-overview.html#cb239-8" aria-hidden="true"></a>         <span class="dt">HR =</span> HR <span class="op">/</span><span class="st"> </span>G,</span>
<span id="cb239-9"><a href="section-2-linear-models-overview.html#cb239-9" aria-hidden="true"></a>         <span class="dt">R =</span> R <span class="op">/</span><span class="st"> </span>G) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb239-10"><a href="section-2-linear-models-overview.html#cb239-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB <span class="op">+</span><span class="st"> </span>singles <span class="op">+</span><span class="st"> </span>doubles <span class="op">+</span><span class="st"> </span>triples <span class="op">+</span><span class="st"> </span>HR, <span class="dt">data =</span> .)</span>
<span id="cb239-11"><a href="section-2-linear-models-overview.html#cb239-11" aria-hidden="true"></a>coefs &lt;-<span class="st"> </span><span class="kw">tidy</span>(fit, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span>
<span id="cb239-12"><a href="section-2-linear-models-overview.html#cb239-12" aria-hidden="true"></a>coefs</span></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##   term        estimate std.error statistic   p.value conf.low conf.high
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)   -2.77     0.0862     -32.1 4.76e-157   -2.94     -2.60 
## 2 BB             0.371    0.0117      31.6 1.87e-153    0.348     0.394
## 3 singles        0.519    0.0127      40.8 8.67e-217    0.494     0.544
## 4 doubles        0.771    0.0226      34.1 8.44e-171    0.727     0.816
## 5 triples        1.24     0.0768      16.1 2.12e- 52    1.09      1.39 
## 6 HR             1.44     0.0243      59.3 0.           1.40      1.49</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="section-2-linear-models-overview.html#cb241-1" aria-hidden="true"></a><span class="co"># predict number of runs for each team in 2002 and plot</span></span>
<span id="cb241-2"><a href="section-2-linear-models-overview.html#cb241-2" aria-hidden="true"></a>Teams <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb241-3"><a href="section-2-linear-models-overview.html#cb241-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">2002</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb241-4"><a href="section-2-linear-models-overview.html#cb241-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">BB =</span> BB<span class="op">/</span>G, </span>
<span id="cb241-5"><a href="section-2-linear-models-overview.html#cb241-5" aria-hidden="true"></a>         <span class="dt">singles =</span> (H<span class="op">-</span>X2B<span class="op">-</span>X3B<span class="op">-</span>HR)<span class="op">/</span>G, </span>
<span id="cb241-6"><a href="section-2-linear-models-overview.html#cb241-6" aria-hidden="true"></a>         <span class="dt">doubles =</span> X2B<span class="op">/</span>G, </span>
<span id="cb241-7"><a href="section-2-linear-models-overview.html#cb241-7" aria-hidden="true"></a>         <span class="dt">triples =</span>X3B<span class="op">/</span>G, </span>
<span id="cb241-8"><a href="section-2-linear-models-overview.html#cb241-8" aria-hidden="true"></a>         <span class="dt">HR=</span>HR<span class="op">/</span>G,</span>
<span id="cb241-9"><a href="section-2-linear-models-overview.html#cb241-9" aria-hidden="true"></a>         <span class="dt">R=</span>R<span class="op">/</span>G)  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb241-10"><a href="section-2-linear-models-overview.html#cb241-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">R_hat =</span> <span class="kw">predict</span>(fit, <span class="dt">newdata =</span> .)) <span class="op">%&gt;%</span></span>
<span id="cb241-11"><a href="section-2-linear-models-overview.html#cb241-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(R_hat, R, <span class="dt">label =</span> teamID)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb241-12"><a href="section-2-linear-models-overview.html#cb241-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb241-13"><a href="section-2-linear-models-overview.html#cb241-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">nudge_x=</span><span class="fl">0.1</span>, <span class="dt">cex =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb241-14"><a href="section-2-linear-models-overview.html#cb241-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_abline</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-92-1.png" width="672" /></p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="section-2-linear-models-overview.html#cb242-1" aria-hidden="true"></a><span class="co"># average number of team plate appearances per game</span></span>
<span id="cb242-2"><a href="section-2-linear-models-overview.html#cb242-2" aria-hidden="true"></a>pa_per_game &lt;-<span class="st"> </span>Batting <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yearID <span class="op">==</span><span class="st"> </span><span class="dv">2002</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb242-3"><a href="section-2-linear-models-overview.html#cb242-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(teamID) <span class="op">%&gt;%</span></span>
<span id="cb242-4"><a href="section-2-linear-models-overview.html#cb242-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">pa_per_game =</span> <span class="kw">sum</span>(AB<span class="op">+</span>BB)<span class="op">/</span><span class="kw">max</span>(G)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb242-5"><a href="section-2-linear-models-overview.html#cb242-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">pull</span>(pa_per_game) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb242-6"><a href="section-2-linear-models-overview.html#cb242-6" aria-hidden="true"></a><span class="st">  </span>mean</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="section-2-linear-models-overview.html#cb244-1" aria-hidden="true"></a><span class="co"># compute per-plate-appearance rates for players available in 2002 using previous data</span></span>
<span id="cb244-2"><a href="section-2-linear-models-overview.html#cb244-2" aria-hidden="true"></a>players &lt;-<span class="st"> </span>Batting <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1999</span><span class="op">:</span><span class="dv">2001</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb244-3"><a href="section-2-linear-models-overview.html#cb244-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></span>
<span id="cb244-4"><a href="section-2-linear-models-overview.html#cb244-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">PA =</span> BB <span class="op">+</span><span class="st"> </span>AB) <span class="op">%&gt;%</span></span>
<span id="cb244-5"><a href="section-2-linear-models-overview.html#cb244-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">G =</span> <span class="kw">sum</span>(PA)<span class="op">/</span>pa_per_game,</span>
<span id="cb244-6"><a href="section-2-linear-models-overview.html#cb244-6" aria-hidden="true"></a>    <span class="dt">BB =</span> <span class="kw">sum</span>(BB)<span class="op">/</span>G,</span>
<span id="cb244-7"><a href="section-2-linear-models-overview.html#cb244-7" aria-hidden="true"></a>    <span class="dt">singles =</span> <span class="kw">sum</span>(H<span class="op">-</span>X2B<span class="op">-</span>X3B<span class="op">-</span>HR)<span class="op">/</span>G,</span>
<span id="cb244-8"><a href="section-2-linear-models-overview.html#cb244-8" aria-hidden="true"></a>    <span class="dt">doubles =</span> <span class="kw">sum</span>(X2B)<span class="op">/</span>G, </span>
<span id="cb244-9"><a href="section-2-linear-models-overview.html#cb244-9" aria-hidden="true"></a>    <span class="dt">triples =</span> <span class="kw">sum</span>(X3B)<span class="op">/</span>G, </span>
<span id="cb244-10"><a href="section-2-linear-models-overview.html#cb244-10" aria-hidden="true"></a>    <span class="dt">HR =</span> <span class="kw">sum</span>(HR)<span class="op">/</span>G,</span>
<span id="cb244-11"><a href="section-2-linear-models-overview.html#cb244-11" aria-hidden="true"></a>    <span class="dt">AVG =</span> <span class="kw">sum</span>(H)<span class="op">/</span><span class="kw">sum</span>(AB),</span>
<span id="cb244-12"><a href="section-2-linear-models-overview.html#cb244-12" aria-hidden="true"></a>    <span class="dt">PA =</span> <span class="kw">sum</span>(PA)) <span class="op">%&gt;%</span></span>
<span id="cb244-13"><a href="section-2-linear-models-overview.html#cb244-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(PA <span class="op">&gt;=</span><span class="st"> </span><span class="dv">300</span>) <span class="op">%&gt;%</span></span>
<span id="cb244-14"><a href="section-2-linear-models-overview.html#cb244-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>G) <span class="op">%&gt;%</span></span>
<span id="cb244-15"><a href="section-2-linear-models-overview.html#cb244-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">R_hat =</span> <span class="kw">predict</span>(fit, <span class="dt">newdata =</span> .))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="section-2-linear-models-overview.html#cb246-1" aria-hidden="true"></a><span class="co"># plot player-specific predicted runs</span></span>
<span id="cb246-2"><a href="section-2-linear-models-overview.html#cb246-2" aria-hidden="true"></a><span class="kw">qplot</span>(R_hat, <span class="dt">data =</span> players, <span class="dt">geom =</span> <span class="st">&quot;histogram&quot;</span>, <span class="dt">binwidth =</span> <span class="fl">0.5</span>, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>))</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-92-2.png" width="672" /></p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="section-2-linear-models-overview.html#cb247-1" aria-hidden="true"></a><span class="co"># add 2002 salary of each player</span></span>
<span id="cb247-2"><a href="section-2-linear-models-overview.html#cb247-2" aria-hidden="true"></a>players &lt;-<span class="st"> </span>Salaries <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb247-3"><a href="section-2-linear-models-overview.html#cb247-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(yearID <span class="op">==</span><span class="st"> </span><span class="dv">2002</span>) <span class="op">%&gt;%</span></span>
<span id="cb247-4"><a href="section-2-linear-models-overview.html#cb247-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(playerID, salary) <span class="op">%&gt;%</span></span>
<span id="cb247-5"><a href="section-2-linear-models-overview.html#cb247-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">right_join</span>(players, <span class="dt">by=</span><span class="st">&quot;playerID&quot;</span>)</span>
<span id="cb247-6"><a href="section-2-linear-models-overview.html#cb247-6" aria-hidden="true"></a>  </span>
<span id="cb247-7"><a href="section-2-linear-models-overview.html#cb247-7" aria-hidden="true"></a><span class="co"># add defensive position</span></span>
<span id="cb247-8"><a href="section-2-linear-models-overview.html#cb247-8" aria-hidden="true"></a>position_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;G_p&quot;</span>,<span class="st">&quot;G_c&quot;</span>,<span class="st">&quot;G_1b&quot;</span>,<span class="st">&quot;G_2b&quot;</span>,<span class="st">&quot;G_3b&quot;</span>,<span class="st">&quot;G_ss&quot;</span>,<span class="st">&quot;G_lf&quot;</span>,<span class="st">&quot;G_cf&quot;</span>,<span class="st">&quot;G_rf&quot;</span>)</span>
<span id="cb247-9"><a href="section-2-linear-models-overview.html#cb247-9" aria-hidden="true"></a>tmp_tab &lt;-<span class="st"> </span>Appearances <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb247-10"><a href="section-2-linear-models-overview.html#cb247-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(yearID <span class="op">==</span><span class="st"> </span><span class="dv">2002</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb247-11"><a href="section-2-linear-models-overview.html#cb247-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></span>
<span id="cb247-12"><a href="section-2-linear-models-overview.html#cb247-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize_at</span>(position_names, sum) <span class="op">%&gt;%</span></span>
<span id="cb247-13"><a href="section-2-linear-models-overview.html#cb247-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">ungroup</span>()  </span>
<span id="cb247-14"><a href="section-2-linear-models-overview.html#cb247-14" aria-hidden="true"></a>pos &lt;-<span class="st"> </span>tmp_tab <span class="op">%&gt;%</span></span>
<span id="cb247-15"><a href="section-2-linear-models-overview.html#cb247-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(position_names) <span class="op">%&gt;%</span></span>
<span id="cb247-16"><a href="section-2-linear-models-overview.html#cb247-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">apply</span>(., <span class="dv">1</span>, which.max) </span></code></pre></div>
<pre><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(position_names)` instead of `position_names` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="section-2-linear-models-overview.html#cb249-1" aria-hidden="true"></a>players &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">playerID =</span> tmp_tab<span class="op">$</span>playerID, <span class="dt">POS =</span> position_names[pos]) <span class="op">%&gt;%</span></span>
<span id="cb249-2"><a href="section-2-linear-models-overview.html#cb249-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">POS =</span> <span class="kw">str_to_upper</span>(<span class="kw">str_remove</span>(POS, <span class="st">&quot;G_&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb249-3"><a href="section-2-linear-models-overview.html#cb249-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(POS <span class="op">!=</span><span class="st"> &quot;P&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb249-4"><a href="section-2-linear-models-overview.html#cb249-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">right_join</span>(players, <span class="dt">by=</span><span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb249-5"><a href="section-2-linear-models-overview.html#cb249-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(POS)  <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(salary))</span></code></pre></div>
<pre><code>## Warning: `data_frame()` is deprecated as of tibble 1.1.0.
## Please use `tibble()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="section-2-linear-models-overview.html#cb251-1" aria-hidden="true"></a><span class="co"># add players&#39; first and last names</span></span>
<span id="cb251-2"><a href="section-2-linear-models-overview.html#cb251-2" aria-hidden="true"></a>players &lt;-<span class="st"> </span>Master <span class="op">%&gt;%</span></span>
<span id="cb251-3"><a href="section-2-linear-models-overview.html#cb251-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(playerID, nameFirst, nameLast, debut) <span class="op">%&gt;%</span></span>
<span id="cb251-4"><a href="section-2-linear-models-overview.html#cb251-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">debut =</span> <span class="kw">as.Date</span>(debut)) <span class="op">%&gt;%</span></span>
<span id="cb251-5"><a href="section-2-linear-models-overview.html#cb251-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">right_join</span>(players, <span class="dt">by=</span><span class="st">&quot;playerID&quot;</span>)</span>
<span id="cb251-6"><a href="section-2-linear-models-overview.html#cb251-6" aria-hidden="true"></a>  </span>
<span id="cb251-7"><a href="section-2-linear-models-overview.html#cb251-7" aria-hidden="true"></a><span class="co"># top 10 players</span></span>
<span id="cb251-8"><a href="section-2-linear-models-overview.html#cb251-8" aria-hidden="true"></a>players <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(nameFirst, nameLast, POS, salary, R_hat) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-9"><a href="section-2-linear-models-overview.html#cb251-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(R_hat)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-10"><a href="section-2-linear-models-overview.html#cb251-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">10</span>) </span></code></pre></div>
<pre><code>## Selecting by R_hat</code></pre>
<pre><code>##    nameFirst    nameLast POS   salary R_hat
## 1      Barry       Bonds  LF 15000000  9.05
## 2       Todd      Helton  1B  5000000  8.23
## 3      Manny     Ramirez  LF 15462727  8.20
## 4      Sammy        Sosa  RF 15000000  8.19
## 5      Larry      Walker  RF 12666667  8.15
## 6      Jason      Giambi  1B 10428571  7.99
## 7    Chipper       Jones  LF 11333333  7.64
## 8      Brian       Giles  LF  8063003  7.57
## 9     Albert      Pujols  LF   600000  7.54
## 10     Nomar Garciaparra  SS  9000000  7.51</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="section-2-linear-models-overview.html#cb254-1" aria-hidden="true"></a><span class="co"># players with a higher metric have higher salaries</span></span>
<span id="cb254-2"><a href="section-2-linear-models-overview.html#cb254-2" aria-hidden="true"></a>players <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(salary, R_hat, <span class="dt">color =</span> POS)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb254-3"><a href="section-2-linear-models-overview.html#cb254-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb254-4"><a href="section-2-linear-models-overview.html#cb254-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_log10</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-92-3.png" width="672" /></p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="section-2-linear-models-overview.html#cb255-1" aria-hidden="true"></a><span class="co"># remake plot without players that debuted after 1998</span></span>
<span id="cb255-2"><a href="section-2-linear-models-overview.html#cb255-2" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(lubridate)) <span class="kw">install.packages</span>(<span class="st">&quot;lubridate&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: lubridate</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="section-2-linear-models-overview.html#cb259-1" aria-hidden="true"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb259-2"><a href="section-2-linear-models-overview.html#cb259-2" aria-hidden="true"></a>players <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">year</span>(debut) <span class="op">&lt;</span><span class="st"> </span><span class="dv">1998</span>) <span class="op">%&gt;%</span></span>
<span id="cb259-3"><a href="section-2-linear-models-overview.html#cb259-3" aria-hidden="true"></a><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(salary, R_hat, <span class="dt">color =</span> POS)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb259-4"><a href="section-2-linear-models-overview.html#cb259-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb259-5"><a href="section-2-linear-models-overview.html#cb259-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_log10</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-92-4.png" width="672" /></p>
</div>
<div id="building-a-better-offensive-metric-for-baseball-linear-programming" class="section level2" number="3.19">
<h2><span class="header-section-number">3.19</span> Building a Better Offensive Metric for Baseball: Linear Programming</h2>
<p>A way to actually pick the players for the team can be done using what computer scientists call linear programming. Although we don’t go into this topic in detail in this course, we include the code anyway:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="section-2-linear-models-overview.html#cb260-1" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(reshape2)) <span class="kw">install.packages</span>(<span class="st">&quot;reshape2&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: reshape2</code></pre>
<pre><code>## 
## Attaching package: &#39;reshape2&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:tidyr&#39;:
## 
##     smiths</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="section-2-linear-models-overview.html#cb264-1" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(lpSolve)) <span class="kw">install.packages</span>(<span class="st">&quot;lpSolve&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: lpSolve</code></pre>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="section-2-linear-models-overview.html#cb266-1" aria-hidden="true"></a><span class="kw">library</span>(reshape2)</span>
<span id="cb266-2"><a href="section-2-linear-models-overview.html#cb266-2" aria-hidden="true"></a><span class="kw">library</span>(lpSolve)</span>
<span id="cb266-3"><a href="section-2-linear-models-overview.html#cb266-3" aria-hidden="true"></a></span>
<span id="cb266-4"><a href="section-2-linear-models-overview.html#cb266-4" aria-hidden="true"></a>players &lt;-<span class="st"> </span>players <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(debut <span class="op">&lt;=</span><span class="st"> &quot;1997-01-01&quot;</span> <span class="op">&amp;</span><span class="st"> </span>debut <span class="op">&gt;</span><span class="st"> &quot;1988-01-01&quot;</span>)</span>
<span id="cb266-5"><a href="section-2-linear-models-overview.html#cb266-5" aria-hidden="true"></a>constraint_matrix &lt;-<span class="st"> </span><span class="kw">acast</span>(players, POS <span class="op">~</span><span class="st"> </span>playerID, <span class="dt">fun.aggregate =</span> length)</span></code></pre></div>
<pre><code>## Using R_hat as value column: use value.var to override.</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="section-2-linear-models-overview.html#cb268-1" aria-hidden="true"></a>npos &lt;-<span class="st"> </span><span class="kw">nrow</span>(constraint_matrix)</span>
<span id="cb268-2"><a href="section-2-linear-models-overview.html#cb268-2" aria-hidden="true"></a>constraint_matrix &lt;-<span class="st"> </span><span class="kw">rbind</span>(constraint_matrix, <span class="dt">salary =</span> players<span class="op">$</span>salary)</span>
<span id="cb268-3"><a href="section-2-linear-models-overview.html#cb268-3" aria-hidden="true"></a>constraint_dir &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;==&quot;</span>, npos), <span class="st">&quot;&lt;=&quot;</span>)</span>
<span id="cb268-4"><a href="section-2-linear-models-overview.html#cb268-4" aria-hidden="true"></a>constraint_limit &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>, npos), <span class="dv">50</span><span class="op">*</span><span class="dv">10</span><span class="op">^</span><span class="dv">6</span>)</span>
<span id="cb268-5"><a href="section-2-linear-models-overview.html#cb268-5" aria-hidden="true"></a>lp_solution &lt;-<span class="st"> </span><span class="kw">lp</span>(<span class="st">&quot;max&quot;</span>, players<span class="op">$</span>R_hat,</span>
<span id="cb268-6"><a href="section-2-linear-models-overview.html#cb268-6" aria-hidden="true"></a>                  constraint_matrix, constraint_dir, constraint_limit,</span>
<span id="cb268-7"><a href="section-2-linear-models-overview.html#cb268-7" aria-hidden="true"></a>                  <span class="dt">all.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>This algorithm chooses these 9 players:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="section-2-linear-models-overview.html#cb269-1" aria-hidden="true"></a>our_team &lt;-<span class="st"> </span>players <span class="op">%&gt;%</span></span>
<span id="cb269-2"><a href="section-2-linear-models-overview.html#cb269-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(lp_solution<span class="op">$</span>solution <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb269-3"><a href="section-2-linear-models-overview.html#cb269-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(R_hat))</span>
<span id="cb269-4"><a href="section-2-linear-models-overview.html#cb269-4" aria-hidden="true"></a>our_team <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(nameFirst, nameLast, POS, salary, R_hat)</span></code></pre></div>
<pre><code>##   nameFirst    nameLast POS   salary R_hat
## 1     Larry      Walker  RF 12666667  8.15
## 2     Nomar Garciaparra  SS  9000000  7.51
## 3      Luis    Gonzalez  LF  4333333  7.40
## 4      Mike      Piazza   C 10571429  7.16
## 5       Jim     Edmonds  CF  7333333  6.90
## 6      Phil       Nevin  3B  2600000  6.75
## 7      Greg    Colbrunn  1B  1800000  6.44
## 8     Terry    Shumpert  2B   775000  6.04</code></pre>
<p>We note that these players all have above average BB and HR rates while the same is not true for singles.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="section-2-linear-models-overview.html#cb271-1" aria-hidden="true"></a>my_scale &lt;-<span class="st"> </span><span class="cf">function</span>(x) (x <span class="op">-</span><span class="st"> </span><span class="kw">median</span>(x))<span class="op">/</span><span class="kw">mad</span>(x)</span>
<span id="cb271-2"><a href="section-2-linear-models-overview.html#cb271-2" aria-hidden="true"></a>players <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">BB =</span> <span class="kw">my_scale</span>(BB), </span>
<span id="cb271-3"><a href="section-2-linear-models-overview.html#cb271-3" aria-hidden="true"></a>                   <span class="dt">singles =</span> <span class="kw">my_scale</span>(singles),</span>
<span id="cb271-4"><a href="section-2-linear-models-overview.html#cb271-4" aria-hidden="true"></a>                   <span class="dt">doubles =</span> <span class="kw">my_scale</span>(doubles),</span>
<span id="cb271-5"><a href="section-2-linear-models-overview.html#cb271-5" aria-hidden="true"></a>                   <span class="dt">triples =</span> <span class="kw">my_scale</span>(triples),</span>
<span id="cb271-6"><a href="section-2-linear-models-overview.html#cb271-6" aria-hidden="true"></a>                   <span class="dt">HR =</span> <span class="kw">my_scale</span>(HR),</span>
<span id="cb271-7"><a href="section-2-linear-models-overview.html#cb271-7" aria-hidden="true"></a>                   <span class="dt">AVG =</span> <span class="kw">my_scale</span>(AVG),</span>
<span id="cb271-8"><a href="section-2-linear-models-overview.html#cb271-8" aria-hidden="true"></a>                   <span class="dt">R_hat =</span> <span class="kw">my_scale</span>(R_hat)) <span class="op">%&gt;%</span></span>
<span id="cb271-9"><a href="section-2-linear-models-overview.html#cb271-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(playerID <span class="op">%in%</span><span class="st"> </span>our_team<span class="op">$</span>playerID) <span class="op">%&gt;%</span></span>
<span id="cb271-10"><a href="section-2-linear-models-overview.html#cb271-10" aria-hidden="true"></a><span class="st">    </span><span class="kw">select</span>(nameFirst, nameLast, BB, singles, doubles, triples, HR, AVG, R_hat) <span class="op">%&gt;%</span></span>
<span id="cb271-11"><a href="section-2-linear-models-overview.html#cb271-11" aria-hidden="true"></a><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(R_hat))</span></code></pre></div>
<pre><code>##   nameFirst    nameLast      BB singles doubles triples     HR   AVG R_hat
## 1     Larry      Walker  1.0605  0.6554   0.922   1.562  1.566 2.835 2.904
## 2     Nomar Garciaparra  0.0274  1.6371   3.118   0.336  0.625 3.197 2.244
## 3      Luis    Gonzalez  0.7046  0.0000   1.413   0.537  1.355 1.829 2.133
## 4      Mike      Piazza  0.3129 -0.0547  -0.242  -1.274  2.035 1.252 1.891
## 5       Jim     Edmonds  1.8074 -1.1409   0.674  -0.674  1.264 0.579 1.621
## 6      Phil       Nevin  0.4909 -0.6479   0.764  -1.098  1.548 0.728 1.463
## 7      Greg    Colbrunn  0.2703  0.6546   0.784   0.585  0.475 1.375 1.148
## 8     Terry    Shumpert -0.1576  0.1221   1.326   3.908 -0.123 0.859 0.744</code></pre>
</div>
<div id="on-base-plus-slugging-ops" class="section level2" number="3.20">
<h2><span class="header-section-number">3.20</span> On Base Plus Slugging (OPS)</h2>
<p><strong>Key point</strong></p>
<p>The on-base-percentage plus slugging percentage (OPS) metric is:</p>
<p><span class="math inline">\(\frac{\mbox{BB}}{\mbox{PA}} + \frac{(\mbox{Singles} + 2\mbox{Doubles} + 3\mbox{Triples} + 4\mbox{HR})}{\mbox{AB}}\)</span></p>
</div>
<div id="regression-fallacy" class="section level2" number="3.21">
<h2><span class="header-section-number">3.21</span> Regression Fallacy</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/linear-models.html#the-regression-fallacy" target="_blank">here</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>Regression can bring about errors in reasoning, especially when interpreting individual observations.</li>
<li>The example showed in the video demonstrates that the <strong>“sophomore slump”</strong> observed in the data is caused by regressing to the mean.</li>
</ul>
<p><em>Code</em></p>
<p>The code to create a table with player ID, their names, and their most played position:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="section-2-linear-models-overview.html#cb273-1" aria-hidden="true"></a>playerInfo &lt;-<span class="st"> </span>Fielding <span class="op">%&gt;%</span></span>
<span id="cb273-2"><a href="section-2-linear-models-overview.html#cb273-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></span>
<span id="cb273-3"><a href="section-2-linear-models-overview.html#cb273-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(G)) <span class="op">%&gt;%</span></span>
<span id="cb273-4"><a href="section-2-linear-models-overview.html#cb273-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb273-5"><a href="section-2-linear-models-overview.html#cb273-5" aria-hidden="true"></a><span class="st">    </span>ungroup <span class="op">%&gt;%</span></span>
<span id="cb273-6"><a href="section-2-linear-models-overview.html#cb273-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">left_join</span>(Master, <span class="dt">by=</span><span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb273-7"><a href="section-2-linear-models-overview.html#cb273-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">select</span>(playerID, nameFirst, nameLast, POS)</span></code></pre></div>
<p>The code to create a table with only the ROY award winners and add their batting statistics:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="section-2-linear-models-overview.html#cb274-1" aria-hidden="true"></a>ROY &lt;-<span class="st"> </span>AwardsPlayers <span class="op">%&gt;%</span></span>
<span id="cb274-2"><a href="section-2-linear-models-overview.html#cb274-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(awardID <span class="op">==</span><span class="st"> &quot;Rookie of the Year&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb274-3"><a href="section-2-linear-models-overview.html#cb274-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">left_join</span>(playerInfo, <span class="dt">by=</span><span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb274-4"><a href="section-2-linear-models-overview.html#cb274-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">rookie_year =</span> yearID) <span class="op">%&gt;%</span></span>
<span id="cb274-5"><a href="section-2-linear-models-overview.html#cb274-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">right_join</span>(Batting, <span class="dt">by=</span><span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb274-6"><a href="section-2-linear-models-overview.html#cb274-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">AVG =</span> H<span class="op">/</span>AB) <span class="op">%&gt;%</span></span>
<span id="cb274-7"><a href="section-2-linear-models-overview.html#cb274-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(POS <span class="op">!=</span><span class="st"> &quot;P&quot;</span>)</span></code></pre></div>
<p>The code to keep only the rookie and sophomore seasons and remove players who did not play sophomore seasons:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="section-2-linear-models-overview.html#cb275-1" aria-hidden="true"></a>ROY &lt;-<span class="st"> </span>ROY <span class="op">%&gt;%</span></span>
<span id="cb275-2"><a href="section-2-linear-models-overview.html#cb275-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(yearID <span class="op">==</span><span class="st"> </span>rookie_year <span class="op">|</span><span class="st"> </span>yearID <span class="op">==</span><span class="st"> </span>rookie_year<span class="op">+</span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb275-3"><a href="section-2-linear-models-overview.html#cb275-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></span>
<span id="cb275-4"><a href="section-2-linear-models-overview.html#cb275-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">rookie =</span> <span class="kw">ifelse</span>(yearID <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(yearID), <span class="st">&quot;rookie&quot;</span>, <span class="st">&quot;sophomore&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb275-5"><a href="section-2-linear-models-overview.html#cb275-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></span>
<span id="cb275-6"><a href="section-2-linear-models-overview.html#cb275-6" aria-hidden="true"></a><span class="st">    </span>ungroup <span class="op">%&gt;%</span></span>
<span id="cb275-7"><a href="section-2-linear-models-overview.html#cb275-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">select</span>(playerID, rookie_year, rookie, nameFirst, nameLast, AVG)</span></code></pre></div>
<p>The code to use the spread function to have one column for the rookie and sophomore years batting averages:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="section-2-linear-models-overview.html#cb276-1" aria-hidden="true"></a>ROY &lt;-<span class="st"> </span>ROY <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">spread</span>(rookie, AVG) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(rookie))</span>
<span id="cb276-2"><a href="section-2-linear-models-overview.html#cb276-2" aria-hidden="true"></a>ROY</span></code></pre></div>
<pre><code>## # A tibble: 102 x 6
##    playerID  rookie_year nameFirst nameLast rookie sophomore
##    &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 mccovwi01        1959 Willie    McCovey   0.354     0.238
##  2 suzukic01        2001 Ichiro    Suzuki    0.350     0.321
##  3 bumbral01        1973 Al        Bumbry    0.337     0.233
##  4 lynnfr01         1975 Fred      Lynn      0.331     0.314
##  5 pujolal01        2001 Albert    Pujols    0.329     0.314
##  6 troutmi01        2012 Mike      Trout     0.326     0.323
##  7 braunry02        2007 Ryan      Braun     0.324     0.285
##  8 olivato01        1964 Tony      Oliva     0.323     0.321
##  9 hargrmi01        1974 Mike      Hargrove  0.323     0.303
## 10 darkal01         1948 Al        Dark      0.322     0.276
## # … with 92 more rows</code></pre>
<p>The code to calculate the proportion of players who have a lower batting average their sophomore year:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="section-2-linear-models-overview.html#cb278-1" aria-hidden="true"></a><span class="kw">mean</span>(ROY<span class="op">$</span>sophomore <span class="op">-</span><span class="st"> </span>ROY<span class="op">$</span>rookie <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 0.686</code></pre>
<p>The code to do the similar analysis on all players that played the 2013 and 2014 seasons and batted more than 130 times (minimum to win Rookie of the Year):</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="section-2-linear-models-overview.html#cb280-1" aria-hidden="true"></a>two_years &lt;-<span class="st"> </span>Batting <span class="op">%&gt;%</span></span>
<span id="cb280-2"><a href="section-2-linear-models-overview.html#cb280-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">2013</span><span class="op">:</span><span class="dv">2014</span>) <span class="op">%&gt;%</span></span>
<span id="cb280-3"><a href="section-2-linear-models-overview.html#cb280-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(playerID, yearID) <span class="op">%&gt;%</span></span>
<span id="cb280-4"><a href="section-2-linear-models-overview.html#cb280-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(<span class="kw">sum</span>(AB) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">130</span>) <span class="op">%&gt;%</span></span>
<span id="cb280-5"><a href="section-2-linear-models-overview.html#cb280-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">AVG =</span> <span class="kw">sum</span>(H)<span class="op">/</span><span class="kw">sum</span>(AB)) <span class="op">%&gt;%</span></span>
<span id="cb280-6"><a href="section-2-linear-models-overview.html#cb280-6" aria-hidden="true"></a><span class="st">    </span>ungroup <span class="op">%&gt;%</span></span>
<span id="cb280-7"><a href="section-2-linear-models-overview.html#cb280-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">spread</span>(yearID, AVG) <span class="op">%&gt;%</span></span>
<span id="cb280-8"><a href="section-2-linear-models-overview.html#cb280-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(<span class="st">`</span><span class="dt">2013</span><span class="st">`</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(<span class="st">`</span><span class="dt">2014</span><span class="st">`</span>)) <span class="op">%&gt;%</span></span>
<span id="cb280-9"><a href="section-2-linear-models-overview.html#cb280-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">left_join</span>(playerInfo, <span class="dt">by=</span><span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb280-10"><a href="section-2-linear-models-overview.html#cb280-10" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(POS<span class="op">!=</span><span class="st">&quot;P&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb280-11"><a href="section-2-linear-models-overview.html#cb280-11" aria-hidden="true"></a><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>POS) <span class="op">%&gt;%</span></span>
<span id="cb280-12"><a href="section-2-linear-models-overview.html#cb280-12" aria-hidden="true"></a><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(<span class="st">`</span><span class="dt">2013</span><span class="st">`</span>)) <span class="op">%&gt;%</span></span>
<span id="cb280-13"><a href="section-2-linear-models-overview.html#cb280-13" aria-hidden="true"></a><span class="st">    </span><span class="kw">select</span>(nameFirst, nameLast, <span class="st">`</span><span class="dt">2013</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2014</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;playerID&#39; (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="section-2-linear-models-overview.html#cb282-1" aria-hidden="true"></a>two_years</span></code></pre></div>
<pre><code>## # A tibble: 312 x 4
##    nameFirst nameLast `2013` `2014`
##    &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;
##  1 Miguel    Cabrera   0.348  0.313
##  2 Hanley    Ramirez   0.345  0.283
##  3 Michael   Cuddyer   0.331  0.332
##  4 Scooter   Gennett   0.324  0.289
##  5 Joe       Mauer     0.324  0.277
##  6 Mike      Trout     0.323  0.287
##  7 Chris     Johnson   0.321  0.263
##  8 Freddie   Freeman   0.319  0.288
##  9 Yasiel    Puig      0.319  0.296
## 10 Yadier    Molina    0.319  0.282
## # … with 302 more rows</code></pre>
<p>The code to see what happens to the worst performers of 2013:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="section-2-linear-models-overview.html#cb284-1" aria-hidden="true"></a><span class="kw">arrange</span>(two_years, <span class="st">`</span><span class="dt">2013</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## # A tibble: 312 x 4
##    nameFirst nameLast  `2013` `2014`
##    &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;
##  1 Danny     Espinosa   0.158  0.219
##  2 Dan       Uggla      0.179  0.149
##  3 Jeff      Mathis     0.181  0.2  
##  4 B. J.     Upton      0.184  0.208
##  5 Adam      Rosales    0.190  0.262
##  6 Aaron     Hicks      0.192  0.215
##  7 Chris     Colabello  0.194  0.229
##  8 J. P.     Arencibia  0.194  0.177
##  9 Tyler     Flowers    0.195  0.241
## 10 Ryan      Hanigan    0.198  0.218
## # … with 302 more rows</code></pre>
<p>The code to see the correlation for performance in two separate years:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="section-2-linear-models-overview.html#cb286-1" aria-hidden="true"></a><span class="kw">qplot</span>(<span class="st">`</span><span class="dt">2013</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2014</span><span class="st">`</span>, <span class="dt">data =</span> two_years)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-103-1.png" width="672" /></p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="section-2-linear-models-overview.html#cb287-1" aria-hidden="true"></a><span class="kw">summarize</span>(two_years, <span class="kw">cor</span>(<span class="st">`</span><span class="dt">2013</span><span class="st">`</span>,<span class="st">`</span><span class="dt">2014</span><span class="st">`</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   `cor(\`2013\`, \`2014\`)`
##                       &lt;dbl&gt;
## 1                     0.460</code></pre>
</div>
<div id="measurement-error-models" class="section level2" number="3.22">
<h2><span class="header-section-number">3.22</span> Measurement Error Models</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/linear-models.html#measurement-error-models" target="_blank">here</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>Up to now, all our linear regression examples have been applied to two or more random variables. We assume the pairs are bivariate normal and use this to motivate a linear model.</li>
<li>Another use for linear regression is with <strong>measurement error models</strong>, where it is common to have a non-random covariate (such as time). Randomness is introduced from measurement error rather than sampling or natural variability.</li>
</ul>
<p><em>Code</em></p>
<p>The code to use <strong>dslabs</strong> function <strong>rfalling_object</strong> to generate simulations of dropping balls:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="section-2-linear-models-overview.html#cb289-1" aria-hidden="true"></a>falling_object &lt;-<span class="st"> </span><span class="kw">rfalling_object</span>()</span></code></pre></div>
<p>The code to draw the trajectory of the ball:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="section-2-linear-models-overview.html#cb290-1" aria-hidden="true"></a>falling_object <span class="op">%&gt;%</span></span>
<span id="cb290-2"><a href="section-2-linear-models-overview.html#cb290-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(time, observed_distance)) <span class="op">+</span></span>
<span id="cb290-3"><a href="section-2-linear-models-overview.html#cb290-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb290-4"><a href="section-2-linear-models-overview.html#cb290-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Distance in meters&quot;</span>) <span class="op">+</span></span>
<span id="cb290-5"><a href="section-2-linear-models-overview.html#cb290-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time in seconds&quot;</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-105-1.png" width="672" /></p>
<p>The code to use the <code>lm()</code> function to estimate the coefficients:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="section-2-linear-models-overview.html#cb291-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span>falling_object <span class="op">%&gt;%</span></span>
<span id="cb291-2"><a href="section-2-linear-models-overview.html#cb291-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">time_sq =</span> time<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span></span>
<span id="cb291-3"><a href="section-2-linear-models-overview.html#cb291-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">lm</span>(observed_distance<span class="op">~</span>time<span class="op">+</span>time_sq, <span class="dt">data=</span>.)</span>
<span id="cb291-4"><a href="section-2-linear-models-overview.html#cb291-4" aria-hidden="true"></a></span>
<span id="cb291-5"><a href="section-2-linear-models-overview.html#cb291-5" aria-hidden="true"></a><span class="kw">tidy</span>(fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)   55.0       0.434    127.   9.15e-19
## 2 time           0.888     0.620      1.43 1.80e- 1
## 3 time_sq       -5.08      0.184    -27.7  1.61e-11</code></pre>
<p>The code to check if the estimated parabola fits the data:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="section-2-linear-models-overview.html#cb293-1" aria-hidden="true"></a><span class="kw">augment</span>(fit) <span class="op">%&gt;%</span></span>
<span id="cb293-2"><a href="section-2-linear-models-overview.html#cb293-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb293-3"><a href="section-2-linear-models-overview.html#cb293-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(time, observed_distance)) <span class="op">+</span></span>
<span id="cb293-4"><a href="section-2-linear-models-overview.html#cb293-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(time, .fitted), <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-107-1.png" width="672" /></p>
<p>The code to see the summary statistic of the regression:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="section-2-linear-models-overview.html#cb294-1" aria-hidden="true"></a><span class="kw">tidy</span>(fit, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 7
##   term        estimate std.error statistic  p.value conf.low conf.high
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)   55.0       0.434    127.   9.15e-19   54.1       56.0 
## 2 time           0.888     0.620      1.43 1.80e- 1   -0.476      2.25
## 3 time_sq       -5.08      0.184    -27.7  1.61e-11   -5.49      -4.68</code></pre>
</div>
<div id="assessment---regression-and-baseball-part-1" class="section level2" number="3.23">
<h2><span class="header-section-number">3.23</span> Assessment - Regression and Baseball, part 1</h2>
<ol style="list-style-type: decimal">
<li>What is the final linear model (in the video “Building a Better Offensive Metric for Baseball”) we used to predict runs scored per game?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. <code>lm(R ~ BB + HR)</code></li>
<li><input type="checkbox" disabled="" />
B. <code>lm(HR ~ BB + singles + doubles + triples)</code></li>
<li><input type="checkbox" disabled="" checked="" />
C. <code>lm(R ~ BB + singles + doubles + triples + HR)</code></li>
<li><input type="checkbox" disabled="" />
D. <code>lm(R ~ singles + doubles + triples + HR)</code></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>We want to estimate runs per game scored by individual players, not just by teams. What summary metric do we calculate to help estimate this?</li>
</ol>
<p>Look at the code from the video “Building a Metter Offensive Metric for Baseball” for a hint:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="section-2-linear-models-overview.html#cb296-1" aria-hidden="true"></a>pa_per_game &lt;-<span class="st"> </span>Batting <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb296-2"><a href="section-2-linear-models-overview.html#cb296-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(yearID <span class="op">==</span><span class="st"> </span><span class="dv">2002</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb296-3"><a href="section-2-linear-models-overview.html#cb296-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(teamID) <span class="op">%&gt;%</span></span>
<span id="cb296-4"><a href="section-2-linear-models-overview.html#cb296-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">pa_per_game =</span> <span class="kw">sum</span>(AB<span class="op">+</span>BB)<span class="op">/</span><span class="kw">max</span>(G)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb296-5"><a href="section-2-linear-models-overview.html#cb296-5" aria-hidden="true"></a><span class="st">  </span>.<span class="op">$</span>pa_per_game <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb296-6"><a href="section-2-linear-models-overview.html#cb296-6" aria-hidden="true"></a><span class="st">  </span>mean</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. <code>pa_per_game</code>: the mean number of plate appearances per team per game for each team</li>
<li><input type="checkbox" disabled="" />
B. <code>pa_per_game</code>: the mean number of plate appearances per game for each player</li>
<li><input type="checkbox" disabled="" checked="" />
C. <code>pa_per_game</code>: the number of plate appearances per team per game, averaged across all teams</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Imagine you have two teams. Team A is comprised of batters who, on average, get two bases on balls, four singles, one double, and one home run. Team B is comprised of batters who, on average, get one base on balls, six singles, two doubles, and one triple.</li>
</ol>
<p>Which team scores more runs, as predicted by our model?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. Team A</li>
<li><input type="checkbox" disabled="" checked="" />
B. Team B</li>
<li><input type="checkbox" disabled="" />
C. Tie</li>
<li><input type="checkbox" disabled="" />
D. Impossible to know</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>The on-base-percentage plus slugging percentage (OPS) metric gives the most weight to:</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. Singles</li>
<li><input type="checkbox" disabled="" />
B. Doubles</li>
<li><input type="checkbox" disabled="" />
C. Triples</li>
<li><input type="checkbox" disabled="" checked="" />
D. Home Runs</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>What statistical concept properly explains the “sophomore slump”?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. Regression to the mean</li>
<li><input type="checkbox" disabled="" />
B. Law of averages</li>
<li><input type="checkbox" disabled="" />
C. Normal distribution</li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li>In our model of time vs. observed_distance in the video “Measurement Error Models”, the randomness of our data was due to:</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. sampling</li>
<li><input type="checkbox" disabled="" />
B. natural variability</li>
<li><input type="checkbox" disabled="" checked="" />
C. measurement error</li>
</ul>
<ol start="7" style="list-style-type: decimal">
<li>Which of the following are important assumptions about the measurement errors in this experiment?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. The measurement error is random</li>
<li><input type="checkbox" disabled="" checked="" />
B. The measurement error is independent</li>
<li><input type="checkbox" disabled="" checked="" />
C. The measurement error has the same distribution for each time i</li>
</ul>
<ol start="8" style="list-style-type: decimal">
<li>Which of the following scenarios would violate an assumption of our measurement error model?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. The experiment was conducted on the moon.</li>
<li><input type="checkbox" disabled="" checked="" />
B. There was one position where it was particularly difficult to see the dropped ball.</li>
<li><input type="checkbox" disabled="" />
C. The experiment was only repeated 10 times, not 100 times.</li>
</ul>
</div>
<div id="assessment---regression-and-baseball-part-2" class="section level2" number="3.24">
<h2><span class="header-section-number">3.24</span> Assessment - Regression and Baseball, part 2</h2>
<p>Question 9 has two parts. Use the information below to answer both parts.</p>
<p>Use the <code>Teams</code> data frame from the <strong>Lahman</strong> package. Fit a multivariate linear regression model to obtain the effects of BB and HR on Runs (<strong>R</strong>) in 1971. Use the <code>tidy()</code> function in the <strong>broom</strong> package to obtain the results in a data frame.</p>
<p>9a. What is the estimate for the effect of BB on runs?</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="section-2-linear-models-overview.html#cb297-1" aria-hidden="true"></a>Teams <span class="op">%&gt;%</span></span>
<span id="cb297-2"><a href="section-2-linear-models-overview.html#cb297-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(yearID <span class="op">==</span><span class="st"> </span><span class="dv">1971</span>) <span class="op">%&gt;%</span></span>
<span id="cb297-3"><a href="section-2-linear-models-overview.html#cb297-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB <span class="op">+</span><span class="st"> </span>HR, <span class="dt">data =</span> .) <span class="op">%&gt;%</span></span>
<span id="cb297-4"><a href="section-2-linear-models-overview.html#cb297-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span></span>
<span id="cb297-5"><a href="section-2-linear-models-overview.html#cb297-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;BB&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb297-6"><a href="section-2-linear-models-overview.html#cb297-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">pull</span>(estimate)</span></code></pre></div>
<pre><code>## [1] 0.414</code></pre>
<p>What is the estimate for the effect of HR on runs?</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="section-2-linear-models-overview.html#cb299-1" aria-hidden="true"></a>Teams <span class="op">%&gt;%</span></span>
<span id="cb299-2"><a href="section-2-linear-models-overview.html#cb299-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(yearID <span class="op">==</span><span class="st"> </span><span class="dv">1971</span>) <span class="op">%&gt;%</span></span>
<span id="cb299-3"><a href="section-2-linear-models-overview.html#cb299-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB <span class="op">+</span><span class="st"> </span>HR, <span class="dt">data =</span> .) <span class="op">%&gt;%</span></span>
<span id="cb299-4"><a href="section-2-linear-models-overview.html#cb299-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span></span>
<span id="cb299-5"><a href="section-2-linear-models-overview.html#cb299-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;HR&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb299-6"><a href="section-2-linear-models-overview.html#cb299-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">pull</span>(estimate)</span></code></pre></div>
<pre><code>## [1] 1.3</code></pre>
<p>9b. Interpret the p-values for the estimates using a cutoff of 0.05.</p>
<p>Which of the following is the correct interpretation?</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="section-2-linear-models-overview.html#cb301-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span>Teams <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1971</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb301-2"><a href="section-2-linear-models-overview.html#cb301-2" aria-hidden="true"></a><span class="kw">mutate</span>(<span class="dt">BB =</span> BB<span class="op">/</span>G, <span class="dt">HR =</span> HR<span class="op">/</span>G,  <span class="dt">R =</span> R<span class="op">/</span>G) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb301-3"><a href="section-2-linear-models-overview.html#cb301-3" aria-hidden="true"></a><span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB <span class="op">+</span><span class="st"> </span>HR, <span class="dt">data =</span> .)</span>
<span id="cb301-4"><a href="section-2-linear-models-overview.html#cb301-4" aria-hidden="true"></a></span>
<span id="cb301-5"><a href="section-2-linear-models-overview.html#cb301-5" aria-hidden="true"></a><span class="kw">tidy</span>(fit, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 7
##   term        estimate std.error statistic p.value conf.low conf.high
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)    1.60      0.665      2.40 0.0256    0.215      2.98 
## 2 BB             0.412     0.203      2.03 0.0552   -0.0101     0.835
## 3 HR             1.29      0.427      3.03 0.00639   0.406      2.18</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. Both BB and HR have a nonzero effect on runs.</li>
<li><input type="checkbox" disabled="" checked="" />
B. HR has a significant effect on runs, but the evidence is not strong enough to suggest BB also does.</li>
<li><input type="checkbox" disabled="" />
C. BB has a significant effect on runs, but the evidence is not strong enough to suggest HR also does.</li>
<li><input type="checkbox" disabled="" />
D. Neither BB nor HR have a statistically significant effect on runs.</li>
</ul>
<ol start="10" style="list-style-type: decimal">
<li>Repeat the above exercise to find the effects of BB and HR on runs (<code>R</code>) for every year from 1961 to 2018 using <code>do()</code> and the <strong>broom</strong> package.</li>
</ol>
<p>Make a scatterplot of the estimate for the effect of BB on runs over time and add a trend line with confidence intervals.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="section-2-linear-models-overview.html#cb303-1" aria-hidden="true"></a>res &lt;-<span class="st"> </span>Teams <span class="op">%&gt;%</span></span>
<span id="cb303-2"><a href="section-2-linear-models-overview.html#cb303-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1961</span><span class="op">:</span><span class="dv">2018</span>) <span class="op">%&gt;%</span></span>
<span id="cb303-3"><a href="section-2-linear-models-overview.html#cb303-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(yearID) <span class="op">%&gt;%</span></span>
<span id="cb303-4"><a href="section-2-linear-models-overview.html#cb303-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(R <span class="op">~</span><span class="st"> </span>BB <span class="op">+</span><span class="st"> </span>HR, <span class="dt">data =</span> .))) <span class="op">%&gt;%</span></span>
<span id="cb303-5"><a href="section-2-linear-models-overview.html#cb303-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">ungroup</span>() </span>
<span id="cb303-6"><a href="section-2-linear-models-overview.html#cb303-6" aria-hidden="true"></a>res <span class="op">%&gt;%</span></span>
<span id="cb303-7"><a href="section-2-linear-models-overview.html#cb303-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;BB&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb303-8"><a href="section-2-linear-models-overview.html#cb303-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(yearID, estimate)) <span class="op">+</span></span>
<span id="cb303-9"><a href="section-2-linear-models-overview.html#cb303-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb303-10"><a href="section-2-linear-models-overview.html#cb303-10" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="img/figures/unnamed-chunk-113-1.png" width="672" /></p>
<p>Fill in the blank to complete the statement:</p>
<p>The effect of BB on runs has <strong>increased</strong> over time.</p>
<ol start="11" style="list-style-type: decimal">
<li>Fit a linear model on the results from Question 10 to determine the effect of year on the impact of BB.</li>
</ol>
<p>For each additional year, by what value does the impact of BB on runs change?</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="section-2-linear-models-overview.html#cb305-1" aria-hidden="true"></a>res <span class="op">%&gt;%</span></span>
<span id="cb305-2"><a href="section-2-linear-models-overview.html#cb305-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;BB&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb305-3"><a href="section-2-linear-models-overview.html#cb305-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">lm</span>(estimate <span class="op">~</span><span class="st"> </span>yearID, <span class="dt">data =</span> .) <span class="op">%&gt;%</span></span>
<span id="cb305-4"><a href="section-2-linear-models-overview.html#cb305-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span></span>
<span id="cb305-5"><a href="section-2-linear-models-overview.html#cb305-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;yearID&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb305-6"><a href="section-2-linear-models-overview.html#cb305-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">pull</span>(estimate)</span></code></pre></div>
<pre><code>## [1] 0.00355</code></pre>
<p>What is the p-value for this effect?</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="section-2-linear-models-overview.html#cb307-1" aria-hidden="true"></a>res <span class="op">%&gt;%</span></span>
<span id="cb307-2"><a href="section-2-linear-models-overview.html#cb307-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;BB&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb307-3"><a href="section-2-linear-models-overview.html#cb307-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">lm</span>(estimate <span class="op">~</span><span class="st"> </span>yearID, <span class="dt">data =</span> .) <span class="op">%&gt;%</span></span>
<span id="cb307-4"><a href="section-2-linear-models-overview.html#cb307-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span></span>
<span id="cb307-5"><a href="section-2-linear-models-overview.html#cb307-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;yearID&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb307-6"><a href="section-2-linear-models-overview.html#cb307-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">pull</span>(p.value)</span></code></pre></div>
<pre><code>## [1] 0.00807</code></pre>
</div>
<div id="assessment---linear-models" class="section level2" number="3.25">
<h2><span class="header-section-number">3.25</span> Assessment - Linear Models</h2>
<p>This assessment has 6 multi-part questions that will all use the setup below.</p>
<p>Game attendance in baseball varies partly as a function of how well a team is playing.</p>
<p>Load the <strong>Lahman</strong> library. The <code>Teams</code> data frame contains an <code>attendance</code> column. This is the total attendance for the season. To calculate average attendance, divide by the number of games played, as follows:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="section-2-linear-models-overview.html#cb309-1" aria-hidden="true"></a>Teams_small &lt;-<span class="st"> </span>Teams <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb309-2"><a href="section-2-linear-models-overview.html#cb309-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(yearID <span class="op">%in%</span><span class="st"> </span><span class="dv">1961</span><span class="op">:</span><span class="dv">2001</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb309-3"><a href="section-2-linear-models-overview.html#cb309-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">avg_attendance =</span> attendance<span class="op">/</span>G)</span></code></pre></div>
<p>Use linear models to answer the following 3-part question about <code>Teams_small</code>.</p>
<p>1a. Use runs (<code>R</code>) per game to predict average attendance.</p>
<p>For every 1 run scored per game, average attendance increases by how much?</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="section-2-linear-models-overview.html#cb310-1" aria-hidden="true"></a><span class="co"># find regression line predicting attendance from R and take slope</span></span>
<span id="cb310-2"><a href="section-2-linear-models-overview.html#cb310-2" aria-hidden="true"></a>Teams_small <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb310-3"><a href="section-2-linear-models-overview.html#cb310-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">R_per_game =</span> R<span class="op">/</span>G) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb310-4"><a href="section-2-linear-models-overview.html#cb310-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">lm</span>(avg_attendance <span class="op">~</span><span class="st"> </span>R_per_game, <span class="dt">data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb310-5"><a href="section-2-linear-models-overview.html#cb310-5" aria-hidden="true"></a><span class="st">  </span>.<span class="op">$</span>coef <span class="op">%&gt;%</span></span>
<span id="cb310-6"><a href="section-2-linear-models-overview.html#cb310-6" aria-hidden="true"></a><span class="st">  </span>.[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## R_per_game 
##       4117</code></pre>
<p>Use home runs (<code>HR</code>) per game to predict average attendance.</p>
<p>For every 1 home run hit per game, average attendance increases by how much?</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="section-2-linear-models-overview.html#cb312-1" aria-hidden="true"></a>Teams_small <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb312-2"><a href="section-2-linear-models-overview.html#cb312-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">HR_per_game =</span> HR<span class="op">/</span>G) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb312-3"><a href="section-2-linear-models-overview.html#cb312-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">lm</span>(avg_attendance <span class="op">~</span><span class="st"> </span>HR_per_game, <span class="dt">data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb312-4"><a href="section-2-linear-models-overview.html#cb312-4" aria-hidden="true"></a><span class="st">  </span>.<span class="op">$</span>coef <span class="op">%&gt;%</span></span>
<span id="cb312-5"><a href="section-2-linear-models-overview.html#cb312-5" aria-hidden="true"></a><span class="st">  </span>.[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## HR_per_game 
##        8113</code></pre>
<p>1b. Use number of wins to predict average attendance; do not normalize for number of games.</p>
<p>For every game won in a season, how much does average attendance increase?</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="section-2-linear-models-overview.html#cb314-1" aria-hidden="true"></a>Teams_small <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb314-2"><a href="section-2-linear-models-overview.html#cb314-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">lm</span>(avg_attendance <span class="op">~</span><span class="st"> </span>W, <span class="dt">data =</span> .) <span class="op">%&gt;%</span></span>
<span id="cb314-3"><a href="section-2-linear-models-overview.html#cb314-3" aria-hidden="true"></a><span class="st">  </span>.<span class="op">$</span>coef <span class="op">%&gt;%</span></span>
<span id="cb314-4"><a href="section-2-linear-models-overview.html#cb314-4" aria-hidden="true"></a><span class="st">  </span>.[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>##   W 
## 121</code></pre>
<p>Suppose a team won zero games in a season.</p>
<p>Predict the average attendance.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="section-2-linear-models-overview.html#cb316-1" aria-hidden="true"></a>Teams_small <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-2"><a href="section-2-linear-models-overview.html#cb316-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">lm</span>(avg_attendance <span class="op">~</span><span class="st"> </span>W, <span class="dt">data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-3"><a href="section-2-linear-models-overview.html#cb316-3" aria-hidden="true"></a><span class="st">  </span>.<span class="op">$</span>coef <span class="op">%&gt;%</span></span>
<span id="cb316-4"><a href="section-2-linear-models-overview.html#cb316-4" aria-hidden="true"></a><span class="st">  </span>.[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## (Intercept) 
##        1129</code></pre>
<p>1c. Use year to predict average attendance.</p>
<p>How much does average attendance increase each year?</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="section-2-linear-models-overview.html#cb318-1" aria-hidden="true"></a>Teams_small <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb318-2"><a href="section-2-linear-models-overview.html#cb318-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">lm</span>(avg_attendance <span class="op">~</span><span class="st"> </span>yearID, <span class="dt">data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb318-3"><a href="section-2-linear-models-overview.html#cb318-3" aria-hidden="true"></a><span class="st">  </span>.<span class="op">$</span>coef <span class="op">%&gt;%</span></span>
<span id="cb318-4"><a href="section-2-linear-models-overview.html#cb318-4" aria-hidden="true"></a><span class="st">  </span>.[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## yearID 
##    244</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Game wins, runs per game and home runs per game are positively correlated with attendance. We saw in the course material that runs per game and home runs per game are correlated with each other. Are wins and runs per game or wins and home runs per game correlated?</li>
</ol>
<p>What is the correlation coefficient for wins and runs per game?</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="section-2-linear-models-overview.html#cb320-1" aria-hidden="true"></a><span class="kw">cor</span>(Teams_small<span class="op">$</span>W, Teams_small<span class="op">$</span>R<span class="op">/</span>Teams_small<span class="op">$</span>G)</span></code></pre></div>
<pre><code>## [1] 0.412</code></pre>
<p>What is the correlation coefficient for wins and home runs per game?</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="section-2-linear-models-overview.html#cb322-1" aria-hidden="true"></a><span class="kw">cor</span>(Teams_small<span class="op">$</span>W, Teams_small<span class="op">$</span>HR<span class="op">/</span>Teams_small<span class="op">$</span>G)</span></code></pre></div>
<pre><code>## [1] 0.274</code></pre>
<p>Stratify <code>Teams_small</code> by wins: divide number of wins by 10 and then round to the nearest integer. Keep only strata 5 through 10, which have 20 or more data points.</p>
<p>Use the stratified dataset to answer this three-part question.</p>
<p>3a. How many observations are in the 8 win strata?
(Note that due to division and rounding, these teams have 75-85 wins.)</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="section-2-linear-models-overview.html#cb324-1" aria-hidden="true"></a>dat &lt;-<span class="st"> </span>Teams_small <span class="op">%&gt;%</span></span>
<span id="cb324-2"><a href="section-2-linear-models-overview.html#cb324-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">W_strata =</span> <span class="kw">round</span>(W<span class="op">/</span><span class="dv">10</span>)) <span class="op">%&gt;%</span></span>
<span id="cb324-3"><a href="section-2-linear-models-overview.html#cb324-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(W_strata <span class="op">&gt;=</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>W_strata <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>)</span>
<span id="cb324-4"><a href="section-2-linear-models-overview.html#cb324-4" aria-hidden="true"></a></span>
<span id="cb324-5"><a href="section-2-linear-models-overview.html#cb324-5" aria-hidden="true"></a><span class="kw">sum</span>(dat<span class="op">$</span>W_strata <span class="op">==</span><span class="st"> </span><span class="dv">8</span>)</span></code></pre></div>
<pre><code>## [1] 338</code></pre>
<p>3b. Calculate the slope of the regression line predicting average attendance given runs per game for each of the win strata.</p>
<p>Which win stratum has the largest regression line slope?</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="section-2-linear-models-overview.html#cb326-1" aria-hidden="true"></a><span class="co"># calculate slope of regression line after stratifying by R per game</span></span>
<span id="cb326-2"><a href="section-2-linear-models-overview.html#cb326-2" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb326-3"><a href="section-2-linear-models-overview.html#cb326-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(W_strata) <span class="op">%&gt;%</span></span>
<span id="cb326-4"><a href="section-2-linear-models-overview.html#cb326-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">slope =</span> <span class="kw">cor</span>(R<span class="op">/</span>G, avg_attendance)<span class="op">*</span><span class="kw">sd</span>(avg_attendance)<span class="op">/</span><span class="kw">sd</span>(R<span class="op">/</span>G))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 6 x 2
##   W_strata slope
##      &lt;dbl&gt; &lt;dbl&gt;
## 1        5 4362.
## 2        6 4343.
## 3        7 3888.
## 4        8 3128.
## 5        9 3701.
## 6       10 3107.</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. 5</li>
<li><input type="checkbox" disabled="" />
B. 6</li>
<li><input type="checkbox" disabled="" />
C. 7</li>
<li><input type="checkbox" disabled="" />
D. 8</li>
<li><input type="checkbox" disabled="" />
E. 9</li>
<li><input type="checkbox" disabled="" />
F. 10</li>
</ul>
<p>Calculate the slope of the regression line predicting average attendance given HR per game for each of the win strata.</p>
<p>Which win stratum has the largest regression line slope?</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="section-2-linear-models-overview.html#cb329-1" aria-hidden="true"></a><span class="co"># calculate slope of regression line after stratifying by HR per game</span></span>
<span id="cb329-2"><a href="section-2-linear-models-overview.html#cb329-2" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb329-3"><a href="section-2-linear-models-overview.html#cb329-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(W_strata) <span class="op">%&gt;%</span></span>
<span id="cb329-4"><a href="section-2-linear-models-overview.html#cb329-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">slope =</span> <span class="kw">cor</span>(HR<span class="op">/</span>G, avg_attendance)<span class="op">*</span><span class="kw">sd</span>(avg_attendance)<span class="op">/</span><span class="kw">sd</span>(HR<span class="op">/</span>G))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 6 x 2
##   W_strata  slope
##      &lt;dbl&gt;  &lt;dbl&gt;
## 1        5 10192.
## 2        6  7032.
## 3        7  8931.
## 4        8  6301.
## 5        9  5863.
## 6       10  4917.</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. 5</li>
<li><input type="checkbox" disabled="" />
B. 6</li>
<li><input type="checkbox" disabled="" />
C. 7</li>
<li><input type="checkbox" disabled="" />
D. 8</li>
<li><input type="checkbox" disabled="" />
E. 9</li>
<li><input type="checkbox" disabled="" />
F. 10</li>
</ul>
<p>3c. Which of the followng are true about the effect of win strata on average attendance?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. Across all win strata, runs per game are positively correlated with average attendance.</li>
<li><input type="checkbox" disabled="" />
B. Runs per game have the strongest effect on attendance when a team wins many games.</li>
<li><input type="checkbox" disabled="" />
C. After controlling for number of wins, home runs per game are not correlated with attendance.</li>
<li><input type="checkbox" disabled="" checked="" />
D. Home runs per game have the strongest effect on attendance when a team does not win many games.</li>
<li><input type="checkbox" disabled="" checked="" />
E. Among teams with similar numbers of wins, teams with more home runs per game have larger average attendance.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Fit a multivariate regression determining the effects of runs per game, home runs per game, wins, and year on average attendance. Use the original <code>Teams_small</code> wins column, not the win strata from question 3.</li>
</ol>
<p>What is the estimate of the effect of runs per game on average attendance?</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="section-2-linear-models-overview.html#cb332-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span>Teams_small <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb332-2"><a href="section-2-linear-models-overview.html#cb332-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">R_per_game =</span> R<span class="op">/</span>G,</span>
<span id="cb332-3"><a href="section-2-linear-models-overview.html#cb332-3" aria-hidden="true"></a>           <span class="dt">HR_per_game =</span> HR<span class="op">/</span>G) <span class="op">%&gt;%</span></span>
<span id="cb332-4"><a href="section-2-linear-models-overview.html#cb332-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">lm</span>(avg_attendance <span class="op">~</span><span class="st"> </span>R_per_game <span class="op">+</span><span class="st"> </span>HR_per_game <span class="op">+</span><span class="st"> </span>W <span class="op">+</span><span class="st"> </span>yearID, <span class="dt">data =</span> .)</span>
<span id="cb332-5"><a href="section-2-linear-models-overview.html#cb332-5" aria-hidden="true"></a><span class="kw">tidy</span>(fit) <span class="op">%&gt;%</span></span>
<span id="cb332-6"><a href="section-2-linear-models-overview.html#cb332-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;R_per_game&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb332-7"><a href="section-2-linear-models-overview.html#cb332-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">pull</span>(estimate)</span></code></pre></div>
<pre><code>## [1] 322</code></pre>
<p>What is the estimate of the effect of home runs per game on average attendance?</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="section-2-linear-models-overview.html#cb334-1" aria-hidden="true"></a><span class="kw">tidy</span>(fit) <span class="op">%&gt;%</span></span>
<span id="cb334-2"><a href="section-2-linear-models-overview.html#cb334-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;HR_per_game&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb334-3"><a href="section-2-linear-models-overview.html#cb334-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">pull</span>(estimate)</span></code></pre></div>
<pre><code>## [1] 1798</code></pre>
<p>What is the estimate of the effect of number of wins in a season on average attendance?</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="section-2-linear-models-overview.html#cb336-1" aria-hidden="true"></a><span class="kw">tidy</span>(fit) <span class="op">%&gt;%</span></span>
<span id="cb336-2"><a href="section-2-linear-models-overview.html#cb336-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;W&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb336-3"><a href="section-2-linear-models-overview.html#cb336-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">pull</span>(estimate)</span></code></pre></div>
<pre><code>## [1] 117</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Use the multivariate regression model from Question 4. Suppose a team averaged 5 runs per game, 1.2 home runs per game, and won 80 games in a season.</li>
</ol>
<p>What would this team’s average attendance be in 2002?</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="section-2-linear-models-overview.html#cb338-1" aria-hidden="true"></a><span class="kw">predict</span>(fit, <span class="kw">data.frame</span>(<span class="dt">R_per_game =</span> <span class="dv">5</span>, <span class="dt">HR_per_game =</span> <span class="fl">1.2</span>, <span class="dt">W =</span> <span class="dv">80</span>, <span class="dt">yearID =</span> <span class="dv">2002</span>))</span></code></pre></div>
<pre><code>##     1 
## 16149</code></pre>
<p>What would this team’s average attendance be in 1960?</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="section-2-linear-models-overview.html#cb340-1" aria-hidden="true"></a><span class="kw">predict</span>(fit, <span class="kw">data.frame</span>(<span class="dt">R_per_game =</span> <span class="dv">5</span>, <span class="dt">HR_per_game =</span> <span class="fl">1.2</span>, <span class="dt">W =</span> <span class="dv">80</span>, <span class="dt">yearID =</span> <span class="dv">1960</span>))</span></code></pre></div>
<pre><code>##    1 
## 6505</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Use your model from Question 4 to predict average attendance for teams in 2002 in the original Teams data frame.</li>
</ol>
<p>What is the correlation between the predicted attendance and actual attendance?</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="section-2-linear-models-overview.html#cb342-1" aria-hidden="true"></a>newdata &lt;-<span class="st"> </span>Teams <span class="op">%&gt;%</span></span>
<span id="cb342-2"><a href="section-2-linear-models-overview.html#cb342-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(yearID <span class="op">==</span><span class="st"> </span><span class="dv">2002</span>) <span class="op">%&gt;%</span></span>
<span id="cb342-3"><a href="section-2-linear-models-overview.html#cb342-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">avg_attendance =</span> attendance<span class="op">/</span>G,</span>
<span id="cb342-4"><a href="section-2-linear-models-overview.html#cb342-4" aria-hidden="true"></a>           <span class="dt">R_per_game =</span> R<span class="op">/</span>G,</span>
<span id="cb342-5"><a href="section-2-linear-models-overview.html#cb342-5" aria-hidden="true"></a>           <span class="dt">HR_per_game =</span> HR<span class="op">/</span>G)</span>
<span id="cb342-6"><a href="section-2-linear-models-overview.html#cb342-6" aria-hidden="true"></a>preds &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, newdata)</span>
<span id="cb342-7"><a href="section-2-linear-models-overview.html#cb342-7" aria-hidden="true"></a><span class="kw">cor</span>(preds, newdata<span class="op">$</span>avg_attendance)</span></code></pre></div>
<pre><code>## [1] 0.519</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-1-introduction-to-regression-overview.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-3-confounding-overview.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
