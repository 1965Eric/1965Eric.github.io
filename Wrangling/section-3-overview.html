<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Section 3 Overview | Data Science Wrangling</title>
  <meta name="description" content="4 Section 3 Overview | Data Science Wrangling" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Section 3 Overview | Data Science Wrangling" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Section 3 Overview | Data Science Wrangling" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-2-overview.html"/>
<link rel="next" href="section-4-overview.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="learning-objectives.html"><a href="learning-objectives.html"><i class="fa fa-check"></i><b>1</b> Learning Objectives</a>
<ul>
<li class="chapter" data-level="1.1" data-path="learning-objectives.html"><a href="learning-objectives.html#course-overview"><i class="fa fa-check"></i><b>1.1</b> Course Overview</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="learning-objectives.html"><a href="learning-objectives.html#section-1-data-import"><i class="fa fa-check"></i><b>1.1.1</b> Section 1: Data Import</a></li>
<li class="chapter" data-level="1.1.2" data-path="learning-objectives.html"><a href="learning-objectives.html#section-2-tidy-data"><i class="fa fa-check"></i><b>1.1.2</b> Section 2: Tidy Data</a></li>
<li class="chapter" data-level="1.1.3" data-path="learning-objectives.html"><a href="learning-objectives.html#section-3-string-processing"><i class="fa fa-check"></i><b>1.1.3</b> Section 3: String Processing</a></li>
<li class="chapter" data-level="1.1.4" data-path="learning-objectives.html"><a href="learning-objectives.html#section-4-dates-times-and-text-mining"><i class="fa fa-check"></i><b>1.1.4</b> Section 4: Dates, Times, and Text Mining</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="learning-objectives.html"><a href="learning-objectives.html#introduction-to-wrangling"><i class="fa fa-check"></i><b>1.2</b> Introduction to Wrangling</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-1-overview.html"><a href="section-1-overview.html"><i class="fa fa-check"></i><b>2</b> Section 1 Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="section-1-overview.html"><a href="section-1-overview.html#importing-spreadsheets"><i class="fa fa-check"></i><b>2.1</b> Importing Spreadsheets</a></li>
<li class="chapter" data-level="2.2" data-path="section-1-overview.html"><a href="section-1-overview.html#paths-and-the-working-directory"><i class="fa fa-check"></i><b>2.2</b> Paths and the Working Directory</a></li>
<li class="chapter" data-level="2.3" data-path="section-1-overview.html"><a href="section-1-overview.html#the-readr-and-readxl-packages"><i class="fa fa-check"></i><b>2.3</b> The readr and readxl Packages</a></li>
<li class="chapter" data-level="2.4" data-path="section-1-overview.html"><a href="section-1-overview.html#importing-data-using-r-base-functions"><i class="fa fa-check"></i><b>2.4</b> Importing Data Using R-base Functions</a></li>
<li class="chapter" data-level="2.5" data-path="section-1-overview.html"><a href="section-1-overview.html#downloading-files-from-the-internet"><i class="fa fa-check"></i><b>2.5</b> Downloading Files from the Internet</a></li>
<li class="chapter" data-level="2.6" data-path="section-1-overview.html"><a href="section-1-overview.html#assessment-part-1---data-import"><i class="fa fa-check"></i><b>2.6</b> Assessment Part 1 - Data Import</a></li>
<li class="chapter" data-level="2.7" data-path="section-1-overview.html"><a href="section-1-overview.html#assessment-part-2---data-import"><i class="fa fa-check"></i><b>2.7</b> Assessment Part 2 - Data Import</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-2-overview.html"><a href="section-2-overview.html"><i class="fa fa-check"></i><b>3</b> Section 2 Overview</a>
<ul>
<li class="chapter" data-level="3.1" data-path="section-2-overview.html"><a href="section-2-overview.html#tidy-data"><i class="fa fa-check"></i><b>3.1</b> Tidy Data</a></li>
<li class="chapter" data-level="3.2" data-path="section-2-overview.html"><a href="section-2-overview.html#reshaping-data"><i class="fa fa-check"></i><b>3.2</b> Reshaping Data</a></li>
<li class="chapter" data-level="3.3" data-path="section-2-overview.html"><a href="section-2-overview.html#separate-and-unite"><i class="fa fa-check"></i><b>3.3</b> Separate and Unite</a></li>
<li class="chapter" data-level="3.4" data-path="section-2-overview.html"><a href="section-2-overview.html#assessment-part-1---reshaping-data"><i class="fa fa-check"></i><b>3.4</b> Assessment Part 1 - Reshaping Data</a></li>
<li class="chapter" data-level="3.5" data-path="section-2-overview.html"><a href="section-2-overview.html#assessment-part-2---reshaping-data"><i class="fa fa-check"></i><b>3.5</b> Assessment Part 2 - Reshaping Data</a></li>
<li class="chapter" data-level="3.6" data-path="section-2-overview.html"><a href="section-2-overview.html#combining-tables"><i class="fa fa-check"></i><b>3.6</b> Combining Tables</a></li>
<li class="chapter" data-level="3.7" data-path="section-2-overview.html"><a href="section-2-overview.html#binding"><i class="fa fa-check"></i><b>3.7</b> Binding</a></li>
<li class="chapter" data-level="3.8" data-path="section-2-overview.html"><a href="section-2-overview.html#set-operators"><i class="fa fa-check"></i><b>3.8</b> Set Operators</a></li>
<li class="chapter" data-level="3.9" data-path="section-2-overview.html"><a href="section-2-overview.html#assessment---combining-tables"><i class="fa fa-check"></i><b>3.9</b> Assessment - Combining Tables</a></li>
<li class="chapter" data-level="3.10" data-path="section-2-overview.html"><a href="section-2-overview.html#web-scraping"><i class="fa fa-check"></i><b>3.10</b> Web Scraping</a></li>
<li class="chapter" data-level="3.11" data-path="section-2-overview.html"><a href="section-2-overview.html#css-selectors"><i class="fa fa-check"></i><b>3.11</b> CSS Selectors</a></li>
<li class="chapter" data-level="3.12" data-path="section-2-overview.html"><a href="section-2-overview.html#assessment---web-scraping"><i class="fa fa-check"></i><b>3.12</b> Assessment - Web Scraping</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-3-overview.html"><a href="section-3-overview.html"><i class="fa fa-check"></i><b>4</b> Section 3 Overview</a>
<ul>
<li class="chapter" data-level="4.1" data-path="section-3-overview.html"><a href="section-3-overview.html#string-parsing"><i class="fa fa-check"></i><b>4.1</b> String Parsing</a></li>
<li class="chapter" data-level="4.2" data-path="section-3-overview.html"><a href="section-3-overview.html#defining-strings-single-and-double-quotes-and-how-to-escape"><i class="fa fa-check"></i><b>4.2</b> Defining Strings: Single and Double Quotes and How to Escape</a></li>
<li class="chapter" data-level="4.3" data-path="section-3-overview.html"><a href="section-3-overview.html#stringr-package"><i class="fa fa-check"></i><b>4.3</b> stringr Package</a></li>
<li class="chapter" data-level="4.4" data-path="section-3-overview.html"><a href="section-3-overview.html#case-study-1-us-murders-data"><i class="fa fa-check"></i><b>4.4</b> Case Study 1: US Murders Data</a></li>
<li class="chapter" data-level="4.5" data-path="section-3-overview.html"><a href="section-3-overview.html#assessment---string-processing-part-1"><i class="fa fa-check"></i><b>4.5</b> Assessment - String Processing Part 1</a></li>
<li class="chapter" data-level="4.6" data-path="section-3-overview.html"><a href="section-3-overview.html#case-study-2-reported-heights"><i class="fa fa-check"></i><b>4.6</b> Case Study 2: Reported Heights</a></li>
<li class="chapter" data-level="4.7" data-path="section-3-overview.html"><a href="section-3-overview.html#regex"><i class="fa fa-check"></i><b>4.7</b> Regex</a></li>
<li class="chapter" data-level="4.8" data-path="section-3-overview.html"><a href="section-3-overview.html#character-classes-anchors-and-quantifiers"><i class="fa fa-check"></i><b>4.8</b> Character Classes, Anchors and Quantifiers</a></li>
<li class="chapter" data-level="4.9" data-path="section-3-overview.html"><a href="section-3-overview.html#search-and-replace-with-regex"><i class="fa fa-check"></i><b>4.9</b> Search and Replace with Regex</a></li>
<li class="chapter" data-level="4.10" data-path="section-3-overview.html"><a href="section-3-overview.html#groups-with-regex"><i class="fa fa-check"></i><b>4.10</b> Groups with Regex</a></li>
<li class="chapter" data-level="4.11" data-path="section-3-overview.html"><a href="section-3-overview.html#testing-and-improving"><i class="fa fa-check"></i><b>4.11</b> Testing and Improving</a></li>
<li class="chapter" data-level="4.12" data-path="section-3-overview.html"><a href="section-3-overview.html#assessment---string-processing-part-2"><i class="fa fa-check"></i><b>4.12</b> Assessment - String Processing Part 2</a></li>
<li class="chapter" data-level="4.13" data-path="section-3-overview.html"><a href="section-3-overview.html#separate-with-regex"><i class="fa fa-check"></i><b>4.13</b> Separate with Regex</a></li>
<li class="chapter" data-level="4.14" data-path="section-3-overview.html"><a href="section-3-overview.html#using-groups-and-quantifiers"><i class="fa fa-check"></i><b>4.14</b> Using Groups and Quantifiers</a></li>
<li class="chapter" data-level="4.15" data-path="section-3-overview.html"><a href="section-3-overview.html#putting-it-all-together"><i class="fa fa-check"></i><b>4.15</b> Putting it All Together</a></li>
<li class="chapter" data-level="4.16" data-path="section-3-overview.html"><a href="section-3-overview.html#string-splitting"><i class="fa fa-check"></i><b>4.16</b> String Splitting</a></li>
<li class="chapter" data-level="4.17" data-path="section-3-overview.html"><a href="section-3-overview.html#case-study---extracting-a-table-from-a-pdf"><i class="fa fa-check"></i><b>4.17</b> Case Study - Extracting a Table from a PDF</a></li>
<li class="chapter" data-level="4.18" data-path="section-3-overview.html"><a href="section-3-overview.html#recoding"><i class="fa fa-check"></i><b>4.18</b> Recoding</a></li>
<li class="chapter" data-level="4.19" data-path="section-3-overview.html"><a href="section-3-overview.html#assessment---string-processing-part-3"><i class="fa fa-check"></i><b>4.19</b> Assessment - String Processing Part 3</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-4-overview.html"><a href="section-4-overview.html"><i class="fa fa-check"></i><b>5</b> Section 4 Overview</a>
<ul>
<li class="chapter" data-level="5.1" data-path="section-4-overview.html"><a href="section-4-overview.html#dates-and-times"><i class="fa fa-check"></i><b>5.1</b> Dates and Times</a></li>
<li class="chapter" data-level="5.2" data-path="section-4-overview.html"><a href="section-4-overview.html#text-mining"><i class="fa fa-check"></i><b>5.2</b> Text mining</a></li>
<li class="chapter" data-level="5.3" data-path="section-4-overview.html"><a href="section-4-overview.html#assessment-part-1---dates-times-and-text-mining"><i class="fa fa-check"></i><b>5.3</b> Assessment Part 1 - Dates, Times, and Text Mining</a></li>
<li class="chapter" data-level="5.4" data-path="section-4-overview.html"><a href="section-4-overview.html#assessment-part-2---dates-times-and-text-mining"><i class="fa fa-check"></i><b>5.4</b> Assessment Part 2 - Dates, Times, and Text Mining</a></li>
<li class="chapter" data-level="5.5" data-path="section-4-overview.html"><a href="section-4-overview.html#final-comprehensive-assessment"><i class="fa fa-check"></i><b>5.5</b> Final: Comprehensive Assessment</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="section-4-overview.html"><a href="section-4-overview.html#comprehensive-assessment-puerto-rico-hurricane-mortality"><i class="fa fa-check"></i><b>5.5.1</b> Comprehensive Assessment: Puerto Rico Hurricane Mortality</a></li>
<li class="chapter" data-level="5.5.2" data-path="section-4-overview.html"><a href="section-4-overview.html#project-introduction"><i class="fa fa-check"></i><b>5.5.2</b> Project Introduction</a></li>
<li class="chapter" data-level="5.5.3" data-path="section-4-overview.html"><a href="section-4-overview.html#puerto-rico-hurricane-mortality---part-1"><i class="fa fa-check"></i><b>5.5.3</b> Puerto Rico Hurricane Mortality - Part 1</a></li>
<li class="chapter" data-level="5.5.4" data-path="section-4-overview.html"><a href="section-4-overview.html#puerto-rico-hurricane-mortality---part-2"><i class="fa fa-check"></i><b>5.5.4</b> Puerto Rico Hurricane Mortality - Part 2</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science Wrangling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-3-overview" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Section 3 Overview</h1>
<p>In the <strong>String Processing</strong> section, we use case studies that help demonstrate how string processing is a powerful tool useful for overcoming many data wrangling challenges. You will see how the original <strong>raw</strong> data was processed to create the data frames we have used in courses throughout this series.</p>
<p>This section is divided into three parts.</p>
<p>After completing the <strong>String Processing</strong> section, you will be able to:</p>
<ul>
<li><strong>Remove</strong> unwanted characters from text.</li>
<li><strong>Extract numeric</strong> values from text.</li>
<li><strong>Find</strong> and <strong>replace</strong> characters.</li>
<li><strong>Extract specific</strong> parts of strings.</li>
<li><strong>Convert</strong> free form text into more uniform formats.</li>
<li><strong>Split strings</strong> into multiple values.</li>
<li>Use <strong>regular expressions (regex)</strong> to process strings.</li>
</ul>
<div id="string-parsing" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> String Parsing</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html" target="_blank">here</a>.</p>
<p><strong>Key points</strong></p>
<ul>
<li>The most common tasks in string processing include:
<ul>
<li>extracting numbers from strings</li>
<li>removing unwanted characters from text</li>
<li>finding and replacing characters</li>
<li>extracting specific parts of strings</li>
<li>converting free form text to more uniform formats</li>
<li>splitting strings into multiple values</li>
</ul></li>
<li>The <strong>stringr</strong> package in the <strong>tidyverse</strong> contains string processing functions that follow a similar naming format (<code>str_functionname</code>) and are compatible with the pipe.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="section-3-overview.html#cb281-1" aria-hidden="true"></a><span class="co"># read in raw murders data from Wikipedia</span></span>
<span id="cb281-2"><a href="section-3-overview.html#cb281-2" aria-hidden="true"></a>url &lt;-<span class="st"> &quot;https://en.wikipedia.org/w/index.php?title=Gun_violence_in_the_United_States_by_state&amp;direction=prev&amp;oldid=810166167&quot;</span></span>
<span id="cb281-3"><a href="section-3-overview.html#cb281-3" aria-hidden="true"></a>murders_raw &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb281-4"><a href="section-3-overview.html#cb281-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb281-5"><a href="section-3-overview.html#cb281-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">html_table</span>() <span class="op">%&gt;%</span></span>
<span id="cb281-6"><a href="section-3-overview.html#cb281-6" aria-hidden="true"></a><span class="st">  </span>.[[<span class="dv">1</span>]] <span class="op">%&gt;%</span></span>
<span id="cb281-7"><a href="section-3-overview.html#cb281-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">setNames</span>(<span class="kw">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;population&quot;</span>, <span class="st">&quot;total&quot;</span>, <span class="st">&quot;murder_rate&quot;</span>))</span>
<span id="cb281-8"><a href="section-3-overview.html#cb281-8" aria-hidden="true"></a></span>
<span id="cb281-9"><a href="section-3-overview.html#cb281-9" aria-hidden="true"></a><span class="co"># inspect data and column classes</span></span>
<span id="cb281-10"><a href="section-3-overview.html#cb281-10" aria-hidden="true"></a><span class="kw">head</span>(murders_raw)</span></code></pre></div>
<pre><code>##        state population total murder_rate
## 1    Alabama  4,853,875   348         7.2
## 2     Alaska    737,709    59         8.0
## 3    Arizona  6,817,565   309         4.5
## 4   Arkansas  2,977,853   181         6.1
## 5 California 38,993,940 1,861         4.8
## 6   Colorado  5,448,819   176         3.2</code></pre>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="section-3-overview.html#cb283-1" aria-hidden="true"></a><span class="kw">class</span>(murders_raw<span class="op">$</span>population)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="section-3-overview.html#cb285-1" aria-hidden="true"></a><span class="kw">class</span>(murders_raw<span class="op">$</span>total)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
</div>
<div id="defining-strings-single-and-double-quotes-and-how-to-escape" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Defining Strings: Single and Double Quotes and How to Escape</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html#how-to-escape-when-defining-strings" target="_blank">here</a>.</p>
<p><strong>Key points</strong></p>
<ul>
<li>Define a string by surrounding text with either single quotes or double quotes.</li>
<li>To include a single quote inside a string, use double quotes on the outside. To include a double quote inside a string, use single quotes on the outside.</li>
<li>The <code>cat()</code> function displays a string as it is represented inside R.</li>
<li>To include a double quote inside of a string surrounded by double quotes, use the backslash () to escape the double quote. Escape a single quote to include it inside of a string defined by single quotes.</li>
<li>We will see additional uses of the escape later.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="section-3-overview.html#cb287-1" aria-hidden="true"></a>s &lt;-<span class="st"> &quot;Hello!&quot;</span>    <span class="co"># double quotes define a string</span></span>
<span id="cb287-2"><a href="section-3-overview.html#cb287-2" aria-hidden="true"></a>s &lt;-<span class="st"> &#39;Hello!&#39;</span>    <span class="co"># single quotes define a string</span></span></code></pre></div>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="section-3-overview.html#cb288-1" aria-hidden="true"></a>s &lt;-<span class="st"> `</span><span class="dt">Hello</span><span class="st">`</span>    <span class="co"># backquotes do not</span></span>
<span id="cb288-2"><a href="section-3-overview.html#cb288-2" aria-hidden="true"></a>s &lt;-<span class="st"> &quot;10&quot;&quot;    # error - unclosed quotes</span></span></code></pre></div>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="section-3-overview.html#cb289-1" aria-hidden="true"></a>s &lt;-<span class="st"> &#39;10&quot;&#39;</span>    <span class="co"># correct</span></span>
<span id="cb289-2"><a href="section-3-overview.html#cb289-2" aria-hidden="true"></a></span>
<span id="cb289-3"><a href="section-3-overview.html#cb289-3" aria-hidden="true"></a><span class="co"># cat shows what the string actually looks like inside R</span></span>
<span id="cb289-4"><a href="section-3-overview.html#cb289-4" aria-hidden="true"></a><span class="kw">cat</span>(s)</span></code></pre></div>
<pre><code>## 10&quot;</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="section-3-overview.html#cb291-1" aria-hidden="true"></a>s &lt;-<span class="st"> &quot;5&#39;&quot;</span></span>
<span id="cb291-2"><a href="section-3-overview.html#cb291-2" aria-hidden="true"></a><span class="kw">cat</span>(s)</span></code></pre></div>
<pre><code>## 5&#39;</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="section-3-overview.html#cb293-1" aria-hidden="true"></a><span class="co"># to include both single and double quotes in string, escape with \</span></span>
<span id="cb293-2"><a href="section-3-overview.html#cb293-2" aria-hidden="true"></a>s &lt;-<span class="st"> &#39;5&#39;</span><span class="dv">10</span><span class="st">&quot;&#39;    # error</span></span>
<span id="cb293-3"><a href="section-3-overview.html#cb293-3" aria-hidden="true"></a><span class="st">s &lt;- &quot;</span><span class="dv">5</span><span class="st">&#39;10&quot;&quot;    # error</span></span></code></pre></div>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="section-3-overview.html#cb294-1" aria-hidden="true"></a><span class="co"># to include both single and double quotes in string, escape with \</span></span>
<span id="cb294-2"><a href="section-3-overview.html#cb294-2" aria-hidden="true"></a>s &lt;-<span class="st"> &#39;5</span><span class="ch">\&#39;</span><span class="st">10&quot;&#39;</span>    <span class="co"># correct</span></span>
<span id="cb294-3"><a href="section-3-overview.html#cb294-3" aria-hidden="true"></a><span class="kw">cat</span>(s)</span></code></pre></div>
<pre><code>## 5&#39;10&quot;</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="section-3-overview.html#cb296-1" aria-hidden="true"></a>s &lt;-<span class="st"> &quot;5&#39;10</span><span class="ch">\&quot;</span><span class="st">&quot;</span>    <span class="co"># correct</span></span>
<span id="cb296-2"><a href="section-3-overview.html#cb296-2" aria-hidden="true"></a><span class="kw">cat</span>(s)</span></code></pre></div>
<pre><code>## 5&#39;10&quot;</code></pre>
</div>
<div id="stringr-package" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> stringr Package</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html#stringr" target="_blank">here</a>.</p>
<p><strong>Key points</strong></p>
<ul>
<li>The main types of string processing tasks are detecting, locating, extracting and replacing elements of strings.</li>
<li>The <strong>stringr</strong> package from the <strong>tidyverse</strong> includes a variety of string processing functions that begin with <code>str_</code> and take the string as the first argument, which makes them compatible with the pipe.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="section-3-overview.html#cb298-1" aria-hidden="true"></a><span class="co"># murders_raw defined in web scraping section</span></span>
<span id="cb298-2"><a href="section-3-overview.html#cb298-2" aria-hidden="true"></a></span>
<span id="cb298-3"><a href="section-3-overview.html#cb298-3" aria-hidden="true"></a><span class="co"># direct conversion to numeric fails because of commas</span></span>
<span id="cb298-4"><a href="section-3-overview.html#cb298-4" aria-hidden="true"></a>murders_raw<span class="op">$</span>population[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] &quot;4,853,875&quot; &quot;737,709&quot;   &quot;6,817,565&quot;</code></pre>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="section-3-overview.html#cb300-1" aria-hidden="true"></a><span class="kw">as.numeric</span>(murders_raw<span class="op">$</span>population[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</span></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre><code>## [1] NA NA NA</code></pre>
</div>
<div id="case-study-1-us-murders-data" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Case Study 1: US Murders Data</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html#case-study-1-us-murders-data" target="_blank">here</a>.</p>
<p><strong>Key points</strong></p>
<ul>
<li>Use the <code>str_detect()</code> function to determine whether a string contains a certain pattern.</li>
<li>Use the <code>str_replace_all()</code> function to replace all instances of one pattern with another pattern. To remove a pattern, replace with the empty string (<code>""</code>).</li>
<li>The <code>parse_number()</code> function removes punctuation from strings and converts them to numeric.</li>
<li><code>mutate_at()</code> performs the same transformation on the specified column numbers.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="section-3-overview.html#cb303-1" aria-hidden="true"></a><span class="co"># murders_raw was defined in the web scraping section</span></span>
<span id="cb303-2"><a href="section-3-overview.html#cb303-2" aria-hidden="true"></a></span>
<span id="cb303-3"><a href="section-3-overview.html#cb303-3" aria-hidden="true"></a><span class="co"># detect whether there are commas</span></span>
<span id="cb303-4"><a href="section-3-overview.html#cb303-4" aria-hidden="true"></a>commas &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">any</span>(<span class="kw">str_detect</span>(x, <span class="st">&quot;,&quot;</span>))</span>
<span id="cb303-5"><a href="section-3-overview.html#cb303-5" aria-hidden="true"></a>murders_raw <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_all</span>(<span class="kw">funs</span>(commas))</span></code></pre></div>
<pre><code>## Warning: `funs()` is deprecated as of dplyr 0.8.0.
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>##   state population total murder_rate
## 1 FALSE       TRUE  TRUE       FALSE</code></pre>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="section-3-overview.html#cb306-1" aria-hidden="true"></a><span class="co"># replace commas with the empty string and convert to numeric</span></span>
<span id="cb306-2"><a href="section-3-overview.html#cb306-2" aria-hidden="true"></a>test_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(murders_raw<span class="op">$</span>population, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb306-3"><a href="section-3-overview.html#cb306-3" aria-hidden="true"></a>test_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(test_<span class="dv">1</span>)</span>
<span id="cb306-4"><a href="section-3-overview.html#cb306-4" aria-hidden="true"></a></span>
<span id="cb306-5"><a href="section-3-overview.html#cb306-5" aria-hidden="true"></a><span class="co"># parse_number also removes commas and converts to numeric</span></span>
<span id="cb306-6"><a href="section-3-overview.html#cb306-6" aria-hidden="true"></a>test_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">parse_number</span>(murders_raw<span class="op">$</span>population)</span>
<span id="cb306-7"><a href="section-3-overview.html#cb306-7" aria-hidden="true"></a><span class="kw">identical</span>(test_<span class="dv">1</span>, test_<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="section-3-overview.html#cb308-1" aria-hidden="true"></a>murders_new &lt;-<span class="st"> </span>murders_raw <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>, parse_number)</span>
<span id="cb308-2"><a href="section-3-overview.html#cb308-2" aria-hidden="true"></a>murders_new <span class="op">%&gt;%</span><span class="st"> </span>head</span></code></pre></div>
<pre><code>##        state population total murder_rate
## 1    Alabama    4853875   348         7.2
## 2     Alaska     737709    59         8.0
## 3    Arizona    6817565   309         4.5
## 4   Arkansas    2977853   181         6.1
## 5 California   38993940  1861         4.8
## 6   Colorado    5448819   176         3.2</code></pre>
</div>
<div id="assessment---string-processing-part-1" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Assessment - String Processing Part 1</h2>
<ol style="list-style-type: decimal">
<li>Which of the following is NOT an application of string parsing?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. Removing unwanted characters from text.</li>
<li><input type="checkbox" disabled="" />
B. Extracting numeric values from text.</li>
<li><input type="checkbox" disabled="" checked="" />
C. Formatting numbers and characters so they can easily be displayed in deliverables like papers and presentations.</li>
<li><input type="checkbox" disabled="" />
D. Splitting strings into multiple values.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Which of the following commands would not give you an error in R?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. <code>cat(" LeBron James is 6’8\" ")</code></li>
<li><input type="checkbox" disabled="" />
B. <code>cat(' LeBron James is 6'8" ')</code></li>
<li><input type="checkbox" disabled="" />
C. <code>cat(` LeBron James is 6'8" `)</code></li>
<li><input type="checkbox" disabled="" />
D. <code>cat(" LeBron James is 6\’8" ")</code></li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Which of the following are advantages of the <strong>stringr</strong> package over string processing functions in base R? Select all that apply.</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. Base R functions are rarely used for string processing by data scientists so it’s not worth learning them.</li>
<li><input type="checkbox" disabled="" checked="" />
B. Functions in stringr all start with “str_”, which makes them easy to look up using autocomplete.</li>
<li><input type="checkbox" disabled="" checked="" />
C. Stringr functions work better with pipes.</li>
<li><input type="checkbox" disabled="" checked="" />
D. The order of arguments is more consistent in stringr functions than in base R.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>You have a dataframe of monthly sales and profits in R</li>
</ol>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="section-3-overview.html#cb310-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(dat)</span>
<span id="cb310-2"><a href="section-3-overview.html#cb310-2" aria-hidden="true"></a><span class="co"># A tibble: 5 x 3</span></span>
<span id="cb310-3"><a href="section-3-overview.html#cb310-3" aria-hidden="true"></a>Month       Sales       Profit </span>
<span id="cb310-4"><a href="section-3-overview.html#cb310-4" aria-hidden="true"></a><span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">       </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">       </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">  </span></span>
<span id="cb310-5"><a href="section-3-overview.html#cb310-5" aria-hidden="true"></a>January     <span class="op">$</span><span class="dv">128</span>,<span class="dv">568</span>    <span class="op">$</span><span class="dv">16</span>,<span class="dv">234</span></span>
<span id="cb310-6"><a href="section-3-overview.html#cb310-6" aria-hidden="true"></a>February    <span class="op">$</span><span class="dv">109</span>,<span class="dv">523</span>    <span class="op">$</span><span class="dv">12</span>,<span class="dv">876</span></span>
<span id="cb310-7"><a href="section-3-overview.html#cb310-7" aria-hidden="true"></a>March       <span class="op">$</span><span class="dv">115</span>,<span class="dv">468</span>    <span class="op">$</span><span class="dv">17</span>,<span class="dv">920</span></span>
<span id="cb310-8"><a href="section-3-overview.html#cb310-8" aria-hidden="true"></a>April       <span class="op">$</span><span class="dv">122</span>,<span class="dv">274</span>    <span class="op">$</span><span class="dv">15</span>,<span class="dv">825</span></span>
<span id="cb310-9"><a href="section-3-overview.html#cb310-9" aria-hidden="true"></a>May         <span class="op">$</span><span class="dv">117</span>,<span class="dv">921</span>    <span class="op">$</span><span class="dv">15</span>,<span class="dv">437</span></span></code></pre></div>
<p>Which of the following commands could convert the sales and profits columns to numeric? Select all that apply.</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. <code>dat %&gt;% mutate_at(2:3, parse_number)</code></li>
<li><input type="checkbox" disabled="" />
B. <code>dat %&gt;% mutate_at(2:3, as.numeric)</code></li>
<li><input type="checkbox" disabled="" />
C. <code>dat %&gt;% mutate_all(parse_number)</code></li>
<li><input type="checkbox" disabled="" checked="" />
D. <code>dat %&gt;% mutate_at(2:3, funs(str_replace_all(., c("\\$|,"), ""))) %&gt;%mutate_at(2:3, as.numeric)</code></li>
</ul>
</div>
<div id="case-study-2-reported-heights" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Case Study 2: Reported Heights</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html#case-study-2-self-reported-heights" target="_blank">here</a>.</p>
<p><strong>Key points</strong></p>
<ul>
<li>In the raw heights data, many students did not report their height as the number of inches as requested. There are many entries with real height information but in the wrong format, which we can extract with string processing.</li>
<li>When there are both text and numeric entries in a column, the column will be a character vector. Converting this column to numeric will result in NAs for some entries.</li>
<li>To correct problematic entries, look for patterns that are shared across large numbers of entries, then define rules that identify those patterns and use these rules to write string processing tasks.</li>
<li>Use <code>suppressWarnings()</code> to hide warning messages for a function.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="section-3-overview.html#cb311-1" aria-hidden="true"></a><span class="co"># load raw heights data and inspect</span></span>
<span id="cb311-2"><a href="section-3-overview.html#cb311-2" aria-hidden="true"></a><span class="kw">data</span>(reported_heights)</span>
<span id="cb311-3"><a href="section-3-overview.html#cb311-3" aria-hidden="true"></a><span class="kw">class</span>(reported_heights<span class="op">$</span>height)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="section-3-overview.html#cb313-1" aria-hidden="true"></a><span class="co"># convert to numeric, inspect, count NAs</span></span>
<span id="cb313-2"><a href="section-3-overview.html#cb313-2" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(reported_heights<span class="op">$</span>height)</span></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="section-3-overview.html#cb315-1" aria-hidden="true"></a><span class="kw">head</span>(x)</span></code></pre></div>
<pre><code>## [1] 75 70 68 74 61 65</code></pre>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="section-3-overview.html#cb317-1" aria-hidden="true"></a><span class="kw">sum</span>(<span class="kw">is.na</span>(x))</span></code></pre></div>
<pre><code>## [1] 81</code></pre>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="section-3-overview.html#cb319-1" aria-hidden="true"></a><span class="co"># keep only entries that result in NAs</span></span>
<span id="cb319-2"><a href="section-3-overview.html#cb319-2" aria-hidden="true"></a>reported_heights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">new_height =</span> <span class="kw">as.numeric</span>(height)) <span class="op">%&gt;%</span></span>
<span id="cb319-3"><a href="section-3-overview.html#cb319-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(new_height)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb319-4"><a href="section-3-overview.html#cb319-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">head</span>(<span class="dt">n=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## Warning: Problem with `mutate()` input `new_height`.
## ℹ NAs introduced by coercion
## ℹ Input `new_height` is `as.numeric(height)`.</code></pre>
<pre><code>## Warning in mask$eval_all_mutate(dots[[i]]): NAs introduced by coercion</code></pre>
<pre><code>##             time_stamp    sex                 height new_height
## 1  2014-09-02 15:16:28   Male                  5&#39; 4&quot;         NA
## 2  2014-09-02 15:16:37 Female                  165cm         NA
## 3  2014-09-02 15:16:52   Male                    5&#39;7         NA
## 4  2014-09-02 15:16:56   Male                  &gt;9000         NA
## 5  2014-09-02 15:16:56   Male                   5&#39;7&quot;         NA
## 6  2014-09-02 15:17:09 Female                   5&#39;3&quot;         NA
## 7  2014-09-02 15:18:00   Male 5 feet and 8.11 inches         NA
## 8  2014-09-02 15:19:48   Male                   5&#39;11         NA
## 9  2014-09-04 00:46:45   Male                  5&#39;9&#39;&#39;         NA
## 10 2014-09-04 10:29:44   Male                 5&#39;10&#39;&#39;         NA</code></pre>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="section-3-overview.html#cb323-1" aria-hidden="true"></a><span class="co"># calculate cutoffs that cover 99.999% of human population</span></span>
<span id="cb323-2"><a href="section-3-overview.html#cb323-2" aria-hidden="true"></a>alpha &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">10</span><span class="op">^</span><span class="dv">6</span></span>
<span id="cb323-3"><a href="section-3-overview.html#cb323-3" aria-hidden="true"></a><span class="kw">qnorm</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>, <span class="fl">69.1</span>, <span class="fl">2.9</span>)</span></code></pre></div>
<pre><code>## [1] 83.28575</code></pre>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="section-3-overview.html#cb325-1" aria-hidden="true"></a><span class="kw">qnorm</span>(alpha<span class="op">/</span><span class="dv">2</span>, <span class="fl">63.7</span>, <span class="fl">2.7</span>)</span></code></pre></div>
<pre><code>## [1] 50.49258</code></pre>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="section-3-overview.html#cb327-1" aria-hidden="true"></a><span class="co"># keep only entries that either result in NAs or are outside the plausible range of heights</span></span>
<span id="cb327-2"><a href="section-3-overview.html#cb327-2" aria-hidden="true"></a>not_inches &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">smallest =</span> <span class="dv">50</span>, <span class="dt">tallest =</span> <span class="dv">84</span>){</span>
<span id="cb327-3"><a href="section-3-overview.html#cb327-3" aria-hidden="true"></a>  inches &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">as.numeric</span>(x))</span>
<span id="cb327-4"><a href="section-3-overview.html#cb327-4" aria-hidden="true"></a>  ind &lt;-<span class="st"> </span><span class="kw">is.na</span>(inches) <span class="op">|</span><span class="st"> </span>inches <span class="op">&lt;</span><span class="st"> </span>smallest <span class="op">|</span><span class="st"> </span>inches <span class="op">&gt;</span><span class="st"> </span>tallest</span>
<span id="cb327-5"><a href="section-3-overview.html#cb327-5" aria-hidden="true"></a>  ind</span>
<span id="cb327-6"><a href="section-3-overview.html#cb327-6" aria-hidden="true"></a>}</span>
<span id="cb327-7"><a href="section-3-overview.html#cb327-7" aria-hidden="true"></a></span>
<span id="cb327-8"><a href="section-3-overview.html#cb327-8" aria-hidden="true"></a><span class="co"># number of problematic entries</span></span>
<span id="cb327-9"><a href="section-3-overview.html#cb327-9" aria-hidden="true"></a>problems &lt;-<span class="st"> </span>reported_heights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb327-10"><a href="section-3-overview.html#cb327-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">not_inches</span>(height)) <span class="op">%&gt;%</span></span>
<span id="cb327-11"><a href="section-3-overview.html#cb327-11" aria-hidden="true"></a><span class="st">  </span>.<span class="op">$</span>height</span>
<span id="cb327-12"><a href="section-3-overview.html#cb327-12" aria-hidden="true"></a><span class="kw">length</span>(problems)</span></code></pre></div>
<pre><code>## [1] 292</code></pre>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="section-3-overview.html#cb329-1" aria-hidden="true"></a><span class="co"># 10 examples of x&#39;y or x&#39;y&quot; or x&#39;y\&quot;</span></span>
<span id="cb329-2"><a href="section-3-overview.html#cb329-2" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\\</span><span class="st">.*</span><span class="ch">\\</span><span class="st">d*&#39;*</span><span class="ch">\&quot;</span><span class="st">*$&quot;</span></span>
<span id="cb329-3"><a href="section-3-overview.html#cb329-3" aria-hidden="true"></a><span class="kw">str_subset</span>(problems, pattern) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n=</span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>cat</span></code></pre></div>
<pre><code>## 5&#39; 4&quot; 5&#39;7 5&#39;7&quot; 5&#39;3&quot; 5&#39;11 5&#39;9&#39;&#39; 5&#39;10&#39;&#39; 5&#39; 10 5&#39;5&quot; 5&#39;2&quot;</code></pre>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="section-3-overview.html#cb331-1" aria-hidden="true"></a><span class="co"># 10 examples of x.y or x,y</span></span>
<span id="cb331-2"><a href="section-3-overview.html#cb331-2" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^[4-6]</span><span class="ch">\\</span><span class="st">s*[</span><span class="ch">\\</span><span class="st">.|,]</span><span class="ch">\\</span><span class="st">s*([0-9]|10|11)$&quot;</span></span>
<span id="cb331-3"><a href="section-3-overview.html#cb331-3" aria-hidden="true"></a><span class="kw">str_subset</span>(problems, pattern) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n=</span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>cat</span></code></pre></div>
<pre><code>## 5.3 5.5 6.5 5.8 5.6 5,3 5.9 6,8 5.5 6.2</code></pre>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="section-3-overview.html#cb333-1" aria-hidden="true"></a><span class="co"># 10 examples of entries in cm rather than inches</span></span>
<span id="cb333-2"><a href="section-3-overview.html#cb333-2" aria-hidden="true"></a>ind &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">between</span>(<span class="kw">suppressWarnings</span>(<span class="kw">as.numeric</span>(problems))<span class="op">/</span><span class="fl">2.54</span>, <span class="dv">54</span>, <span class="dv">81</span>) )</span>
<span id="cb333-3"><a href="section-3-overview.html#cb333-3" aria-hidden="true"></a>ind &lt;-<span class="st"> </span>ind[<span class="op">!</span><span class="kw">is.na</span>(ind)]</span>
<span id="cb333-4"><a href="section-3-overview.html#cb333-4" aria-hidden="true"></a>problems[ind] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n=</span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>cat</span></code></pre></div>
<pre><code>## 150 175 177 178 163 175 178 165 165 180</code></pre>
</div>
<div id="regex" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> Regex</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html#regular-expressions" target="_blank">here</a> through <a href="https://rafalab.github.io/dsbook/string-processing.html#special-characters" target="_blank">section 24.5.2</a>.</p>
<p><strong>Key points</strong></p>
<ul>
<li>A regular expression (regex) is a way to describe a specific pattern of characters of text. A set of rules has been designed to do this specifically and efficiently.</li>
<li><strong>stringr</strong> functions can take a regex as a pattern.</li>
<li><code>str_detect()</code> indicates whether a pattern is present in a string.</li>
<li>The main difference between a regex and a regular string is that a regex can include special characters.</li>
<li>The | symbol inside a regex means “or”.</li>
<li>Use <code>'\\d'</code> to represent digits. The backlash is used to distinguish it from the character <code>'d'</code>. In R, you must use two backslashes for digits in regular expressions; in some other languages, you will only use one backslash for regex special characters.</li>
<li><code>str_view()</code> highlights the first occurrence of a pattern, and the <code>str_view_all()</code> function highlights all occurrences of the pattern.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="section-3-overview.html#cb335-1" aria-hidden="true"></a><span class="co"># detect whether a comma is present</span></span>
<span id="cb335-2"><a href="section-3-overview.html#cb335-2" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;,&quot;</span></span>
<span id="cb335-3"><a href="section-3-overview.html#cb335-3" aria-hidden="true"></a><span class="kw">str_detect</span>(murders_raw<span class="op">$</span>total, pattern) </span>
<span id="cb335-4"><a href="section-3-overview.html#cb335-4" aria-hidden="true"></a></span>
<span id="cb335-5"><a href="section-3-overview.html#cb335-5" aria-hidden="true"></a><span class="co"># show the subset of strings including &quot;cm&quot;</span></span>
<span id="cb335-6"><a href="section-3-overview.html#cb335-6" aria-hidden="true"></a><span class="kw">str_subset</span>(reported_heights<span class="op">$</span>height, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb335-7"><a href="section-3-overview.html#cb335-7" aria-hidden="true"></a></span>
<span id="cb335-8"><a href="section-3-overview.html#cb335-8" aria-hidden="true"></a><span class="co"># use the &quot;or&quot; symbol inside a regex (|)</span></span>
<span id="cb335-9"><a href="section-3-overview.html#cb335-9" aria-hidden="true"></a>yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;180 cm&quot;</span>, <span class="st">&quot;70 inches&quot;</span>)</span>
<span id="cb335-10"><a href="section-3-overview.html#cb335-10" aria-hidden="true"></a>no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;180&quot;</span>, <span class="st">&quot;70&#39;&#39;&quot;</span>)</span>
<span id="cb335-11"><a href="section-3-overview.html#cb335-11" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)</span>
<span id="cb335-12"><a href="section-3-overview.html#cb335-12" aria-hidden="true"></a><span class="kw">str_detect</span>(s, <span class="st">&quot;cm&quot;</span>) <span class="op">|</span><span class="st"> </span><span class="kw">str_detect</span>(s, <span class="st">&quot;inches&quot;</span>)</span>
<span id="cb335-13"><a href="section-3-overview.html#cb335-13" aria-hidden="true"></a><span class="kw">str_detect</span>(s, <span class="st">&quot;cm|inches&quot;</span>)</span>
<span id="cb335-14"><a href="section-3-overview.html#cb335-14" aria-hidden="true"></a></span>
<span id="cb335-15"><a href="section-3-overview.html#cb335-15" aria-hidden="true"></a><span class="co"># highlight the first occurrence of a pattern</span></span>
<span id="cb335-16"><a href="section-3-overview.html#cb335-16" aria-hidden="true"></a><span class="kw">str_view</span>(s, pattern)</span>
<span id="cb335-17"><a href="section-3-overview.html#cb335-17" aria-hidden="true"></a></span>
<span id="cb335-18"><a href="section-3-overview.html#cb335-18" aria-hidden="true"></a><span class="co"># highlight all instances of a pattern</span></span>
<span id="cb335-19"><a href="section-3-overview.html#cb335-19" aria-hidden="true"></a><span class="kw">str_view_all</span>(s, pattern)</span></code></pre></div>
</div>
<div id="character-classes-anchors-and-quantifiers" class="section level2" number="4.8">
<h2><span class="header-section-number">4.8</span> Character Classes, Anchors and Quantifiers</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html#character-classes" target="_blank">here</a>, <a href="https://rafalab.github.io/dsbook/string-processing.html#anchors" target="_blank">here</a> and <a href="https://rafalab.github.io/dsbook/string-processing.html#quantifiers" target="_blank">here</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>Define strings to test your regular expressions, including some elements that match and some that do not. This allows you to check for the two types of errors: failing to match and matching incorrectly.</li>
<li>Square brackets define character classes: groups of characters that count as matching the pattern. You can use ranges to define character classes, such as <code>[0-9]</code> for digits and <code>[a-zA-Z]</code> for all letters.</li>
<li>Anchors define patterns that must start or end at specific places. <code>^</code> and <code>$</code> represent the beginning and end of the string respectively.</li>
<li>Curly braces are quantifiers that state how many times a certain character can be repeated in the pattern. <code>\\d{1,2}</code> matches exactly 1 or 2 consecutive digits.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="section-3-overview.html#cb336-1" aria-hidden="true"></a><span class="co"># s was defined in the previous section</span></span>
<span id="cb336-2"><a href="section-3-overview.html#cb336-2" aria-hidden="true"></a>yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;5&#39;10&quot;</span>, <span class="st">&quot;5 feet&quot;</span>, <span class="st">&quot;4&#39;11&quot;</span>)</span>
<span id="cb336-3"><a href="section-3-overview.html#cb336-3" aria-hidden="true"></a>no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;Five&quot;</span>, <span class="st">&quot;six&quot;</span>)</span>
<span id="cb336-4"><a href="section-3-overview.html#cb336-4" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)</span>
<span id="cb336-5"><a href="section-3-overview.html#cb336-5" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">d&quot;</span></span>
<span id="cb336-6"><a href="section-3-overview.html#cb336-6" aria-hidden="true"></a></span>
<span id="cb336-7"><a href="section-3-overview.html#cb336-7" aria-hidden="true"></a><span class="co"># [56] means 5 or 6</span></span>
<span id="cb336-8"><a href="section-3-overview.html#cb336-8" aria-hidden="true"></a><span class="kw">str_view</span>(s, <span class="st">&quot;[56]&quot;</span>)</span>
<span id="cb336-9"><a href="section-3-overview.html#cb336-9" aria-hidden="true"></a></span>
<span id="cb336-10"><a href="section-3-overview.html#cb336-10" aria-hidden="true"></a><span class="co"># [4-7] means 4, 5, 6 or 7</span></span>
<span id="cb336-11"><a href="section-3-overview.html#cb336-11" aria-hidden="true"></a>yes &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="dv">4</span><span class="op">:</span><span class="dv">7</span>)</span>
<span id="cb336-12"><a href="section-3-overview.html#cb336-12" aria-hidden="true"></a>no &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</span>
<span id="cb336-13"><a href="section-3-overview.html#cb336-13" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)</span>
<span id="cb336-14"><a href="section-3-overview.html#cb336-14" aria-hidden="true"></a><span class="kw">str_detect</span>(s, <span class="st">&quot;[4-7]&quot;</span>)</span>
<span id="cb336-15"><a href="section-3-overview.html#cb336-15" aria-hidden="true"></a></span>
<span id="cb336-16"><a href="section-3-overview.html#cb336-16" aria-hidden="true"></a><span class="co"># ^ means start of string, $ means end of string</span></span>
<span id="cb336-17"><a href="section-3-overview.html#cb336-17" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^</span><span class="ch">\\</span><span class="st">d$&quot;</span></span>
<span id="cb336-18"><a href="section-3-overview.html#cb336-18" aria-hidden="true"></a>yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;9&quot;</span>)</span>
<span id="cb336-19"><a href="section-3-overview.html#cb336-19" aria-hidden="true"></a>no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;12&quot;</span>, <span class="st">&quot;123&quot;</span>, <span class="st">&quot; 1&quot;</span>, <span class="st">&quot;a4&quot;</span>, <span class="st">&quot;b&quot;</span>)</span>
<span id="cb336-20"><a href="section-3-overview.html#cb336-20" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)</span>
<span id="cb336-21"><a href="section-3-overview.html#cb336-21" aria-hidden="true"></a><span class="kw">str_view</span>(s, pattern)</span>
<span id="cb336-22"><a href="section-3-overview.html#cb336-22" aria-hidden="true"></a></span>
<span id="cb336-23"><a href="section-3-overview.html#cb336-23" aria-hidden="true"></a><span class="co"># curly braces define quantifiers: 1 or 2 digits </span></span>
<span id="cb336-24"><a href="section-3-overview.html#cb336-24" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^</span><span class="ch">\\</span><span class="st">d{1,2}$&quot;</span></span>
<span id="cb336-25"><a href="section-3-overview.html#cb336-25" aria-hidden="true"></a>yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;12&quot;</span>)</span>
<span id="cb336-26"><a href="section-3-overview.html#cb336-26" aria-hidden="true"></a>no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;123&quot;</span>, <span class="st">&quot;a4&quot;</span>, <span class="st">&quot;b&quot;</span>)</span>
<span id="cb336-27"><a href="section-3-overview.html#cb336-27" aria-hidden="true"></a><span class="kw">str_view</span>(<span class="kw">c</span>(yes, no), pattern)</span>
<span id="cb336-28"><a href="section-3-overview.html#cb336-28" aria-hidden="true"></a></span>
<span id="cb336-29"><a href="section-3-overview.html#cb336-29" aria-hidden="true"></a><span class="co"># combining character class, anchors and quantifier</span></span>
<span id="cb336-30"><a href="section-3-overview.html#cb336-30" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^[4-7]&#39;</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\&quot;</span><span class="st">$&quot;</span></span>
<span id="cb336-31"><a href="section-3-overview.html#cb336-31" aria-hidden="true"></a>yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&#39;7</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;6&#39;2</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,  <span class="st">&quot;5&#39;12</span><span class="ch">\&quot;</span><span class="st">&quot;</span>)</span>
<span id="cb336-32"><a href="section-3-overview.html#cb336-32" aria-hidden="true"></a>no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;6,2</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;6.2</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,<span class="st">&quot;I am 5&#39;11</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;3&#39;2</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;64&quot;</span>)</span>
<span id="cb336-33"><a href="section-3-overview.html#cb336-33" aria-hidden="true"></a><span class="kw">str_detect</span>(yes, pattern)</span>
<span id="cb336-34"><a href="section-3-overview.html#cb336-34" aria-hidden="true"></a><span class="kw">str_detect</span>(no, pattern)</span></code></pre></div>
</div>
<div id="search-and-replace-with-regex" class="section level2" number="4.9">
<h2><span class="header-section-number">4.9</span> Search and Replace with Regex</h2>
<p>The textbook for this section is available:</p>
<ul>
<li><a href="https://rafalab.github.io/dsbook/string-processing.html#search-and-replace-with-regex" target="_blank">searching and replacing with regex</a>.</li>
<li><a href="https://rafalab.github.io/dsbook/string-processing.html#white-space-s" target="_blank">white space</a>.</li>
<li><a href="https://rafalab.github.io/dsbook/string-processing.html#quantifiers-1" target="_blank">quantifiers: *, +, ?</a>.</li>
</ul>
<p><strong>Key points</strong></p>
<ul>
<li><code>str_replace()</code> replaces the first instance of the detected pattern with a specified string.</li>
<li>Spaces are characters and R does not ignore them. Spaces are specified by the special character <code>\\s</code>.</li>
<li>Additional quantifiers include <code>*</code>, <code>+</code> and <code>?</code>. <code>*</code> means 0 or more instances of the previous character. <code>?</code> means 0 or 1 instances. <code>+</code> means 1 or more instances.</li>
<li>Before removing characters from strings with functions like <code>str_replace()</code> and <code>str_replace_all()</code>, consider whether that replacement would have unintended effects.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="section-3-overview.html#cb337-1" aria-hidden="true"></a><span class="co"># number of entries matching our desired pattern</span></span>
<span id="cb337-2"><a href="section-3-overview.html#cb337-2" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^[4-7]&#39;</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\&quot;</span><span class="st">$&quot;</span></span>
<span id="cb337-3"><a href="section-3-overview.html#cb337-3" aria-hidden="true"></a><span class="kw">sum</span>(<span class="kw">str_detect</span>(problems, pattern))</span>
<span id="cb337-4"><a href="section-3-overview.html#cb337-4" aria-hidden="true"></a></span>
<span id="cb337-5"><a href="section-3-overview.html#cb337-5" aria-hidden="true"></a><span class="co"># inspect examples of entries with problems</span></span>
<span id="cb337-6"><a href="section-3-overview.html#cb337-6" aria-hidden="true"></a>problems[<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">15</span>)] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_view</span>(pattern)</span>
<span id="cb337-7"><a href="section-3-overview.html#cb337-7" aria-hidden="true"></a><span class="kw">str_subset</span>(problems, <span class="st">&quot;inches&quot;</span>)</span>
<span id="cb337-8"><a href="section-3-overview.html#cb337-8" aria-hidden="true"></a><span class="kw">str_subset</span>(problems, <span class="st">&quot;&#39;&#39;&quot;</span>)</span>
<span id="cb337-9"><a href="section-3-overview.html#cb337-9" aria-hidden="true"></a></span>
<span id="cb337-10"><a href="section-3-overview.html#cb337-10" aria-hidden="true"></a><span class="co"># replace or remove feet/inches words before matching</span></span>
<span id="cb337-11"><a href="section-3-overview.html#cb337-11" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^[4-7]&#39;</span><span class="ch">\\</span><span class="st">d{1,2}$&quot;</span></span>
<span id="cb337-12"><a href="section-3-overview.html#cb337-12" aria-hidden="true"></a>problems <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-13"><a href="section-3-overview.html#cb337-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;feet|ft|foot&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># replace feet, ft, foot with &#39; </span></span>
<span id="cb337-14"><a href="section-3-overview.html#cb337-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove all inches symbols</span></span>
<span id="cb337-15"><a href="section-3-overview.html#cb337-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_detect</span>(pattern) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-16"><a href="section-3-overview.html#cb337-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">sum</span>()</span>
<span id="cb337-17"><a href="section-3-overview.html#cb337-17" aria-hidden="true"></a></span>
<span id="cb337-18"><a href="section-3-overview.html#cb337-18" aria-hidden="true"></a><span class="co"># R does not ignore whitespace</span></span>
<span id="cb337-19"><a href="section-3-overview.html#cb337-19" aria-hidden="true"></a><span class="kw">identical</span>(<span class="st">&quot;Hi&quot;</span>, <span class="st">&quot;Hi &quot;</span>)</span>
<span id="cb337-20"><a href="section-3-overview.html#cb337-20" aria-hidden="true"></a></span>
<span id="cb337-21"><a href="section-3-overview.html#cb337-21" aria-hidden="true"></a><span class="co"># \\s represents whitespace</span></span>
<span id="cb337-22"><a href="section-3-overview.html#cb337-22" aria-hidden="true"></a>pattern_<span class="dv">2</span> &lt;-<span class="st"> &quot;^[4-7]&#39;</span><span class="ch">\\</span><span class="st">s</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\&quot;</span><span class="st">$&quot;</span></span>
<span id="cb337-23"><a href="section-3-overview.html#cb337-23" aria-hidden="true"></a><span class="kw">str_subset</span>(problems, pattern_<span class="dv">2</span>)</span>
<span id="cb337-24"><a href="section-3-overview.html#cb337-24" aria-hidden="true"></a></span>
<span id="cb337-25"><a href="section-3-overview.html#cb337-25" aria-hidden="true"></a><span class="co"># * means 0 or more instances of a character</span></span>
<span id="cb337-26"><a href="section-3-overview.html#cb337-26" aria-hidden="true"></a>yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;AB&quot;</span>, <span class="st">&quot;A1B&quot;</span>, <span class="st">&quot;A11B&quot;</span>, <span class="st">&quot;A111B&quot;</span>, <span class="st">&quot;A1111B&quot;</span>)</span>
<span id="cb337-27"><a href="section-3-overview.html#cb337-27" aria-hidden="true"></a>no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A2B&quot;</span>, <span class="st">&quot;A21B&quot;</span>)</span>
<span id="cb337-28"><a href="section-3-overview.html#cb337-28" aria-hidden="true"></a><span class="kw">str_detect</span>(yes, <span class="st">&quot;A1*B&quot;</span>)</span>
<span id="cb337-29"><a href="section-3-overview.html#cb337-29" aria-hidden="true"></a><span class="kw">str_detect</span>(no, <span class="st">&quot;A1*B&quot;</span>)</span>
<span id="cb337-30"><a href="section-3-overview.html#cb337-30" aria-hidden="true"></a></span>
<span id="cb337-31"><a href="section-3-overview.html#cb337-31" aria-hidden="true"></a><span class="co"># test how *, ? and + differ</span></span>
<span id="cb337-32"><a href="section-3-overview.html#cb337-32" aria-hidden="true"></a><span class="kw">data.frame</span>(<span class="dt">string =</span> <span class="kw">c</span>(<span class="st">&quot;AB&quot;</span>, <span class="st">&quot;A1B&quot;</span>, <span class="st">&quot;A11B&quot;</span>, <span class="st">&quot;A111B&quot;</span>, <span class="st">&quot;A1111B&quot;</span>),</span>
<span id="cb337-33"><a href="section-3-overview.html#cb337-33" aria-hidden="true"></a>           <span class="dt">none_or_more =</span> <span class="kw">str_detect</span>(yes, <span class="st">&quot;A1*B&quot;</span>),</span>
<span id="cb337-34"><a href="section-3-overview.html#cb337-34" aria-hidden="true"></a>           <span class="dt">nore_or_once =</span> <span class="kw">str_detect</span>(yes, <span class="st">&quot;A1?B&quot;</span>),</span>
<span id="cb337-35"><a href="section-3-overview.html#cb337-35" aria-hidden="true"></a>           <span class="dt">once_or_more =</span> <span class="kw">str_detect</span>(yes, <span class="st">&quot;A1+B&quot;</span>))</span>
<span id="cb337-36"><a href="section-3-overview.html#cb337-36" aria-hidden="true"></a>           </span>
<span id="cb337-37"><a href="section-3-overview.html#cb337-37" aria-hidden="true"></a><span class="co"># update pattern by adding optional spaces before and after feet symbol</span></span>
<span id="cb337-38"><a href="section-3-overview.html#cb337-38" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^[4-7]</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">d{1,2}$&quot;</span></span>
<span id="cb337-39"><a href="section-3-overview.html#cb337-39" aria-hidden="true"></a>problems <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-40"><a href="section-3-overview.html#cb337-40" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;feet|ft|foot&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># replace feet, ft, foot with &#39; </span></span>
<span id="cb337-41"><a href="section-3-overview.html#cb337-41" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove all inches symbols</span></span>
<span id="cb337-42"><a href="section-3-overview.html#cb337-42" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_detect</span>(pattern) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-43"><a href="section-3-overview.html#cb337-43" aria-hidden="true"></a><span class="st">  </span><span class="kw">sum</span>()</span></code></pre></div>
</div>
<div id="groups-with-regex" class="section level2" number="4.10">
<h2><span class="header-section-number">4.10</span> Groups with Regex</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html#groups" target="_blank">here</a>.</p>
<p><strong>Key Points</strong></p>
<ul>
<li>Groups are defined using parentheses.</li>
<li>Once we define groups, we can use the function <code>str_match()</code> to extract the values these groups define. <code>str_extract()</code> extracts only strings that match a pattern, not the values defined by groups.</li>
<li>You can refer to the ith group with <code>\\i</code>. For example, refer to the value in the second group with <code>\\2</code>.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="section-3-overview.html#cb338-1" aria-hidden="true"></a><span class="co"># define regex with and without groups</span></span>
<span id="cb338-2"><a href="section-3-overview.html#cb338-2" aria-hidden="true"></a>pattern_without_groups &lt;-<span class="st"> &quot;^[4-7],</span><span class="ch">\\</span><span class="st">d*$&quot;</span></span>
<span id="cb338-3"><a href="section-3-overview.html#cb338-3" aria-hidden="true"></a>pattern_with_groups &lt;-<span class="st">  &quot;^([4-7]),(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span></span>
<span id="cb338-4"><a href="section-3-overview.html#cb338-4" aria-hidden="true"></a></span>
<span id="cb338-5"><a href="section-3-overview.html#cb338-5" aria-hidden="true"></a><span class="co"># create examples</span></span>
<span id="cb338-6"><a href="section-3-overview.html#cb338-6" aria-hidden="true"></a>yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5,9&quot;</span>, <span class="st">&quot;5,11&quot;</span>, <span class="st">&quot;6,&quot;</span>, <span class="st">&quot;6,1&quot;</span>)</span>
<span id="cb338-7"><a href="section-3-overview.html#cb338-7" aria-hidden="true"></a>no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&#39;9&quot;</span>, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;2,8&quot;</span>, <span class="st">&quot;6.1.1&quot;</span>)</span>
<span id="cb338-8"><a href="section-3-overview.html#cb338-8" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)</span>
<span id="cb338-9"><a href="section-3-overview.html#cb338-9" aria-hidden="true"></a></span>
<span id="cb338-10"><a href="section-3-overview.html#cb338-10" aria-hidden="true"></a><span class="co"># demonstrate the effect of groups</span></span>
<span id="cb338-11"><a href="section-3-overview.html#cb338-11" aria-hidden="true"></a><span class="kw">str_detect</span>(s, pattern_without_groups)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="section-3-overview.html#cb340-1" aria-hidden="true"></a><span class="kw">str_detect</span>(s, pattern_with_groups)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="section-3-overview.html#cb342-1" aria-hidden="true"></a><span class="co"># demonstrate difference between str_match and str_extract</span></span>
<span id="cb342-2"><a href="section-3-overview.html#cb342-2" aria-hidden="true"></a><span class="kw">str_match</span>(s, pattern_with_groups)</span></code></pre></div>
<pre><code>##      [,1]   [,2] [,3]
## [1,] &quot;5,9&quot;  &quot;5&quot;  &quot;9&quot; 
## [2,] &quot;5,11&quot; &quot;5&quot;  &quot;11&quot;
## [3,] &quot;6,&quot;   &quot;6&quot;  &quot;&quot;  
## [4,] &quot;6,1&quot;  &quot;6&quot;  &quot;1&quot; 
## [5,] NA     NA   NA  
## [6,] NA     NA   NA  
## [7,] NA     NA   NA  
## [8,] NA     NA   NA</code></pre>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="section-3-overview.html#cb344-1" aria-hidden="true"></a><span class="kw">str_extract</span>(s, pattern_with_groups)</span></code></pre></div>
<pre><code>## [1] &quot;5,9&quot;  &quot;5,11&quot; &quot;6,&quot;   &quot;6,1&quot;  NA     NA     NA     NA</code></pre>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="section-3-overview.html#cb346-1" aria-hidden="true"></a><span class="co"># improve the pattern to recognize more events</span></span>
<span id="cb346-2"><a href="section-3-overview.html#cb346-2" aria-hidden="true"></a>pattern_with_groups &lt;-<span class="st">  &quot;^([4-7]),(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span></span>
<span id="cb346-3"><a href="section-3-overview.html#cb346-3" aria-hidden="true"></a>yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5,9&quot;</span>, <span class="st">&quot;5,11&quot;</span>, <span class="st">&quot;6,&quot;</span>, <span class="st">&quot;6,1&quot;</span>)</span>
<span id="cb346-4"><a href="section-3-overview.html#cb346-4" aria-hidden="true"></a>no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&#39;9&quot;</span>, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;2,8&quot;</span>, <span class="st">&quot;6.1.1&quot;</span>)</span>
<span id="cb346-5"><a href="section-3-overview.html#cb346-5" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)</span>
<span id="cb346-6"><a href="section-3-overview.html#cb346-6" aria-hidden="true"></a><span class="kw">str_replace</span>(s, pattern_with_groups, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;5&#39;9&quot;   &quot;5&#39;11&quot;  &quot;6&#39;&quot;    &quot;6&#39;1&quot;   &quot;5&#39;9&quot;   &quot;,&quot;     &quot;2,8&quot;   &quot;6.1.1&quot;</code></pre>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="section-3-overview.html#cb348-1" aria-hidden="true"></a><span class="co"># final pattern</span></span>
<span id="cb348-2"><a href="section-3-overview.html#cb348-2" aria-hidden="true"></a>pattern_with_groups &lt;-<span class="st">&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span></span>
<span id="cb348-3"><a href="section-3-overview.html#cb348-3" aria-hidden="true"></a></span>
<span id="cb348-4"><a href="section-3-overview.html#cb348-4" aria-hidden="true"></a><span class="co"># combine stringr commands with the pipe</span></span>
<span id="cb348-5"><a href="section-3-overview.html#cb348-5" aria-hidden="true"></a><span class="kw">str_subset</span>(problems, pattern_with_groups) <span class="op">%&gt;%</span><span class="st"> </span>head</span></code></pre></div>
<pre><code>## [1] &quot;5.3&quot;  &quot;5.25&quot; &quot;5.5&quot;  &quot;6.5&quot;  &quot;5.8&quot;  &quot;5.6&quot;</code></pre>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="section-3-overview.html#cb350-1" aria-hidden="true"></a><span class="kw">str_subset</span>(problems, pattern_with_groups) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb350-2"><a href="section-3-overview.html#cb350-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(pattern_with_groups, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>head</span></code></pre></div>
<pre><code>## [1] &quot;5&#39;3&quot;  &quot;5&#39;25&quot; &quot;5&#39;5&quot;  &quot;6&#39;5&quot;  &quot;5&#39;8&quot;  &quot;5&#39;6&quot;</code></pre>
</div>
<div id="testing-and-improving" class="section level2" number="4.11">
<h2><span class="header-section-number">4.11</span> Testing and Improving</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html#testing-and-improving" target="_blank">here</a>.</p>
<p><strong>Key points</strong></p>
<ul>
<li>Wrangling with regular expressions is often an iterative process of testing the approach, looking for problematic entries, and improving the patterns.</li>
<li>Use the pipe to connect <strong>stringr</strong> functions.</li>
<li>It may not be worth writing code to correct every unique problem in the data, but string processing techniques are flexible enough for most needs.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="section-3-overview.html#cb352-1" aria-hidden="true"></a><span class="co"># function to detect entries with problems</span></span>
<span id="cb352-2"><a href="section-3-overview.html#cb352-2" aria-hidden="true"></a>not_inches_or_cm &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">smallest =</span> <span class="dv">50</span>, <span class="dt">tallest =</span> <span class="dv">84</span>){</span>
<span id="cb352-3"><a href="section-3-overview.html#cb352-3" aria-hidden="true"></a>    inches &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">as.numeric</span>(x))</span>
<span id="cb352-4"><a href="section-3-overview.html#cb352-4" aria-hidden="true"></a>    ind &lt;-<span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(inches) <span class="op">&amp;</span></span>
<span id="cb352-5"><a href="section-3-overview.html#cb352-5" aria-hidden="true"></a><span class="st">        </span>((inches <span class="op">&gt;=</span><span class="st"> </span>smallest <span class="op">&amp;</span><span class="st"> </span>inches <span class="op">&lt;=</span><span class="st"> </span>tallest) <span class="op">|</span></span>
<span id="cb352-6"><a href="section-3-overview.html#cb352-6" aria-hidden="true"></a><span class="st">             </span>(inches<span class="op">/</span><span class="fl">2.54</span> <span class="op">&gt;=</span><span class="st"> </span>smallest <span class="op">&amp;</span><span class="st"> </span>inches<span class="op">/</span><span class="fl">2.54</span> <span class="op">&lt;=</span><span class="st"> </span>tallest))</span>
<span id="cb352-7"><a href="section-3-overview.html#cb352-7" aria-hidden="true"></a>    <span class="op">!</span>ind</span>
<span id="cb352-8"><a href="section-3-overview.html#cb352-8" aria-hidden="true"></a>}</span>
<span id="cb352-9"><a href="section-3-overview.html#cb352-9" aria-hidden="true"></a></span>
<span id="cb352-10"><a href="section-3-overview.html#cb352-10" aria-hidden="true"></a><span class="co"># identify entries with problems</span></span>
<span id="cb352-11"><a href="section-3-overview.html#cb352-11" aria-hidden="true"></a>problems &lt;-<span class="st"> </span>reported_heights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb352-12"><a href="section-3-overview.html#cb352-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">not_inches_or_cm</span>(height)) <span class="op">%&gt;%</span></span>
<span id="cb352-13"><a href="section-3-overview.html#cb352-13" aria-hidden="true"></a><span class="st">  </span>.<span class="op">$</span>height</span>
<span id="cb352-14"><a href="section-3-overview.html#cb352-14" aria-hidden="true"></a><span class="kw">length</span>(problems)</span></code></pre></div>
<pre><code>## [1] 200</code></pre>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="section-3-overview.html#cb354-1" aria-hidden="true"></a>converted &lt;-<span class="st"> </span>problems <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb354-2"><a href="section-3-overview.html#cb354-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;feet|foot|ft&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#convert feet symbols to &#39;</span></span>
<span id="cb354-3"><a href="section-3-overview.html#cb354-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">#remove inches symbols</span></span>
<span id="cb354-4"><a href="section-3-overview.html#cb354-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>) <span class="co">##change format</span></span>
<span id="cb354-5"><a href="section-3-overview.html#cb354-5" aria-hidden="true"></a></span>
<span id="cb354-6"><a href="section-3-overview.html#cb354-6" aria-hidden="true"></a><span class="co"># find proportion of entries that fit the pattern after reformatting</span></span>
<span id="cb354-7"><a href="section-3-overview.html#cb354-7" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^[4-7]</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">d{1,2}$&quot;</span></span>
<span id="cb354-8"><a href="section-3-overview.html#cb354-8" aria-hidden="true"></a>index &lt;-<span class="st"> </span><span class="kw">str_detect</span>(converted, pattern)</span>
<span id="cb354-9"><a href="section-3-overview.html#cb354-9" aria-hidden="true"></a><span class="kw">mean</span>(index)</span></code></pre></div>
<pre><code>## [1] 0.615</code></pre>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="section-3-overview.html#cb356-1" aria-hidden="true"></a>converted[<span class="op">!</span>index]    <span class="co"># show problems</span></span></code></pre></div>
<pre><code>##  [1] &quot;6&quot;             &quot;165cm&quot;         &quot;511&quot;           &quot;6&quot;             &quot;2&quot;             &quot;&gt;9000&quot;         &quot;5 &#39; and 8.11 &quot; &quot;11111&quot;         &quot;6&quot;             &quot;103.2&quot;         &quot;19&quot;           
## [12] &quot;5&quot;             &quot;300&quot;           &quot;6&#39;&quot;            &quot;6&quot;             &quot;Five &#39; eight &quot; &quot;7&quot;             &quot;214&quot;           &quot;6&quot;             &quot;0.7&quot;           &quot;6&quot;             &quot;2&#39;33&quot;         
## [23] &quot;612&quot;           &quot;1,70&quot;          &quot;87&quot;            &quot;5&#39;7.5&quot;         &quot;5&#39;7.5&quot;         &quot;111&quot;           &quot;5&#39; 7.78&quot;       &quot;12&quot;            &quot;6&quot;             &quot;yyy&quot;           &quot;89&quot;           
## [34] &quot;34&quot;            &quot;25&quot;            &quot;6&quot;             &quot;6&quot;             &quot;22&quot;            &quot;684&quot;           &quot;6&quot;             &quot;1&quot;             &quot;1&quot;             &quot;6*12&quot;          &quot;87&quot;           
## [45] &quot;6&quot;             &quot;1.6&quot;           &quot;120&quot;           &quot;120&quot;           &quot;23&quot;            &quot;1.7&quot;           &quot;6&quot;             &quot;5&quot;             &quot;69&quot;            &quot;5&#39; 9 &quot;         &quot;5 &#39; 9 &quot;       
## [56] &quot;6&quot;             &quot;6&quot;             &quot;86&quot;            &quot;708,661&quot;       &quot;5 &#39; 6 &quot;        &quot;6&quot;             &quot;649,606&quot;       &quot;10000&quot;         &quot;1&quot;             &quot;728,346&quot;       &quot;0&quot;            
## [67] &quot;6&quot;             &quot;6&quot;             &quot;6&quot;             &quot;100&quot;           &quot;88&quot;            &quot;6&quot;             &quot;170 cm&quot;        &quot;7,283,465&quot;     &quot;5&quot;             &quot;5&quot;             &quot;34&quot;</code></pre>
</div>
<div id="assessment---string-processing-part-2" class="section level2" number="4.12">
<h2><span class="header-section-number">4.12</span> Assessment - String Processing Part 2</h2>
<ol style="list-style-type: decimal">
<li>In the video, we use the function <code>not_inches</code> to identify heights that were incorrectly entered</li>
</ol>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="section-3-overview.html#cb358-1" aria-hidden="true"></a>not_inches &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">smallest =</span> <span class="dv">50</span>, <span class="dt">tallest =</span> <span class="dv">84</span>) {</span>
<span id="cb358-2"><a href="section-3-overview.html#cb358-2" aria-hidden="true"></a>  inches &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">as.numeric</span>(x))</span>
<span id="cb358-3"><a href="section-3-overview.html#cb358-3" aria-hidden="true"></a>  ind &lt;-<span class="st"> </span><span class="kw">is.na</span>(inches) <span class="op">|</span><span class="st"> </span>inches <span class="op">&lt;</span><span class="st"> </span>smallest <span class="op">|</span><span class="st"> </span>inches <span class="op">&gt;</span><span class="st"> </span>tallest </span>
<span id="cb358-4"><a href="section-3-overview.html#cb358-4" aria-hidden="true"></a>  ind</span>
<span id="cb358-5"><a href="section-3-overview.html#cb358-5" aria-hidden="true"></a>}</span></code></pre></div>
<p>In this function, what TWO types of values are identified as not being correctly formatted in inches?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. Values that specifically contain apostrophes (‘), periods (.) or quotations (“).</li>
<li><input type="checkbox" disabled="" checked="" />
B. Values that result in NA’s when converted to numeric</li>
<li><input type="checkbox" disabled="" checked="" />
C. Values less than 50 inches or greater than 84 inches</li>
<li><input type="checkbox" disabled="" />
D. Values that are stored as a character class, because most are already classed as numeric.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Which of the following arguments, when passed to the function <code>not_inches</code>, would return the vector <code>c(FALSE)</code>?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. <code>c(175)</code></li>
<li><input type="checkbox" disabled="" />
B. <code>c(“5’8\””)</code></li>
<li><input type="checkbox" disabled="" checked="" />
C. <code>c(70)</code></li>
<li><input type="checkbox" disabled="" />
D. <code>c(85)</code> (the height of Shaquille O’Neal in inches)</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Our function <code>not_inches</code> returns the object <code>ind</code>. Which answer correctly describes <code>ind</code>?</li>
</ol>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. <code>ind</code> is a logical vector of TRUE and FALSE, equal in length to the vector <code>x</code> (in the arguments list). TRUE indicates that a height entry is incorrectly formatted.</li>
<li><input type="checkbox" disabled="" />
B. <code>ind</code> is a logical vector of TRUE and FALSE, equal in length to the vector <code>x</code> (in the arguments list). TRUE indicates that a height entry is correctly formatted.</li>
<li><input type="checkbox" disabled="" />
C. <code>ind</code> is a data frame like our <code>reported_heights</code> table but with an extra column of TRUE or FALSE. TRUE indicates that a height entry is incorrectly formatted.</li>
<li><input type="checkbox" disabled="" />
D. <code>ind</code> is a numeric vector equal to <code>reported_heights$heights</code> but with incorrectly formatted heights replaced with NAs.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Given the following code</li>
</ol>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="section-3-overview.html#cb359-1" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;70&quot;</span>, <span class="st">&quot;5 ft&quot;</span>, <span class="st">&quot;4&#39;11&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;Six feet&quot;</span>)</span>
<span id="cb359-2"><a href="section-3-overview.html#cb359-2" aria-hidden="true"></a>s</span></code></pre></div>
<pre><code>## [1] &quot;70&quot;       &quot;5 ft&quot;     &quot;4&#39;11&quot;     &quot;&quot;         &quot;.&quot;        &quot;Six feet&quot;</code></pre>
<p>What <code>pattern</code> vector yields the following result?</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="section-3-overview.html#cb361-1" aria-hidden="true"></a><span class="kw">str_view_all</span>(s, pattern)</span>
<span id="cb361-2"><a href="section-3-overview.html#cb361-2" aria-hidden="true"></a><span class="dv">70</span></span>
<span id="cb361-3"><a href="section-3-overview.html#cb361-3" aria-hidden="true"></a><span class="dv">5</span> ft</span>
<span id="cb361-4"><a href="section-3-overview.html#cb361-4" aria-hidden="true"></a>4’<span class="dv">11</span></span>
<span id="cb361-5"><a href="section-3-overview.html#cb361-5" aria-hidden="true"></a>.</span>
<span id="cb361-6"><a href="section-3-overview.html#cb361-6" aria-hidden="true"></a>Six feet</span></code></pre></div>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="section-3-overview.html#cb362-1" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">d|ft&quot;</span></span>
<span id="cb362-2"><a href="section-3-overview.html#cb362-2" aria-hidden="true"></a><span class="kw">str_view_all</span>(s, pattern)</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. <code>pattern &lt;- "\\d|ft"</code></li>
<li><input type="checkbox" disabled="" />
B. <code>pattern &lt;- "\d|ft"</code></li>
<li><input type="checkbox" disabled="" />
C. <code>pattern &lt;- "\\d\\d|ft"</code></li>
<li><input type="checkbox" disabled="" />
D. <code>pattern &lt;- "\\d|feet"</code></li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>You enter the following set of commands into your R console. What is your printed result?</li>
</ol>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="section-3-overview.html#cb363-1" aria-hidden="true"></a>animals &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;cat&quot;</span>, <span class="st">&quot;puppy&quot;</span>, <span class="st">&quot;Moose&quot;</span>, <span class="st">&quot;MONKEY&quot;</span>)</span>
<span id="cb363-2"><a href="section-3-overview.html#cb363-2" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;[a-z]&quot;</span></span>
<span id="cb363-3"><a href="section-3-overview.html#cb363-3" aria-hidden="true"></a><span class="kw">str_detect</span>(animals, pattern)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. TRUE</li>
<li><input type="checkbox" disabled="" />
B. TRUE TRUE TRUE TRUE</li>
<li><input type="checkbox" disabled="" checked="" />
C. TRUE TRUE TRUE FALSE</li>
<li><input type="checkbox" disabled="" />
D. TRUE TRUE FALSE FALSE</li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li>You enter the following set of commands into your R console. What is your printed result?</li>
</ol>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="section-3-overview.html#cb365-1" aria-hidden="true"></a>animals &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;cat&quot;</span>, <span class="st">&quot;puppy&quot;</span>, <span class="st">&quot;Moose&quot;</span>, <span class="st">&quot;MONKEY&quot;</span>)</span>
<span id="cb365-2"><a href="section-3-overview.html#cb365-2" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;[A-Z]$&quot;</span></span>
<span id="cb365-3"><a href="section-3-overview.html#cb365-3" aria-hidden="true"></a><span class="kw">str_detect</span>(animals, pattern)</span></code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE  TRUE</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. FALSE FALSE FALSE FALSE</li>
<li><input type="checkbox" disabled="" />
B. FALSE FALSE TRUE TRUE</li>
<li><input type="checkbox" disabled="" checked="" />
C. FALSE FALSE FALSE TRUE</li>
<li><input type="checkbox" disabled="" />
D. TRUE TRUE TRUE FALSE</li>
</ul>
<ol start="7" style="list-style-type: decimal">
<li>You enter the following set of commands into your R console. What is your printed result?</li>
</ol>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="section-3-overview.html#cb367-1" aria-hidden="true"></a>animals &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;cat&quot;</span>, <span class="st">&quot;puppy&quot;</span>, <span class="st">&quot;Moose&quot;</span>, <span class="st">&quot;MONKEY&quot;</span>)</span>
<span id="cb367-2"><a href="section-3-overview.html#cb367-2" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;[a-z]{4,5}&quot;</span></span>
<span id="cb367-3"><a href="section-3-overview.html#cb367-3" aria-hidden="true"></a><span class="kw">str_detect</span>(animals, pattern)</span></code></pre></div>
<pre><code>## [1] FALSE  TRUE  TRUE FALSE</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. FALSE TRUE TRUE FALSE</li>
<li><input type="checkbox" disabled="" />
B. TRUE TRUE FALSE FALSE</li>
<li><input type="checkbox" disabled="" />
C. FALSE FALSE FALSE TRUE</li>
<li><input type="checkbox" disabled="" />
D. TRUE TRUE TRUE FALSE</li>
</ul>
<ol start="8" style="list-style-type: decimal">
<li>Given the following code</li>
</ol>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="section-3-overview.html#cb369-1" aria-hidden="true"></a>animals &lt;-<span class="st"> </span><span class="kw">c</span>(“moose”, “monkey”, “meerkat”, “mountain lion”) </span>
<span id="cb369-2"><a href="section-3-overview.html#cb369-2" aria-hidden="true"></a><span class="op">------------</span></span>
<span id="cb369-3"><a href="section-3-overview.html#cb369-3" aria-hidden="true"></a><span class="kw">str_detect</span>(animals, pattern)</span></code></pre></div>
<p>Which TWO “pattern” vectors would yield the following result?</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="section-3-overview.html#cb370-1" aria-hidden="true"></a>[<span class="dv">1</span>] <span class="ot">TRUE</span> <span class="ot">TRUE</span> <span class="ot">TRUE</span> <span class="ot">TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="section-3-overview.html#cb371-1" aria-hidden="true"></a>animals &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;moose&quot;</span>, <span class="st">&quot;monkey&quot;</span>, <span class="st">&quot;meerkat&quot;</span>, <span class="st">&quot;mountain lion&quot;</span>) </span>
<span id="cb371-2"><a href="section-3-overview.html#cb371-2" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;mo*&quot;</span></span>
<span id="cb371-3"><a href="section-3-overview.html#cb371-3" aria-hidden="true"></a><span class="kw">str_detect</span>(animals, pattern)</span></code></pre></div>
<pre><code>## [1] TRUE TRUE TRUE TRUE</code></pre>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="section-3-overview.html#cb373-1" aria-hidden="true"></a>animals &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;moose&quot;</span>, <span class="st">&quot;monkey&quot;</span>, <span class="st">&quot;meerkat&quot;</span>, <span class="st">&quot;mountain lion&quot;</span>) </span>
<span id="cb373-2"><a href="section-3-overview.html#cb373-2" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;mo?&quot;</span></span>
<span id="cb373-3"><a href="section-3-overview.html#cb373-3" aria-hidden="true"></a><span class="kw">str_detect</span>(animals, pattern)</span></code></pre></div>
<pre><code>## [1] TRUE TRUE TRUE TRUE</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. <code>pattern &lt;- "mo*"</code></li>
<li><input type="checkbox" disabled="" checked="" />
B. <code>pattern &lt;- "mo?"</code></li>
<li><input type="checkbox" disabled="" />
C. <code>pattern &lt;- "mo+"</code></li>
<li><input type="checkbox" disabled="" />
D. <code>pattern &lt;- "moo*"</code></li>
</ul>
<ol start="9" style="list-style-type: decimal">
<li>You are working on some data from different universities. You have the following vector</li>
</ol>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="section-3-overview.html#cb375-1" aria-hidden="true"></a>schools &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;U. Kentucky&quot;</span>, <span class="st">&quot;Univ New Hampshire&quot;</span>, <span class="st">&quot;Univ. of Massachusetts&quot;</span>, <span class="st">&quot;University Georgia&quot;</span>, <span class="st">&quot;U California&quot;</span>, <span class="st">&quot;California State University&quot;</span>)</span>
<span id="cb375-2"><a href="section-3-overview.html#cb375-2" aria-hidden="true"></a>schools</span></code></pre></div>
<pre><code>## [1] &quot;U. Kentucky&quot;                 &quot;Univ New Hampshire&quot;          &quot;Univ. of Massachusetts&quot;      &quot;University Georgia&quot;          &quot;U California&quot;               
## [6] &quot;California State University&quot;</code></pre>
<p>You want to clean this data to match the full names of each university</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="section-3-overview.html#cb377-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>final</span>
<span id="cb377-2"><a href="section-3-overview.html#cb377-2" aria-hidden="true"></a>[<span class="dv">1</span>] <span class="st">&quot;University of Kentucky&quot;</span>      <span class="st">&quot;University of New Hampshire&quot;</span> <span class="st">&quot;University of Massachusetts&quot;</span> <span class="st">&quot;University of Georgia&quot;</span>         </span>
<span id="cb377-3"><a href="section-3-overview.html#cb377-3" aria-hidden="true"></a>[<span class="dv">5</span>] <span class="st">&quot;University of California&quot;</span>    <span class="st">&quot;California State University&quot;</span></span></code></pre></div>
<p>What of the following commands could accomplish this?</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="section-3-overview.html#cb378-1" aria-hidden="true"></a>schools <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb378-2"><a href="section-3-overview.html#cb378-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^Univ</span><span class="ch">\\</span><span class="st">.?</span><span class="ch">\\</span><span class="st">s|^U</span><span class="ch">\\</span><span class="st">.?</span><span class="ch">\\</span><span class="st">s&quot;</span>, <span class="st">&quot;University &quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb378-3"><a href="section-3-overview.html#cb378-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^University of |^University &quot;</span>, <span class="st">&quot;University of &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;University of Kentucky&quot;      &quot;University of New Hampshire&quot; &quot;University of Massachusetts&quot; &quot;University of Georgia&quot;       &quot;University of California&quot;   
## [6] &quot;California State University&quot;</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A.</li>
</ul>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="section-3-overview.html#cb380-1" aria-hidden="true"></a>schools <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb380-2"><a href="section-3-overview.html#cb380-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;Univ</span><span class="ch">\\</span><span class="st">.?|U</span><span class="ch">\\</span><span class="st">.?&quot;</span>, <span class="st">&quot;University &quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb380-3"><a href="section-3-overview.html#cb380-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^University of |^University &quot;</span>, <span class="st">&quot;University of &quot;</span>)</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
B.</li>
</ul>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="section-3-overview.html#cb381-1" aria-hidden="true"></a>schools <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb381-2"><a href="section-3-overview.html#cb381-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^Univ</span><span class="ch">\\</span><span class="st">.?</span><span class="ch">\\</span><span class="st">s|^U</span><span class="ch">\\</span><span class="st">.?</span><span class="ch">\\</span><span class="st">s&quot;</span>, <span class="st">&quot;University &quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb381-3"><a href="section-3-overview.html#cb381-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^University of |^University &quot;</span>, <span class="st">&quot;University of &quot;</span>)</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
C.</li>
</ul>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="section-3-overview.html#cb382-1" aria-hidden="true"></a>schools <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb382-2"><a href="section-3-overview.html#cb382-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^Univ</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s|^U</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s&quot;</span>, <span class="st">&quot;University&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb382-3"><a href="section-3-overview.html#cb382-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^University of |^University &quot;</span>, <span class="st">&quot;University of &quot;</span>)</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
D.</li>
</ul>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="section-3-overview.html#cb383-1" aria-hidden="true"></a>schools <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb383-2"><a href="section-3-overview.html#cb383-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^Univ</span><span class="ch">\\</span><span class="st">.?</span><span class="ch">\\</span><span class="st">s|^U</span><span class="ch">\\</span><span class="st">.?</span><span class="ch">\\</span><span class="st">s&quot;</span>, <span class="st">&quot;University&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb383-3"><a href="section-3-overview.html#cb383-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;University &quot;</span>, <span class="st">&quot;University of &quot;</span>)</span></code></pre></div>
<ol start="10" style="list-style-type: decimal">
<li>Rather than using the <code>pattern_with_groups</code> vector, you accidentally write in the following code</li>
</ol>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="section-3-overview.html#cb384-1" aria-hidden="true"></a>problems &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5.3&quot;</span>, <span class="st">&quot;5,5&quot;</span>, <span class="st">&quot;6 1&quot;</span>, <span class="st">&quot;5 .11&quot;</span>, <span class="st">&quot;5, 12&quot;</span>)</span>
<span id="cb384-2"><a href="section-3-overview.html#cb384-2" aria-hidden="true"></a>pattern_with_groups &lt;-<span class="st"> &quot;^([4-7])[,</span><span class="ch">\\</span><span class="st">.](</span><span class="ch">\\</span><span class="st">d*)$&quot;</span></span>
<span id="cb384-3"><a href="section-3-overview.html#cb384-3" aria-hidden="true"></a><span class="kw">str_replace</span>(problems, pattern_with_groups, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;5&#39;3&quot;   &quot;5&#39;5&quot;   &quot;6 1&quot;   &quot;5 .11&quot; &quot;5, 12&quot;</code></pre>
<p>What is your result?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. <code>[1] "5'3" "5'5" "6 1" "5 .11" "5, 12"</code></li>
<li><input type="checkbox" disabled="" />
B. <code>[1] “5.3” “5,5” “6 1” “5 .11” “5, 12”</code></li>
<li><input type="checkbox" disabled="" />
C. <code>[1] “5’3” “5’5” “6’1” “5 .11” “5, 12”</code></li>
<li><input type="checkbox" disabled="" />
D. <code>[1] “5’3” “5’5” “6’1” “5’11” “5’12”</code></li>
</ul>
<ol start="11" style="list-style-type: decimal">
<li>You notice your mistake and correct your pattern regex to the following</li>
</ol>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="section-3-overview.html#cb386-1" aria-hidden="true"></a>problems &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5.3&quot;</span>, <span class="st">&quot;5,5&quot;</span>, <span class="st">&quot;6 1&quot;</span>, <span class="st">&quot;5 .11&quot;</span>, <span class="st">&quot;5, 12&quot;</span>)</span>
<span id="cb386-2"><a href="section-3-overview.html#cb386-2" aria-hidden="true"></a>pattern_with_groups &lt;-<span class="st"> &quot;^([4-7])[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s](</span><span class="ch">\\</span><span class="st">d*)$&quot;</span></span>
<span id="cb386-3"><a href="section-3-overview.html#cb386-3" aria-hidden="true"></a><span class="kw">str_replace</span>(problems, pattern_with_groups, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;5&#39;3&quot;   &quot;5&#39;5&quot;   &quot;6&#39;1&quot;   &quot;5 .11&quot; &quot;5, 12&quot;</code></pre>
<p>What is your result?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. <code>[1] “5’3” “5’5” “6 1” “5 .11” “5, 12”</code></li>
<li><input type="checkbox" disabled="" />
B. <code>[1] “5.3” “5,5” “6 1” “5 .11” “5, 12”</code></li>
<li><input type="checkbox" disabled="" checked="" />
C. <code>[1] "5'3" "5'5" "6'1" "5 .11" "5, 12"</code></li>
<li><input type="checkbox" disabled="" />
D. <code>[1] “5’3” “5’5” “6’1” “5’11” “5’12”</code></li>
</ul>
<ol start="12" style="list-style-type: decimal">
<li>In our example, we use the following code to detect height entries that do not match our pattern of x’y”.</li>
</ol>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="section-3-overview.html#cb388-1" aria-hidden="true"></a>converted &lt;-<span class="st"> </span>problems <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb388-2"><a href="section-3-overview.html#cb388-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;feet|foot|ft&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb388-3"><a href="section-3-overview.html#cb388-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb388-4"><a href="section-3-overview.html#cb388-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>)</span>
<span id="cb388-5"><a href="section-3-overview.html#cb388-5" aria-hidden="true"></a></span>
<span id="cb388-6"><a href="section-3-overview.html#cb388-6" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^[4-7]</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">d{1,2}$&quot;</span></span>
<span id="cb388-7"><a href="section-3-overview.html#cb388-7" aria-hidden="true"></a>index &lt;-<span class="st"> </span><span class="kw">str_detect</span>(converted, pattern)</span>
<span id="cb388-8"><a href="section-3-overview.html#cb388-8" aria-hidden="true"></a>converted[<span class="op">!</span>index]</span></code></pre></div>
<pre><code>## character(0)</code></pre>
<p>Which answer best describes the differences between the regex string we use as an argument in <code>str_replace("^([4-7])\\s*[,\\.\\s+]\\s*(\\d*)$", "\\1'\\2")</code> and the regex string in <code>pattern &lt;- "^[4-7]\\s*'\\s*\\d{1,2}$"</code>?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. The regex used in <code>str_replace()</code> looks for either a comma, period or space between the feet and inches digits, while the pattern regex just looks for an apostrophe; the regex in str_replace allows for one or more digits to be entered as inches, while the pattern regex only allows for one or two digits.</li>
<li><input type="checkbox" disabled="" />
B. The regex used in <code>str_replace()</code> allows for additional spaces between the feet and inches digits, but the pattern regex does not.</li>
<li><input type="checkbox" disabled="" />
C. The regex used in <code>str_replace()</code> looks for either a comma, period or space between the feet and inches digits, while the pattern regex just looks for an apostrophe; the regex in str_replace allows none or more digits to be entered as inches, while the pattern regex only allows for the number 1 or 2 to be used.</li>
<li><input type="checkbox" disabled="" checked="" />
D. The regex used in <code>str_replace()</code> looks for either a comma, period or space between the feet and inches digits, while the pattern regex just looks for an apostrophe; the regex in str_replace allows for none or more digits to be entered as inches, while the pattern regex only allows for one or two digits.</li>
</ul>
<ol start="13" style="list-style-type: decimal">
<li>You notice a few entries that are not being properly converted using your <code>str_replace</code> and <code>str_detect</code> code</li>
</ol>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="section-3-overview.html#cb390-1" aria-hidden="true"></a>yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5 feet 7inches&quot;</span>, <span class="st">&quot;5 7&quot;</span>)</span>
<span id="cb390-2"><a href="section-3-overview.html#cb390-2" aria-hidden="true"></a>no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5ft 9 inches&quot;</span>, <span class="st">&quot;5 ft 9 inches&quot;</span>)</span>
<span id="cb390-3"><a href="section-3-overview.html#cb390-3" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)</span>
<span id="cb390-4"><a href="section-3-overview.html#cb390-4" aria-hidden="true"></a></span>
<span id="cb390-5"><a href="section-3-overview.html#cb390-5" aria-hidden="true"></a>converted &lt;-<span class="st"> </span>s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb390-6"><a href="section-3-overview.html#cb390-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;feet|foot|ft&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb390-7"><a href="section-3-overview.html#cb390-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb390-8"><a href="section-3-overview.html#cb390-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>)</span>
<span id="cb390-9"><a href="section-3-overview.html#cb390-9" aria-hidden="true"></a></span>
<span id="cb390-10"><a href="section-3-overview.html#cb390-10" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^[4-7]</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">d{1,2}$&quot;</span></span>
<span id="cb390-11"><a href="section-3-overview.html#cb390-11" aria-hidden="true"></a><span class="kw">str_detect</span>(converted, pattern)</span>
<span id="cb390-12"><a href="section-3-overview.html#cb390-12" aria-hidden="true"></a>[<span class="dv">1</span>]  <span class="ot">TRUE</span> <span class="ot">TRUE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span></code></pre></div>
<p>It seems like the problem may be due to spaces around the words feet|foot|ft and inches|in. What is another way you could fix this problem?</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="section-3-overview.html#cb391-1" aria-hidden="true"></a>yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5 feet 7inches&quot;</span>, <span class="st">&quot;5 7&quot;</span>)</span>
<span id="cb391-2"><a href="section-3-overview.html#cb391-2" aria-hidden="true"></a>no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5ft 9 inches&quot;</span>, <span class="st">&quot;5 ft 9 inches&quot;</span>)</span>
<span id="cb391-3"><a href="section-3-overview.html#cb391-3" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)</span>
<span id="cb391-4"><a href="section-3-overview.html#cb391-4" aria-hidden="true"></a></span>
<span id="cb391-5"><a href="section-3-overview.html#cb391-5" aria-hidden="true"></a>converted &lt;-<span class="st"> </span>s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb391-6"><a href="section-3-overview.html#cb391-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s*(feet|foot|ft)</span><span class="ch">\\</span><span class="st">s*&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb391-7"><a href="section-3-overview.html#cb391-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s*(inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">)</span><span class="ch">\\</span><span class="st">s*&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb391-8"><a href="section-3-overview.html#cb391-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>)</span>
<span id="cb391-9"><a href="section-3-overview.html#cb391-9" aria-hidden="true"></a></span>
<span id="cb391-10"><a href="section-3-overview.html#cb391-10" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^[4-7]</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">d{1,2}$&quot;</span></span>
<span id="cb391-11"><a href="section-3-overview.html#cb391-11" aria-hidden="true"></a><span class="kw">str_detect</span>(converted, pattern)</span></code></pre></div>
<pre><code>## [1] TRUE TRUE TRUE TRUE</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A.</li>
</ul>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="section-3-overview.html#cb393-1" aria-hidden="true"></a>converted &lt;-<span class="st"> </span>s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb393-2"><a href="section-3-overview.html#cb393-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s*(feet|foot|ft)</span><span class="ch">\\</span><span class="st">s*&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb393-3"><a href="section-3-overview.html#cb393-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s*(inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">)</span><span class="ch">\\</span><span class="st">s*&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb393-4"><a href="section-3-overview.html#cb393-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>)</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
B.</li>
</ul>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="section-3-overview.html#cb394-1" aria-hidden="true"></a>converted &lt;-<span class="st"> </span>s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb394-2"><a href="section-3-overview.html#cb394-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s+feet|foot|ft</span><span class="ch">\\</span><span class="st">s+”, &quot;&#39;&quot;) %&gt;% </span></span>
<span id="cb394-3"><a href="section-3-overview.html#cb394-3" aria-hidden="true"></a><span class="st">  str_replace(&quot;</span><span class="ch">\\</span><span class="st">s+inches|in|&#39;&#39;|</span><span class="ch">\&quot;\\</span><span class="st">s+&quot;, &quot;&quot;) %&gt;% </span></span>
<span id="cb394-4"><a href="section-3-overview.html#cb394-4" aria-hidden="true"></a><span class="st">  str_replace(&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;, &quot;</span><span class="ch">\\</span><span class="st">1&#39;</span>\\<span class="dv">2</span><span class="st">&quot;)</span></span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
C.</li>
</ul>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="section-3-overview.html#cb395-1" aria-hidden="true"></a>converted &lt;-<span class="st"> </span>s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb395-2"><a href="section-3-overview.html#cb395-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s*|feet|foot|ft&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb395-3"><a href="section-3-overview.html#cb395-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s*|inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb395-4"><a href="section-3-overview.html#cb395-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>) </span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
D.</li>
</ul>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="section-3-overview.html#cb396-1" aria-hidden="true"></a>converted &lt;-<span class="st"> </span>s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb396-2"><a href="section-3-overview.html#cb396-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace_all</span>(“\\s”, “”) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb396-3"><a href="section-3-overview.html#cb396-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s|feet|foot|ft&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb396-4"><a href="section-3-overview.html#cb396-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s|inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb396-5"><a href="section-3-overview.html#cb396-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>)</span></code></pre></div>
</div>
<div id="separate-with-regex" class="section level2" number="4.13">
<h2><span class="header-section-number">4.13</span> Separate with Regex</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html#the-extract-function" target="_blank">here</a>.</p>
<p><strong>Key Point</strong></p>
<ul>
<li>The <code>extract()</code> function behaves similarly to the separate() function but allows extraction of groups from regular expressions.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="section-3-overview.html#cb397-1" aria-hidden="true"></a><span class="co"># first example - normally formatted heights</span></span>
<span id="cb397-2"><a href="section-3-overview.html#cb397-2" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&#39;10&quot;</span>, <span class="st">&quot;6&#39;1&quot;</span>)</span>
<span id="cb397-3"><a href="section-3-overview.html#cb397-3" aria-hidden="true"></a>tab &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> s)</span>
<span id="cb397-4"><a href="section-3-overview.html#cb397-4" aria-hidden="true"></a></span>
<span id="cb397-5"><a href="section-3-overview.html#cb397-5" aria-hidden="true"></a><span class="co"># the separate and extract functions behave similarly</span></span>
<span id="cb397-6"><a href="section-3-overview.html#cb397-6" aria-hidden="true"></a>tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;&#39;&quot;</span>)</span></code></pre></div>
<pre><code>##   feet inches
## 1    5     10
## 2    6      1</code></pre>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="section-3-overview.html#cb399-1" aria-hidden="true"></a>tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">extract</span>(x, <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="dt">regex =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">d)&#39;(</span><span class="ch">\\</span><span class="st">d{1,2})&quot;</span>)</span></code></pre></div>
<pre><code>##   feet inches
## 1    5     10
## 2    6      1</code></pre>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="section-3-overview.html#cb401-1" aria-hidden="true"></a><span class="co"># second example - some heights with unusual formats</span></span>
<span id="cb401-2"><a href="section-3-overview.html#cb401-2" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&#39;10&quot;</span>, <span class="st">&quot;6&#39;1</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,<span class="st">&quot;5&#39;8inches&quot;</span>)</span>
<span id="cb401-3"><a href="section-3-overview.html#cb401-3" aria-hidden="true"></a>tab &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> s)</span>
<span id="cb401-4"><a href="section-3-overview.html#cb401-4" aria-hidden="true"></a></span>
<span id="cb401-5"><a href="section-3-overview.html#cb401-5" aria-hidden="true"></a><span class="co"># separate fails because it leaves in extra characters, but extract keeps only the digits because of regex groups</span></span>
<span id="cb401-6"><a href="section-3-overview.html#cb401-6" aria-hidden="true"></a>tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>,<span class="st">&quot;inches&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;&#39;&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<pre><code>##   feet  inches
## 1    5      10
## 2    6      1&quot;
## 3    5 8inches</code></pre>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="section-3-overview.html#cb403-1" aria-hidden="true"></a>tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">extract</span>(x, <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="dt">regex =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">d)&#39;(</span><span class="ch">\\</span><span class="st">d{1,2})&quot;</span>)</span></code></pre></div>
<pre><code>##   feet inches
## 1    5     10
## 2    6      1
## 3    5      8</code></pre>
</div>
<div id="using-groups-and-quantifiers" class="section level2" number="4.14">
<h2><span class="header-section-number">4.14</span> Using Groups and Quantifiers</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html#testing-and-improving" target="_blank">here; through 24.10</a>.</p>
<p>Four clear patterns of entries have arisen along with some other minor problems:</p>
<ol style="list-style-type: decimal">
<li>Many students measuring exactly 5 or 6 feet did not enter any inches. For example, <strong>6’</strong> - our pattern requires that inches be included.</li>
<li>Some students measuring exactly 5 or 6 feet entered just that number.</li>
<li>Some of the inches were entered with decimal points. For example <strong>5’7.5’’</strong>. Our pattern only looks for two digits.</li>
<li>Some entires have spaces at the end, for example <strong>5 ’ 9</strong>.</li>
<li>Some entries are in meters and some of these use European decimals: <strong>1.6, 1,7</strong>.</li>
<li>Two students added <strong>cm</strong>.</li>
<li>One student spelled out the numbers: <strong>Five foot eight inches</strong>.
It is not necessarily clear that it is worth writing code to handle all these cases since they might be rare enough. However, some give us an opportunity to learn some more regex techniques so we will build a fix.</li>
</ol>
<p><strong>Case 1</strong></p>
<p>For case 1, if we add a ’0 to, for example, convert all 6 to 6’0, then our pattern will match. This can be done using groups using the following code:</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="section-3-overview.html#cb405-1" aria-hidden="true"></a>yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;5&quot;</span>)</span>
<span id="cb405-2"><a href="section-3-overview.html#cb405-2" aria-hidden="true"></a>no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&#39;&quot;</span>, <span class="st">&quot;5&#39;&#39;&quot;</span>, <span class="st">&quot;5&#39;4&quot;</span>)</span>
<span id="cb405-3"><a href="section-3-overview.html#cb405-3" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)</span>
<span id="cb405-4"><a href="section-3-overview.html#cb405-4" aria-hidden="true"></a><span class="kw">str_replace</span>(s, <span class="st">&quot;^([4-7])$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;0&quot;</span>)</span></code></pre></div>
<p>The pattern says it has to start (<strong>^</strong>), be followed with a digit between 4 and 7, and then end there (<strong>$</strong>). The parenthesis defines the group that we pass as <strong>\1</strong> to the replace regex.</p>
<p><strong>Cases 2 and 4</strong></p>
<p>We can adapt this code slightly to handle case 2 as well which covers the entry <strong>5’</strong>. Note that the <strong>5’</strong> is left untouched by the code above. This is because the extra <strong>’</strong> makes the pattern not match since we have to end with a 5 or 6. To handle case 2, we want to permit the 5 or 6 to be followed by no or one symbol for feet. So we can simply add <strong>’{0,1}</strong> after the <strong>’</strong> to do this. We can also use the none or once special character <strong>?</strong>. As we saw previously, this is different from * which is none or more. We now see that this code also handles the fourth case as well:</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="section-3-overview.html#cb406-1" aria-hidden="true"></a><span class="kw">str_replace</span>(s, <span class="st">&quot;^([56])&#39;?$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;0&quot;</span>)</span></code></pre></div>
<p>Note that here we only permit 5 and 6 but not 4 and 7. This is because heights of exactly 5 and exactly 6 feet tall are quite common, so we assume those that typed 5 or 6 really meant either 60 or 72 inches. However, heights of exactly 4 or exactly 7 feet tall are so rare that, although we accept 84 as a valid entry, we assume that a 7 was entered in error.</p>
<p><strong>Case 3</strong></p>
<p>We can use quantifiers to deal with case 3. These entries are not matched because the inches include decimals and our pattern does not permit this. We need allow the second group to include decimals and not just digits. This means we must permit zero or one period <strong>.</strong> followed by zero or more digits. So we will use both <strong>?</strong> and *. Also remember that for this particular case, the period needs to be escaped since it is a special character (it means any character except a line break).</p>
<p>So we can adapt our pattern, currently <code>^[4-7]\\s*'\\s*\\d{1,2}$</code>, to permit a decimal at the end:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="section-3-overview.html#cb407-1" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^[4-7]</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.?</span><span class="ch">\\</span><span class="st">d*)$&quot;</span></span></code></pre></div>
<p><strong>Case 5</strong></p>
<p>Case 5, meters using commas, we can approach similarly to how we converted the x.y to x’y. A difference is that we require that the first digit is 1 or 2:</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="section-3-overview.html#cb408-1" aria-hidden="true"></a>yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1,7&quot;</span>, <span class="st">&quot;1, 8&quot;</span>, <span class="st">&quot;2, &quot;</span> )</span>
<span id="cb408-2"><a href="section-3-overview.html#cb408-2" aria-hidden="true"></a>no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5,8&quot;</span>, <span class="st">&quot;5,3,2&quot;</span>, <span class="st">&quot;1.7&quot;</span>)</span>
<span id="cb408-3"><a href="section-3-overview.html#cb408-3" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)</span>
<span id="cb408-4"><a href="section-3-overview.html#cb408-4" aria-hidden="true"></a><span class="kw">str_replace</span>(s, <span class="st">&quot;^([12])</span><span class="ch">\\</span><span class="st">s*,</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">2&quot;</span>)</span></code></pre></div>
<p>We will later check if the entries are meters using their numeric values.</p>
<p><strong>Trimming</strong></p>
<p>In general, spaces at the start or end of the string are uninformative. These can be particularly deceptive because sometimes they can be hard to see:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="section-3-overview.html#cb409-1" aria-hidden="true"></a>s &lt;-<span class="st"> &quot;Hi &quot;</span></span>
<span id="cb409-2"><a href="section-3-overview.html#cb409-2" aria-hidden="true"></a><span class="kw">cat</span>(s)</span>
<span id="cb409-3"><a href="section-3-overview.html#cb409-3" aria-hidden="true"></a><span class="kw">identical</span>(s, <span class="st">&quot;Hi&quot;</span>)</span></code></pre></div>
<p>This is a general enough problem that there is a function dedicated to removing them: <code>str_trim</code>.</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="section-3-overview.html#cb410-1" aria-hidden="true"></a><span class="kw">str_trim</span>(<span class="st">&quot;5 &#39; 9 &quot;</span>)</span></code></pre></div>
<p><strong>To upper and to lower case</strong></p>
<p>One of the entries writes out numbers as words: <strong>Five foot eight inches</strong>. Although not efficient, we could add 12 extra <strong>str_replace</strong> to convert <strong>zero</strong> to <strong>0</strong>, <strong>one</strong> to <strong>1</strong>, and so on. To avoid having to write two separate operations for <strong>Zero</strong> and <strong>zero</strong>, <strong>One</strong> and <strong>one</strong>, etc., we can use the <code>str_to_lower()</code> function to make all words lower case first:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="section-3-overview.html#cb411-1" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Five feet eight inches&quot;</span>)</span>
<span id="cb411-2"><a href="section-3-overview.html#cb411-2" aria-hidden="true"></a><span class="kw">str_to_lower</span>(s)</span></code></pre></div>
<p><strong>Putting it into a function</strong></p>
<p>We are now ready to define a procedure that handles converting all the problematic cases.</p>
<p>We can now put all this together into a function that takes a string vector and tries to convert as many strings as possible to a single format. Below is a function that puts together the previous code replacements:</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="section-3-overview.html#cb412-1" aria-hidden="true"></a>convert_format &lt;-<span class="st"> </span><span class="cf">function</span>(s){</span>
<span id="cb412-2"><a href="section-3-overview.html#cb412-2" aria-hidden="true"></a>  s <span class="op">%&gt;%</span></span>
<span id="cb412-3"><a href="section-3-overview.html#cb412-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace</span>(<span class="st">&quot;feet|foot|ft&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#convert feet symbols to &#39;</span></span>
<span id="cb412-4"><a href="section-3-overview.html#cb412-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">|cm|and&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">#remove inches and other symbols</span></span>
<span id="cb412-5"><a href="section-3-overview.html#cb412-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace</span>(<span class="st">&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#change x.y, x,y x y</span></span>
<span id="cb412-6"><a href="section-3-overview.html#cb412-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace</span>(<span class="st">&quot;^([56])&#39;?$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;0&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#add 0 when to 5 or 6</span></span>
<span id="cb412-7"><a href="section-3-overview.html#cb412-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace</span>(<span class="st">&quot;^([12])</span><span class="ch">\\</span><span class="st">s*,</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#change european decimal</span></span>
<span id="cb412-8"><a href="section-3-overview.html#cb412-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_trim</span>() <span class="co">#remove extra space</span></span>
<span id="cb412-9"><a href="section-3-overview.html#cb412-9" aria-hidden="true"></a>}</span></code></pre></div>
<p>We can also write a function that converts words to numbers:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="section-3-overview.html#cb413-1" aria-hidden="true"></a>words_to_numbers &lt;-<span class="st"> </span><span class="cf">function</span>(s){</span>
<span id="cb413-2"><a href="section-3-overview.html#cb413-2" aria-hidden="true"></a>  <span class="kw">str_to_lower</span>(s) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb413-3"><a href="section-3-overview.html#cb413-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;zero&quot;</span>, <span class="st">&quot;0&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb413-4"><a href="section-3-overview.html#cb413-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb413-5"><a href="section-3-overview.html#cb413-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;two&quot;</span>, <span class="st">&quot;2&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb413-6"><a href="section-3-overview.html#cb413-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;three&quot;</span>, <span class="st">&quot;3&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb413-7"><a href="section-3-overview.html#cb413-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;four&quot;</span>, <span class="st">&quot;4&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb413-8"><a href="section-3-overview.html#cb413-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;five&quot;</span>, <span class="st">&quot;5&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb413-9"><a href="section-3-overview.html#cb413-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;six&quot;</span>, <span class="st">&quot;6&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb413-10"><a href="section-3-overview.html#cb413-10" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;seven&quot;</span>, <span class="st">&quot;7&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb413-11"><a href="section-3-overview.html#cb413-11" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;eight&quot;</span>, <span class="st">&quot;8&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb413-12"><a href="section-3-overview.html#cb413-12" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;nine&quot;</span>, <span class="st">&quot;9&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb413-13"><a href="section-3-overview.html#cb413-13" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;ten&quot;</span>, <span class="st">&quot;10&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb413-14"><a href="section-3-overview.html#cb413-14" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;eleven&quot;</span>, <span class="st">&quot;11&quot;</span>)</span>
<span id="cb413-15"><a href="section-3-overview.html#cb413-15" aria-hidden="true"></a>}</span></code></pre></div>
<p>Now we can see which problematic entries remain:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="section-3-overview.html#cb414-1" aria-hidden="true"></a>converted &lt;-<span class="st"> </span>problems <span class="op">%&gt;%</span><span class="st"> </span>words_to_numbers <span class="op">%&gt;%</span><span class="st"> </span>convert_format</span>
<span id="cb414-2"><a href="section-3-overview.html#cb414-2" aria-hidden="true"></a>remaining_problems &lt;-<span class="st"> </span>converted[<span class="kw">not_inches_or_cm</span>(converted)]</span>
<span id="cb414-3"><a href="section-3-overview.html#cb414-3" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^[4-7]</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.?</span><span class="ch">\\</span><span class="st">d*$&quot;</span></span>
<span id="cb414-4"><a href="section-3-overview.html#cb414-4" aria-hidden="true"></a>index &lt;-<span class="st"> </span><span class="kw">str_detect</span>(remaining_problems, pattern)</span>
<span id="cb414-5"><a href="section-3-overview.html#cb414-5" aria-hidden="true"></a>remaining_problems[<span class="op">!</span>index]</span></code></pre></div>
</div>
<div id="putting-it-all-together" class="section level2" number="4.15">
<h2><span class="header-section-number">4.15</span> Putting it All Together</h2>
<p>We are now ready to put everything we’ve done so far together and wrangle our reported heights data as we try to recover as many heights as possible. The code is complex but we will break it down into parts.</p>
<p>We start by cleaning up the <code>height</code> column so that the heights are closer to a feet’inches format. We added an original heights column so we can compare before and after.</p>
<p>Let’s start by writing a function that cleans up strings so that all the feet and inches formats use the same x’y format when appropriate.</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="section-3-overview.html#cb415-1" aria-hidden="true"></a>pattern &lt;-<span class="st"> &quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.?</span><span class="ch">\\</span><span class="st">d*)$&quot;</span></span>
<span id="cb415-2"><a href="section-3-overview.html#cb415-2" aria-hidden="true"></a></span>
<span id="cb415-3"><a href="section-3-overview.html#cb415-3" aria-hidden="true"></a>convert_format &lt;-<span class="st"> </span><span class="cf">function</span>(s){</span>
<span id="cb415-4"><a href="section-3-overview.html#cb415-4" aria-hidden="true"></a>  s <span class="op">%&gt;%</span></span>
<span id="cb415-5"><a href="section-3-overview.html#cb415-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace</span>(<span class="st">&quot;feet|foot|ft&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#convert feet symbols to &#39;</span></span>
<span id="cb415-6"><a href="section-3-overview.html#cb415-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">|cm|and&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">#remove inches and other symbols</span></span>
<span id="cb415-7"><a href="section-3-overview.html#cb415-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace</span>(<span class="st">&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#change x.y, x,y x y</span></span>
<span id="cb415-8"><a href="section-3-overview.html#cb415-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace</span>(<span class="st">&quot;^([56])&#39;?$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;0&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#add 0 when to 5 or 6</span></span>
<span id="cb415-9"><a href="section-3-overview.html#cb415-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace</span>(<span class="st">&quot;^([12])</span><span class="ch">\\</span><span class="st">s*,</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#change european decimal</span></span>
<span id="cb415-10"><a href="section-3-overview.html#cb415-10" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_trim</span>() <span class="co">#remove extra space</span></span>
<span id="cb415-11"><a href="section-3-overview.html#cb415-11" aria-hidden="true"></a>}</span>
<span id="cb415-12"><a href="section-3-overview.html#cb415-12" aria-hidden="true"></a>    </span>
<span id="cb415-13"><a href="section-3-overview.html#cb415-13" aria-hidden="true"></a>words_to_numbers &lt;-<span class="st"> </span><span class="cf">function</span>(s){</span>
<span id="cb415-14"><a href="section-3-overview.html#cb415-14" aria-hidden="true"></a>  <span class="kw">str_to_lower</span>(s) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb415-15"><a href="section-3-overview.html#cb415-15" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;zero&quot;</span>, <span class="st">&quot;0&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb415-16"><a href="section-3-overview.html#cb415-16" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb415-17"><a href="section-3-overview.html#cb415-17" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;two&quot;</span>, <span class="st">&quot;2&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb415-18"><a href="section-3-overview.html#cb415-18" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;three&quot;</span>, <span class="st">&quot;3&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb415-19"><a href="section-3-overview.html#cb415-19" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;four&quot;</span>, <span class="st">&quot;4&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb415-20"><a href="section-3-overview.html#cb415-20" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;five&quot;</span>, <span class="st">&quot;5&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb415-21"><a href="section-3-overview.html#cb415-21" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;six&quot;</span>, <span class="st">&quot;6&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb415-22"><a href="section-3-overview.html#cb415-22" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;seven&quot;</span>, <span class="st">&quot;7&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb415-23"><a href="section-3-overview.html#cb415-23" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;eight&quot;</span>, <span class="st">&quot;8&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb415-24"><a href="section-3-overview.html#cb415-24" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;nine&quot;</span>, <span class="st">&quot;9&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb415-25"><a href="section-3-overview.html#cb415-25" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;ten&quot;</span>, <span class="st">&quot;10&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb415-26"><a href="section-3-overview.html#cb415-26" aria-hidden="true"></a><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;eleven&quot;</span>, <span class="st">&quot;11&quot;</span>)</span>
<span id="cb415-27"><a href="section-3-overview.html#cb415-27" aria-hidden="true"></a>}</span>
<span id="cb415-28"><a href="section-3-overview.html#cb415-28" aria-hidden="true"></a></span>
<span id="cb415-29"><a href="section-3-overview.html#cb415-29" aria-hidden="true"></a>smallest &lt;-<span class="st"> </span><span class="dv">50</span></span>
<span id="cb415-30"><a href="section-3-overview.html#cb415-30" aria-hidden="true"></a>tallest &lt;-<span class="st"> </span><span class="dv">84</span></span>
<span id="cb415-31"><a href="section-3-overview.html#cb415-31" aria-hidden="true"></a>new_heights &lt;-<span class="st"> </span>reported_heights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb415-32"><a href="section-3-overview.html#cb415-32" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">original =</span> height, </span>
<span id="cb415-33"><a href="section-3-overview.html#cb415-33" aria-hidden="true"></a>         <span class="dt">height =</span> <span class="kw">words_to_numbers</span>(height) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">convert_format</span>()) <span class="op">%&gt;%</span></span>
<span id="cb415-34"><a href="section-3-overview.html#cb415-34" aria-hidden="true"></a><span class="st">  </span><span class="kw">extract</span>(height, <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="dt">regex =</span> pattern, <span class="dt">remove =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb415-35"><a href="section-3-overview.html#cb415-35" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), as.numeric) <span class="op">%&gt;%</span></span>
<span id="cb415-36"><a href="section-3-overview.html#cb415-36" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">guess =</span> <span class="dv">12</span><span class="op">*</span>feet <span class="op">+</span><span class="st"> </span>inches) <span class="op">%&gt;%</span></span>
<span id="cb415-37"><a href="section-3-overview.html#cb415-37" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height =</span> <span class="kw">case_when</span>(</span>
<span id="cb415-38"><a href="section-3-overview.html#cb415-38" aria-hidden="true"></a>    <span class="op">!</span><span class="kw">is.na</span>(height) <span class="op">&amp;</span><span class="st"> </span><span class="kw">between</span>(height, smallest, tallest) <span class="op">~</span><span class="st"> </span>height, <span class="co">#inches </span></span>
<span id="cb415-39"><a href="section-3-overview.html#cb415-39" aria-hidden="true"></a>    <span class="op">!</span><span class="kw">is.na</span>(height) <span class="op">&amp;</span><span class="st"> </span><span class="kw">between</span>(height<span class="op">/</span><span class="fl">2.54</span>, smallest, tallest) <span class="op">~</span><span class="st"> </span>height<span class="op">/</span><span class="fl">2.54</span>, <span class="co">#centimeters</span></span>
<span id="cb415-40"><a href="section-3-overview.html#cb415-40" aria-hidden="true"></a>    <span class="op">!</span><span class="kw">is.na</span>(height) <span class="op">&amp;</span><span class="st"> </span><span class="kw">between</span>(height<span class="op">*</span><span class="dv">100</span><span class="op">/</span><span class="fl">2.54</span>, smallest, tallest) <span class="op">~</span><span class="st"> </span>height<span class="op">*</span><span class="dv">100</span><span class="op">/</span><span class="fl">2.54</span>, <span class="co">#meters</span></span>
<span id="cb415-41"><a href="section-3-overview.html#cb415-41" aria-hidden="true"></a>    <span class="op">!</span><span class="kw">is.na</span>(guess) <span class="op">&amp;</span><span class="st"> </span>inches <span class="op">&lt;</span><span class="st"> </span><span class="dv">12</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">between</span>(guess, smallest, tallest) <span class="op">~</span><span class="st"> </span>guess, <span class="co">#feet&#39;inches</span></span>
<span id="cb415-42"><a href="section-3-overview.html#cb415-42" aria-hidden="true"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.numeric</span>(<span class="ot">NA</span>))) <span class="op">%&gt;%</span></span>
<span id="cb415-43"><a href="section-3-overview.html#cb415-43" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>guess)</span></code></pre></div>
<pre><code>## Warning: Problem with `mutate()` input `height`.
## ℹ NAs introduced by coercion
## ℹ Input `height` is `.Primitive(&quot;as.double&quot;)(height)`.</code></pre>
<pre><code>## Warning in mask$eval_all_mutate(dots[[i]]): NAs introduced by coercion</code></pre>
<p>We can check all the entries we converted using the following code:</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="section-3-overview.html#cb418-1" aria-hidden="true"></a>new_heights <span class="op">%&gt;%</span></span>
<span id="cb418-2"><a href="section-3-overview.html#cb418-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">not_inches</span>(original)) <span class="op">%&gt;%</span></span>
<span id="cb418-3"><a href="section-3-overview.html#cb418-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(original, height) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb418-4"><a href="section-3-overview.html#cb418-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">arrange</span>(height) <span class="op">%&gt;%</span></span>
<span id="cb418-5"><a href="section-3-overview.html#cb418-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">View</span>() <span class="co"># Open XQuartz-app to run this command</span></span></code></pre></div>
<p>Let’s take a look at the shortest students in our dataset using the following code:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="section-3-overview.html#cb419-1" aria-hidden="true"></a>new_heights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(height) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n=</span><span class="dv">7</span>)</span></code></pre></div>
<pre><code>##            time_stamp    sex height feet inches original
## 1 2017-07-04 01:30:25   Male  50.00   NA     NA       50
## 2 2017-09-07 10:40:35   Male  50.00   NA     NA       50
## 3 2014-09-02 15:18:30 Female  51.00   NA     NA       51
## 4 2016-06-05 14:07:20 Female  52.00   NA     NA       52
## 5 2016-06-05 14:07:38 Female  52.00   NA     NA       52
## 6 2014-09-23 03:39:56 Female  53.00   NA     NA       53
## 7 2015-01-07 08:57:29   Male  53.77   NA     NA    53.77</code></pre>
<p>We see heights of 53, 54, and 55. In the original heights column, we also have 51 and 52. These short heights are very rare and it is likely that the students actually meant 5’1, 5’2, 5’3, 5’4, and 5’5. But because we are not completely sure, we will leave them as reported.</p>
</div>
<div id="string-splitting" class="section level2" number="4.16">
<h2><span class="header-section-number">4.16</span> String Splitting</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html#string-splitting" target="_blank">here</a>.</p>
<p><strong>Key Points</strong></p>
<ul>
<li>The function <code>str_split()</code> splits a string into a character vector on a delimiter (such as a comma, space or underscore). By default, <code>str_split()</code> generates a list with one element for each original string. Use the function argument <code>simplify=TRUE</code> to have <code>str_split()</code> return a matrix instead.</li>
<li>The <code>map()</code> function from the <strong>purrr</strong> package applies the same function to each element of a list. To extract the ith entry of each element x, use <code>map(x, i)</code>.</li>
<li><code>map()</code> always returns a list. Use <code>map_chr()</code> to return a character vector and <code>map_int()</code> to return an integer.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="section-3-overview.html#cb421-1" aria-hidden="true"></a><span class="co"># read raw murders data line by line</span></span>
<span id="cb421-2"><a href="section-3-overview.html#cb421-2" aria-hidden="true"></a>filename &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/murders.csv&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;dslabs&quot;</span>)</span>
<span id="cb421-3"><a href="section-3-overview.html#cb421-3" aria-hidden="true"></a>lines &lt;-<span class="st"> </span><span class="kw">readLines</span>(filename)</span>
<span id="cb421-4"><a href="section-3-overview.html#cb421-4" aria-hidden="true"></a>lines <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## [1] &quot;state,abb,region,population,total&quot; &quot;Alabama,AL,South,4779736,135&quot;      &quot;Alaska,AK,West,710231,19&quot;          &quot;Arizona,AZ,West,6392017,232&quot;      
## [5] &quot;Arkansas,AR,South,2915918,93&quot;      &quot;California,CA,West,37253956,1257&quot;</code></pre>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="section-3-overview.html#cb423-1" aria-hidden="true"></a><span class="co"># split at commas with str_split function, remove row of column names</span></span>
<span id="cb423-2"><a href="section-3-overview.html#cb423-2" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">str_split</span>(lines, <span class="st">&quot;,&quot;</span>) </span>
<span id="cb423-3"><a href="section-3-overview.html#cb423-3" aria-hidden="true"></a>x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;state&quot;      &quot;abb&quot;        &quot;region&quot;     &quot;population&quot; &quot;total&quot;     
## 
## [[2]]
## [1] &quot;Alabama&quot; &quot;AL&quot;      &quot;South&quot;   &quot;4779736&quot; &quot;135&quot;    
## 
## [[3]]
## [1] &quot;Alaska&quot; &quot;AK&quot;     &quot;West&quot;   &quot;710231&quot; &quot;19&quot;    
## 
## [[4]]
## [1] &quot;Arizona&quot; &quot;AZ&quot;      &quot;West&quot;    &quot;6392017&quot; &quot;232&quot;    
## 
## [[5]]
## [1] &quot;Arkansas&quot; &quot;AR&quot;       &quot;South&quot;    &quot;2915918&quot;  &quot;93&quot;      
## 
## [[6]]
## [1] &quot;California&quot; &quot;CA&quot;         &quot;West&quot;       &quot;37253956&quot;   &quot;1257&quot;</code></pre>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="section-3-overview.html#cb425-1" aria-hidden="true"></a>col_names &lt;-<span class="st"> </span>x[[<span class="dv">1</span>]]</span>
<span id="cb425-2"><a href="section-3-overview.html#cb425-2" aria-hidden="true"></a>x &lt;-<span class="st"> </span>x[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb425-3"><a href="section-3-overview.html#cb425-3" aria-hidden="true"></a></span>
<span id="cb425-4"><a href="section-3-overview.html#cb425-4" aria-hidden="true"></a><span class="co"># extract first element of each list entry</span></span>
<span id="cb425-5"><a href="section-3-overview.html#cb425-5" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(purrr)) <span class="kw">install.packages</span>(<span class="st">&quot;purrr&quot;</span>)</span>
<span id="cb425-6"><a href="section-3-overview.html#cb425-6" aria-hidden="true"></a></span>
<span id="cb425-7"><a href="section-3-overview.html#cb425-7" aria-hidden="true"></a><span class="kw">library</span>(purrr)</span>
<span id="cb425-8"><a href="section-3-overview.html#cb425-8" aria-hidden="true"></a><span class="kw">map</span>(x, <span class="cf">function</span>(y) y[<span class="dv">1</span>]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Alabama&quot;
## 
## [[2]]
## [1] &quot;Alaska&quot;
## 
## [[3]]
## [1] &quot;Arizona&quot;
## 
## [[4]]
## [1] &quot;Arkansas&quot;
## 
## [[5]]
## [1] &quot;California&quot;
## 
## [[6]]
## [1] &quot;Colorado&quot;</code></pre>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="section-3-overview.html#cb427-1" aria-hidden="true"></a><span class="kw">map</span>(x, <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Alabama&quot;
## 
## [[2]]
## [1] &quot;Alaska&quot;
## 
## [[3]]
## [1] &quot;Arizona&quot;
## 
## [[4]]
## [1] &quot;Arkansas&quot;
## 
## [[5]]
## [1] &quot;California&quot;
## 
## [[6]]
## [1] &quot;Colorado&quot;</code></pre>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="section-3-overview.html#cb429-1" aria-hidden="true"></a><span class="co"># extract columns 1-5 as characters, then convert to proper format - </span><span class="al">NOTE</span><span class="co">: DIFFERENT FROM VIDEO</span></span>
<span id="cb429-2"><a href="section-3-overview.html#cb429-2" aria-hidden="true"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">parse_guess</span>(<span class="kw">map_chr</span>(x, <span class="dv">1</span>)),</span>
<span id="cb429-3"><a href="section-3-overview.html#cb429-3" aria-hidden="true"></a>                  <span class="kw">parse_guess</span>(<span class="kw">map_chr</span>(x, <span class="dv">2</span>)),</span>
<span id="cb429-4"><a href="section-3-overview.html#cb429-4" aria-hidden="true"></a>                  <span class="kw">parse_guess</span>(<span class="kw">map_chr</span>(x, <span class="dv">3</span>)),</span>
<span id="cb429-5"><a href="section-3-overview.html#cb429-5" aria-hidden="true"></a>                  <span class="kw">parse_guess</span>(<span class="kw">map_chr</span>(x, <span class="dv">4</span>)),</span>
<span id="cb429-6"><a href="section-3-overview.html#cb429-6" aria-hidden="true"></a>                  <span class="kw">parse_guess</span>(<span class="kw">map_chr</span>(x, <span class="dv">5</span>))) <span class="op">%&gt;%</span></span>
<span id="cb429-7"><a href="section-3-overview.html#cb429-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">setNames</span>(col_names)</span>
<span id="cb429-8"><a href="section-3-overview.html#cb429-8" aria-hidden="true"></a>  </span>
<span id="cb429-9"><a href="section-3-overview.html#cb429-9" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span>head</span></code></pre></div>
<pre><code>##        state abb region population total
## 1    Alabama  AL  South    4779736   135
## 2     Alaska  AK   West     710231    19
## 3    Arizona  AZ   West    6392017   232
## 4   Arkansas  AR  South    2915918    93
## 5 California  CA   West   37253956  1257
## 6   Colorado  CO   West    5029196    65</code></pre>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="section-3-overview.html#cb431-1" aria-hidden="true"></a><span class="co"># more efficient code for the same thing</span></span>
<span id="cb431-2"><a href="section-3-overview.html#cb431-2" aria-hidden="true"></a>dat &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span></span>
<span id="cb431-3"><a href="section-3-overview.html#cb431-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">transpose</span>() <span class="op">%&gt;%</span></span>
<span id="cb431-4"><a href="section-3-overview.html#cb431-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">map</span>( <span class="op">~</span><span class="st"> </span><span class="kw">parse_guess</span>(<span class="kw">unlist</span>(.))) <span class="op">%&gt;%</span></span>
<span id="cb431-5"><a href="section-3-overview.html#cb431-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">setNames</span>(col_names) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb431-6"><a href="section-3-overview.html#cb431-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">as.data.frame</span>() </span>
<span id="cb431-7"><a href="section-3-overview.html#cb431-7" aria-hidden="true"></a></span>
<span id="cb431-8"><a href="section-3-overview.html#cb431-8" aria-hidden="true"></a><span class="co"># the simplify argument makes str_split return a matrix instead of a list</span></span>
<span id="cb431-9"><a href="section-3-overview.html#cb431-9" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">str_split</span>(lines, <span class="st">&quot;,&quot;</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>) </span>
<span id="cb431-10"><a href="section-3-overview.html#cb431-10" aria-hidden="true"></a>col_names &lt;-<span class="st"> </span>x[<span class="dv">1</span>,]</span>
<span id="cb431-11"><a href="section-3-overview.html#cb431-11" aria-hidden="true"></a>x &lt;-<span class="st"> </span>x[<span class="op">-</span><span class="dv">1</span>,]</span>
<span id="cb431-12"><a href="section-3-overview.html#cb431-12" aria-hidden="true"></a>x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_data_frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb431-13"><a href="section-3-overview.html#cb431-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">setNames</span>(col_names) <span class="op">%&gt;%</span></span>
<span id="cb431-14"><a href="section-3-overview.html#cb431-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate_all</span>(parse_guess)</span></code></pre></div>
<pre><code>## Warning: `as_data_frame()` is deprecated as of tibble 2.0.0.
## Please use `as_tibble()` instead.
## The signature and semantics have changed, see `?as_tibble`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## # A tibble: 51 x 5
##    state                abb   region    population total
##    &lt;chr&gt;                &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;
##  1 Alabama              AL    South        4779736   135
##  2 Alaska               AK    West          710231    19
##  3 Arizona              AZ    West         6392017   232
##  4 Arkansas             AR    South        2915918    93
##  5 California           CA    West        37253956  1257
##  6 Colorado             CO    West         5029196    65
##  7 Connecticut          CT    Northeast    3574097    97
##  8 Delaware             DE    South         897934    38
##  9 District of Columbia DC    South         601723    99
## 10 Florida              FL    South       19687653   669
## # … with 41 more rows</code></pre>
</div>
<div id="case-study---extracting-a-table-from-a-pdf" class="section level2" number="4.17">
<h2><span class="header-section-number">4.17</span> Case Study - Extracting a Table from a PDF</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html#case-study-3-extracting-tables-from-a-pdf" target="_blank">here</a>.</p>
<p>One of the datasets provided in <code>dslabs</code> shows scientific funding rates by gender in the Netherlands:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="section-3-overview.html#cb435-1" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;research_funding_rates&quot;</span>)</span>
<span id="cb435-2"><a href="section-3-overview.html#cb435-2" aria-hidden="true"></a>research_funding_rates</span></code></pre></div>
<pre><code>##            discipline applications_total applications_men applications_women awards_total awards_men awards_women success_rates_total success_rates_men success_rates_women
## 1   Chemical sciences                122               83                 39           32         22           10                26.2              26.5                25.6
## 2   Physical sciences                174              135                 39           35         26            9                20.1              19.3                23.1
## 3             Physics                 76               67                  9           20         18            2                26.3              26.9                22.2
## 4          Humanities                396              230                166           65         33           32                16.4              14.3                19.3
## 5  Technical sciences                251              189                 62           43         30           13                17.1              15.9                21.0
## 6   Interdisciplinary                183              105                 78           29         12           17                15.8              11.4                21.8
## 7 Earth/life sciences                282              156                126           56         38           18                19.9              24.4                14.3
## 8     Social sciences                834              425                409          112         65           47                13.4              15.3                11.5
## 9    Medical sciences                505              245                260           75         46           29                14.9              18.8                11.2</code></pre>
<p>The data come from a <a href="https://www.pnas.org/content/112/40/12349.abstract" target="_blank">paper</a> published in the prestigious journal PNAS. However, the data are not provided in a spreadsheet; they are in a table in a PDF document. We could extract the numbers by hand, but this could lead to human error. Instead we can try to wrangle the data using R.</p>
<p>**Downloading the data*</p>
<p>We start by downloading the PDF document then importing it into R using the following code:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="section-3-overview.html#cb437-1" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(pdftools)) <span class="kw">install.packages</span>(<span class="st">&quot;pdftools&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: pdftools</code></pre>
<pre><code>## Using poppler version 0.73.0</code></pre>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="section-3-overview.html#cb440-1" aria-hidden="true"></a><span class="kw">library</span>(<span class="st">&quot;pdftools&quot;</span>)</span>
<span id="cb440-2"><a href="section-3-overview.html#cb440-2" aria-hidden="true"></a>temp_file &lt;-<span class="st"> </span><span class="kw">tempfile</span>()</span>
<span id="cb440-3"><a href="section-3-overview.html#cb440-3" aria-hidden="true"></a>url &lt;-<span class="st"> &quot;http://www.pnas.org/content/suppl/2015/09/16/1510159112.DCSupplemental/pnas.201510159SI.pdf&quot;</span></span>
<span id="cb440-4"><a href="section-3-overview.html#cb440-4" aria-hidden="true"></a><span class="kw">download.file</span>(url, temp_file)</span>
<span id="cb440-5"><a href="section-3-overview.html#cb440-5" aria-hidden="true"></a>txt &lt;-<span class="st"> </span><span class="kw">pdf_text</span>(temp_file)</span>
<span id="cb440-6"><a href="section-3-overview.html#cb440-6" aria-hidden="true"></a><span class="kw">file.remove</span>(temp_file)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>If we examine the object <code>txt</code> we notice that it is a character vector with an entry for each page. So we keep the page we want using the following code:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="section-3-overview.html#cb442-1" aria-hidden="true"></a>raw_data_research_funding_rates &lt;-<span class="st"> </span>txt[<span class="dv">2</span>]</span></code></pre></div>
<p>The steps above can actually be skipped because we include the raw data in the <code>dslabs</code> package as well:</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="section-3-overview.html#cb443-1" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;raw_data_research_funding_rates&quot;</span>)</span></code></pre></div>
<p><strong>Looking at the download</strong></p>
<p>Examining this object,</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="section-3-overview.html#cb444-1" aria-hidden="true"></a>raw_data_research_funding_rates <span class="op">%&gt;%</span><span class="st"> </span>head</span></code></pre></div>
<pre><code>## [1] &quot;                        Table S1. Numbers of applications and awarded grants, along with success rates for male and\n                        female applicants, by scientific discipline\n                                                      Applications, n                    Awards, n                      Success rates, %\n                        Discipline              Total     Men      Women         Total    Men       Women          Total    Men      Women\n                       Total                    2,823    1,635      1,188         467      290         177          16.5    17.7a      14.9b\n                        Chemical sciences         122       83          39         32       22           10         26.2    26.5a      25.6a\n                        Physical sciences         174      135          39         35       26            9         20.1    19.3a      23.1a\n                        Physics                    76       67           9         20       18            2         26.3    26.9a      22.2a\n                        Humanities                396      230         166         65       33           32         16.4    14.3a      19.3a\n                        Technical sciences        251      189          62         43       30           13         17.1    15.9a      21.0a\n                        Interdisciplinary         183      105          78         29       12           17         15.8    11.4a      21.8a\n                        Earth/life sciences       282      156         126         56       38           18         19.9    24.4a      14.3b\n                        Social sciences           834      425         409        112       65           47         13.4    15.3a      11.5a\n                        Medical sciences          505      245         260         75       46           29         14.9    18.8a      11.2b\n                           Success rates for male and female applicants with different subscripts differ reliably from one another (P &lt; 0.05).\n                        Table S2. Numbers of applications and awarded grants, along with success rates for male and\n                        female applicants, by first-time applications vs. reapplications in one call, 2012\n                                                         Applications, n                  Awards, n                     Success rates, %\n                        Category                    Total    Men     Women         Total   Men       Women         Total     Men     Women\n                       Total                         921     527        394         147      93          54         16.0    17.6i      13.7i\n                        First-time applications      722     417        305         100      67          33         13.9i   16.1a      10.8b\n                        Reapplications               199     110         89          47      26          21         23.6j   23.6ac     23.6c\n                           Success rates for male and female applicants with different subscripts per row and column differ reliably from\n                        one another (P &lt; 0.05).\nvan der Lee and Ellemers www.pnas.org/cgi/content/short/1510159112                                                                             2 of 2\n&quot;</code></pre>
<p>we see that it is a long string. Each line on the page, including the table rows, is separated by the symbol for newline: <code>\n</code>.</p>
<p>We can therefore can create a list with the lines of the text as elements:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="section-3-overview.html#cb446-1" aria-hidden="true"></a>tab &lt;-<span class="st"> </span><span class="kw">str_split</span>(raw_data_research_funding_rates, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<p>Because we start off with just one element in the string, we end up with a list with just one entry:</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="section-3-overview.html#cb447-1" aria-hidden="true"></a>tab &lt;-<span class="st"> </span>tab[[<span class="dv">1</span>]]</span></code></pre></div>
<p>By examining this object,</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="section-3-overview.html#cb448-1" aria-hidden="true"></a>tab <span class="op">%&gt;%</span><span class="st"> </span>head</span></code></pre></div>
<pre><code>## [1] &quot;                        Table S1. Numbers of applications and awarded grants, along with success rates for male and&quot;                         
## [2] &quot;                        female applicants, by scientific discipline&quot;                                                                         
## [3] &quot;                                                      Applications, n                    Awards, n                      Success rates, %&quot;    
## [4] &quot;                        Discipline              Total     Men      Women         Total    Men       Women          Total    Men      Women&quot;  
## [5] &quot;                       Total                    2,823    1,635      1,188         467      290         177          16.5    17.7a      14.9b&quot;
## [6] &quot;                        Chemical sciences         122       83          39         32       22           10         26.2    26.5a      25.6a&quot;</code></pre>
<p>we see that the information for the column names is the third and fourth entires:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="section-3-overview.html#cb450-1" aria-hidden="true"></a>the_names_<span class="dv">1</span> &lt;-<span class="st"> </span>tab[<span class="dv">3</span>]</span>
<span id="cb450-2"><a href="section-3-overview.html#cb450-2" aria-hidden="true"></a>the_names_<span class="dv">2</span> &lt;-<span class="st"> </span>tab[<span class="dv">4</span>]</span></code></pre></div>
<p>In the table, the column information is spread across two lines. We want to create one vector with one name for each column. We can do this using some of the functions we have just learned.</p>
<p><strong>Extracting the table data</strong></p>
<p>Let’s start with the first line:</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="section-3-overview.html#cb451-1" aria-hidden="true"></a>the_names_<span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] &quot;                                                      Applications, n                    Awards, n                      Success rates, %&quot;</code></pre>
<p>We want to remove the leading space and everything following the comma. We can use regex for the latter. Then we can obtain the elements by splitting using the space. We want to split only when there are 2 or more spaces to avoid splitting <code>success rate</code>. So we use the regex <code>\\s{2,}</code> as follows:</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="section-3-overview.html#cb453-1" aria-hidden="true"></a>the_names_<span class="dv">1</span> &lt;-<span class="st"> </span>the_names_<span class="dv">1</span> <span class="op">%&gt;%</span></span>
<span id="cb453-2"><a href="section-3-overview.html#cb453-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_trim</span>() <span class="op">%&gt;%</span></span>
<span id="cb453-3"><a href="section-3-overview.html#cb453-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace_all</span>(<span class="st">&quot;,</span><span class="ch">\\</span><span class="st">s.&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb453-4"><a href="section-3-overview.html#cb453-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_split</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s{2,}&quot;</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)</span>
<span id="cb453-5"><a href="section-3-overview.html#cb453-5" aria-hidden="true"></a>the_names_<span class="dv">1</span></span></code></pre></div>
<pre><code>##      [,1]           [,2]     [,3]           
## [1,] &quot;Applications&quot; &quot;Awards&quot; &quot;Success rates&quot;</code></pre>
<p>Now let’s look at the second line:</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="section-3-overview.html#cb455-1" aria-hidden="true"></a>the_names_<span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] &quot;                        Discipline              Total     Men      Women         Total    Men       Women          Total    Men      Women&quot;</code></pre>
<p>Here we want to trim the leading space and then split by space as we did for the first line:</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="section-3-overview.html#cb457-1" aria-hidden="true"></a>the_names_<span class="dv">2</span> &lt;-<span class="st"> </span>the_names_<span class="dv">2</span> <span class="op">%&gt;%</span></span>
<span id="cb457-2"><a href="section-3-overview.html#cb457-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_trim</span>() <span class="op">%&gt;%</span></span>
<span id="cb457-3"><a href="section-3-overview.html#cb457-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_split</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s+&quot;</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)</span>
<span id="cb457-4"><a href="section-3-overview.html#cb457-4" aria-hidden="true"></a>the_names_<span class="dv">2</span></span></code></pre></div>
<pre><code>##      [,1]         [,2]    [,3]  [,4]    [,5]    [,6]  [,7]    [,8]    [,9]  [,10]  
## [1,] &quot;Discipline&quot; &quot;Total&quot; &quot;Men&quot; &quot;Women&quot; &quot;Total&quot; &quot;Men&quot; &quot;Women&quot; &quot;Total&quot; &quot;Men&quot; &quot;Women&quot;</code></pre>
<p>Now we can join these to generate one name for each column:</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="section-3-overview.html#cb459-1" aria-hidden="true"></a>tmp_names &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="kw">rep</span>(the_names_<span class="dv">1</span>, <span class="dt">each =</span> <span class="dv">3</span>), the_names_<span class="dv">2</span>[<span class="op">-</span><span class="dv">1</span>], <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb459-2"><a href="section-3-overview.html#cb459-2" aria-hidden="true"></a>the_names &lt;-<span class="st"> </span><span class="kw">c</span>(the_names_<span class="dv">2</span>[<span class="dv">1</span>], tmp_names) <span class="op">%&gt;%</span></span>
<span id="cb459-3"><a href="section-3-overview.html#cb459-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_to_lower</span>() <span class="op">%&gt;%</span></span>
<span id="cb459-4"><a href="section-3-overview.html#cb459-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_replace_all</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s&quot;</span>, <span class="st">&quot;_&quot;</span>)</span>
<span id="cb459-5"><a href="section-3-overview.html#cb459-5" aria-hidden="true"></a>the_names</span></code></pre></div>
<pre><code>##  [1] &quot;discipline&quot;          &quot;applications_total&quot;  &quot;applications_men&quot;    &quot;applications_women&quot;  &quot;awards_total&quot;        &quot;awards_men&quot;          &quot;awards_women&quot;        &quot;success_rates_total&quot;
##  [9] &quot;success_rates_men&quot;   &quot;success_rates_women&quot;</code></pre>
<p>Now we are ready to get the actual data. By examining the <code>tab</code> object, we notice that the information is in lines 6 through 14. We can use <code>str_split()</code> again to achieve our goal:</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="section-3-overview.html#cb461-1" aria-hidden="true"></a>new_research_funding_rates &lt;-<span class="st"> </span>tab[<span class="dv">6</span><span class="op">:</span><span class="dv">14</span>] <span class="op">%&gt;%</span></span>
<span id="cb461-2"><a href="section-3-overview.html#cb461-2" aria-hidden="true"></a><span class="st">  </span>str_trim <span class="op">%&gt;%</span></span>
<span id="cb461-3"><a href="section-3-overview.html#cb461-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_split</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s{2,}&quot;</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb461-4"><a href="section-3-overview.html#cb461-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">data.frame</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></span>
<span id="cb461-5"><a href="section-3-overview.html#cb461-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">setNames</span>(the_names) <span class="op">%&gt;%</span></span>
<span id="cb461-6"><a href="section-3-overview.html#cb461-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="op">-</span><span class="dv">1</span>, parse_number)</span>
<span id="cb461-7"><a href="section-3-overview.html#cb461-7" aria-hidden="true"></a>new_research_funding_rates <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>##           discipline applications_total applications_men applications_women awards_total awards_men awards_women success_rates_total success_rates_men success_rates_women
## 1  Chemical sciences                122               83                 39           32         22           10                26.2              26.5                25.6
## 2  Physical sciences                174              135                 39           35         26            9                20.1              19.3                23.1
## 3            Physics                 76               67                  9           20         18            2                26.3              26.9                22.2
## 4         Humanities                396              230                166           65         33           32                16.4              14.3                19.3
## 5 Technical sciences                251              189                 62           43         30           13                17.1              15.9                21.0
## 6  Interdisciplinary                183              105                 78           29         12           17                15.8              11.4                21.8</code></pre>
<p>We can see that the objects are identical:</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="section-3-overview.html#cb463-1" aria-hidden="true"></a><span class="kw">identical</span>(research_funding_rates, new_research_funding_rates)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="recoding" class="section level2" number="4.18">
<h2><span class="header-section-number">4.18</span> Recoding</h2>
<p>The textbook for this section is available <a href="https://rafalab.github.io/dsbook/string-processing.html#recode" target="_blank">here</a>.</p>
<p><strong>Key points</strong></p>
<ul>
<li>Change long factor names with the <code>recode()</code> function from the <strong>tidyverse</strong>.</li>
<li>Other similar functions include <code>recode_factor()</code> and <code>fct_recoder()</code> in the <strong>forcats</strong> package in the <strong>tidyverse</strong>. The same result could be obtained using the <code>case_when()</code> function, but <code>recode()</code> is more efficient to write.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="section-3-overview.html#cb465-1" aria-hidden="true"></a><span class="co"># life expectancy time series for Caribbean countries</span></span>
<span id="cb465-2"><a href="section-3-overview.html#cb465-2" aria-hidden="true"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb465-3"><a href="section-3-overview.html#cb465-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(region<span class="op">==</span><span class="st">&quot;Caribbean&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb465-4"><a href="section-3-overview.html#cb465-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, life_expectancy, <span class="dt">color =</span> country)) <span class="op">+</span></span>
<span id="cb465-5"><a href="section-3-overview.html#cb465-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-164-1.png" width="672" /></p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="section-3-overview.html#cb466-1" aria-hidden="true"></a><span class="co"># display long country names</span></span>
<span id="cb466-2"><a href="section-3-overview.html#cb466-2" aria-hidden="true"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb466-3"><a href="section-3-overview.html#cb466-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(region<span class="op">==</span><span class="st">&quot;Caribbean&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb466-4"><a href="section-3-overview.html#cb466-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_length</span>(country) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">12</span>) <span class="op">%&gt;%</span></span>
<span id="cb466-5"><a href="section-3-overview.html#cb466-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">distinct</span>(country) </span></code></pre></div>
<pre><code>##                          country
## 1            Antigua and Barbuda
## 2             Dominican Republic
## 3 St. Vincent and the Grenadines
## 4            Trinidad and Tobago</code></pre>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="section-3-overview.html#cb468-1" aria-hidden="true"></a><span class="co"># recode long country names and remake plot</span></span>
<span id="cb468-2"><a href="section-3-overview.html#cb468-2" aria-hidden="true"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(region<span class="op">==</span><span class="st">&quot;Caribbean&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb468-3"><a href="section-3-overview.html#cb468-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">recode</span>(country, </span>
<span id="cb468-4"><a href="section-3-overview.html#cb468-4" aria-hidden="true"></a>                          <span class="st">&#39;Antigua and Barbuda&#39;</span>=<span class="st">&quot;Barbuda&quot;</span>,</span>
<span id="cb468-5"><a href="section-3-overview.html#cb468-5" aria-hidden="true"></a>                          <span class="st">&#39;Dominican Republic&#39;</span> =<span class="st"> &quot;DR&quot;</span>,</span>
<span id="cb468-6"><a href="section-3-overview.html#cb468-6" aria-hidden="true"></a>                          <span class="st">&#39;St. Vincent and the Grenadines&#39;</span> =<span class="st"> &quot;St. Vincent&quot;</span>,</span>
<span id="cb468-7"><a href="section-3-overview.html#cb468-7" aria-hidden="true"></a>                          <span class="st">&#39;Trinidad and Tobago&#39;</span> =<span class="st"> &quot;Trinidad&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb468-8"><a href="section-3-overview.html#cb468-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, life_expectancy, <span class="dt">color =</span> country)) <span class="op">+</span></span>
<span id="cb468-9"><a href="section-3-overview.html#cb468-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-164-2.png" width="672" /></p>
</div>
<div id="assessment---string-processing-part-3" class="section level2" number="4.19">
<h2><span class="header-section-number">4.19</span> Assessment - String Processing Part 3</h2>
<p>Want even more practice with regular expressions? Complete the lessons and exercises in the <a href="https://regexone.com" target="_blank">RegexOne</a> online interactive tutorial!</p>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="section-3-overview.html#cb469-1" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&#39;10&quot;</span>, <span class="st">&quot;6&#39;1</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;5&#39;8inches&quot;</span>, <span class="st">&quot;5&#39;7.5&quot;</span>)</span>
<span id="cb469-2"><a href="section-3-overview.html#cb469-2" aria-hidden="true"></a>tab &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> s)</span></code></pre></div>
<p>If you use the extract code from our video, the decimal point is dropped. What modification of the code would allow you to put the decimals in a third column called “decimal”?</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="section-3-overview.html#cb470-1" aria-hidden="true"></a><span class="kw">extract</span>(<span class="dt">data =</span> tab, <span class="dt">col =</span> x, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>, <span class="st">&quot;decimal&quot;</span>), </span>
<span id="cb470-2"><a href="section-3-overview.html#cb470-2" aria-hidden="true"></a><span class="dt">regex =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">d)&#39;(</span><span class="ch">\\</span><span class="st">d{1,2})(</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">d+)?&quot;</span>)  </span></code></pre></div>
<pre><code>##   feet inches decimal
## 1    5     10        
## 2    6      1        
## 3    5      8        
## 4    5      7      .5</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A.</li>
</ul>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="section-3-overview.html#cb472-1" aria-hidden="true"></a><span class="kw">extract</span>(<span class="dt">data =</span> tab, <span class="dt">col =</span> x, <span class="dt">into =</span> <span class="kw">c</span>(“feet”, “inches”, “decimal”), <span class="dt">regex =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">d)&#39;(</span><span class="ch">\\</span><span class="st">d{1,2})(</span><span class="ch">\\</span><span class="st">.)?&quot;</span></span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
B.</li>
</ul>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="section-3-overview.html#cb473-1" aria-hidden="true"></a><span class="kw">extract</span>(<span class="dt">data =</span> tab, <span class="dt">col =</span> x, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>, <span class="st">&quot;decimal&quot;</span>), <span class="dt">regex =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">d)&#39;(</span><span class="ch">\\</span><span class="st">d{1,2})(</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">d+)&quot;</span> </span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
C.</li>
</ul>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="section-3-overview.html#cb474-1" aria-hidden="true"></a><span class="kw">extract</span>(<span class="dt">data =</span> tab, <span class="dt">col =</span> x, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>, <span class="st">&quot;decimal&quot;</span>), <span class="dt">regex =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">d)&#39;(</span><span class="ch">\\</span><span class="st">d{1,2})</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">d+?&quot;</span></span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
D.</li>
</ul>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="section-3-overview.html#cb475-1" aria-hidden="true"></a><span class="kw">extract</span>(<span class="dt">data =</span> tab, <span class="dt">col =</span> x, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>, <span class="st">&quot;decimal&quot;</span>), <span class="dt">regex =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">d)&#39;(</span><span class="ch">\\</span><span class="st">d{1,2})(</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">d+)?&quot;</span>)  </span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>You have the following table, <code>schedule</code></li>
</ol>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="section-3-overview.html#cb476-1" aria-hidden="true"></a><span class="op">&gt;</span>schedule</span>
<span id="cb476-2"><a href="section-3-overview.html#cb476-2" aria-hidden="true"></a>day         staff</span>
<span id="cb476-3"><a href="section-3-overview.html#cb476-3" aria-hidden="true"></a>Monday      Mandy, Chris and Laura</span>
<span id="cb476-4"><a href="section-3-overview.html#cb476-4" aria-hidden="true"></a>Tuesday     Steve, Ruth and Frank</span></code></pre></div>
<p>You want to turn this into a more useful data frame.</p>
<p>Which two commands would properly split the text in the “staff” column into each individual name? Select ALL that apply.</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. <code>str_split(schedule$staff, ",|and")</code></li>
<li><input type="checkbox" disabled="" checked="" />
B. <code>str_split(schedule$staff, ", | and ")</code></li>
<li><input type="checkbox" disabled="" checked="" />
C. <code>str_split(schedule$staff, ",\\s|\\sand\\s")</code></li>
<li><input type="checkbox" disabled="" />
D. <code>str_split(schedule$staff, "\\s?(,|and)\\s?")</code></li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>You have the following table, <code>schedule</code></li>
</ol>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="section-3-overview.html#cb477-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>schedule</span>
<span id="cb477-2"><a href="section-3-overview.html#cb477-2" aria-hidden="true"></a>day         staff</span>
<span id="cb477-3"><a href="section-3-overview.html#cb477-3" aria-hidden="true"></a>Monday      Mandy, Chris and Laura</span>
<span id="cb477-4"><a href="section-3-overview.html#cb477-4" aria-hidden="true"></a>Tuesday     Steve, Ruth and Frank</span></code></pre></div>
<p>What code would successfully turn your “Schedule” table into the following tidy table</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="section-3-overview.html#cb478-1" aria-hidden="true"></a><span class="op">&lt;</span><span class="st"> </span>tidy</span>
<span id="cb478-2"><a href="section-3-overview.html#cb478-2" aria-hidden="true"></a>day      staff</span>
<span id="cb478-3"><a href="section-3-overview.html#cb478-3" aria-hidden="true"></a><span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>chr<span class="op">&gt;</span></span>
<span id="cb478-4"><a href="section-3-overview.html#cb478-4" aria-hidden="true"></a>Monday   Mandy</span>
<span id="cb478-5"><a href="section-3-overview.html#cb478-5" aria-hidden="true"></a>Monday   Chris</span>
<span id="cb478-6"><a href="section-3-overview.html#cb478-6" aria-hidden="true"></a>Monday   Laura</span>
<span id="cb478-7"><a href="section-3-overview.html#cb478-7" aria-hidden="true"></a>Tuesday  Steve</span>
<span id="cb478-8"><a href="section-3-overview.html#cb478-8" aria-hidden="true"></a>Tuesday  Ruth </span>
<span id="cb478-9"><a href="section-3-overview.html#cb478-9" aria-hidden="true"></a>Tuesday  Frank</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A.</li>
</ul>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="section-3-overview.html#cb479-1" aria-hidden="true"></a>tidy &lt;-<span class="st"> </span>schedule <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb479-2"><a href="section-3-overview.html#cb479-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">staff =</span> <span class="kw">str_split</span>(staff, <span class="st">&quot;, | and &quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb479-3"><a href="section-3-overview.html#cb479-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">unnest</span>()</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
B.</li>
</ul>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="section-3-overview.html#cb480-1" aria-hidden="true"></a>tidy &lt;-<span class="st"> </span><span class="kw">separate</span>(schedule, staff, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;s1&quot;</span>,<span class="st">&quot;s2&quot;</span>,<span class="st">&quot;s3&quot;</span>), <span class="dt">sep =</span> “,”) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb480-2"><a href="section-3-overview.html#cb480-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> s, <span class="dt">value =</span> staff, s1<span class="op">:</span>s3)</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
C.</li>
</ul>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="section-3-overview.html#cb481-1" aria-hidden="true"></a>tidy &lt;-<span class="st"> </span>schedule <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb481-2"><a href="section-3-overview.html#cb481-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">staff =</span> <span class="kw">str_split</span>(staff, <span class="st">&quot;, | and &quot;</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb481-3"><a href="section-3-overview.html#cb481-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">unnest</span>()</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Using the gapminder data, you want to recode countries longer than 12 letters in the region “Middle Africa” to their abbreviations in a new column, “country_short”. Which code would accomplish this?</li>
</ol>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="section-3-overview.html#cb482-1" aria-hidden="true"></a>dat &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(region <span class="op">==</span><span class="st"> &quot;Middle Africa&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb482-2"><a href="section-3-overview.html#cb482-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country_short =</span> <span class="kw">recode</span>(country, </span>
<span id="cb482-3"><a href="section-3-overview.html#cb482-3" aria-hidden="true"></a>                          <span class="st">&quot;Central African Republic&quot;</span> =<span class="st"> &quot;CAR&quot;</span>, </span>
<span id="cb482-4"><a href="section-3-overview.html#cb482-4" aria-hidden="true"></a>                          <span class="st">&quot;Congo, Dem. Rep.&quot;</span> =<span class="st"> &quot;DRC&quot;</span>,</span>
<span id="cb482-5"><a href="section-3-overview.html#cb482-5" aria-hidden="true"></a>                          <span class="st">&quot;Equatorial Guinea&quot;</span> =<span class="st"> &quot;Eq. Guinea&quot;</span>))</span>
<span id="cb482-6"><a href="section-3-overview.html#cb482-6" aria-hidden="true"></a>dat</span></code></pre></div>
<pre><code>##                      country year infant_mortality life_expectancy fertility population        gdp continent        region country_short
## 1                     Angola 1960            208.0           35.98      7.32    5270844         NA    Africa Middle Africa        Angola
## 2                   Cameroon 1960            166.9           43.46      5.65    5361367 2537944080    Africa Middle Africa      Cameroon
## 3   Central African Republic 1960            165.5           37.43      5.84    1503501  534982718    Africa Middle Africa           CAR
## 4                       Chad 1960               NA           40.95      6.25    3002596  750173439    Africa Middle Africa          Chad
## 5           Congo, Dem. Rep. 1960            174.0           43.90      6.00   15248246 4992962083    Africa Middle Africa           DRC
## 6                Congo, Rep. 1960            110.6           48.25      5.88    1013581  626127041    Africa Middle Africa   Congo, Rep.
## 7          Equatorial Guinea 1960               NA           37.69      5.51     252115         NA    Africa Middle Africa    Eq. Guinea
## 8                      Gabon 1960               NA           38.83      4.38     499189  887289809    Africa Middle Africa         Gabon
## 9                     Angola 1961               NA           36.53      7.35    5367287         NA    Africa Middle Africa        Angola
## 10                  Cameroon 1961            163.3           44.00      5.71    5474509 2785779139    Africa Middle Africa      Cameroon
## 11  Central African Republic 1961            162.9           37.89      5.87    1529229  561479896    Africa Middle Africa           CAR
## 12                      Chad 1961               NA           41.35      6.27    3061423  760658941    Africa Middle Africa          Chad
## 13          Congo, Dem. Rep. 1961               NA           44.25      6.02   15637715 4451156989    Africa Middle Africa           DRC
## 14               Congo, Rep. 1961            108.4           48.88      5.92    1039966  678538008    Africa Middle Africa   Congo, Rep.
## 15         Equatorial Guinea 1961               NA           38.04      5.52     255100         NA    Africa Middle Africa    Eq. Guinea
## 16                     Gabon 1961               NA           39.15      4.46     504174 1018309175    Africa Middle Africa         Gabon
## 17                    Angola 1962               NA           37.08      7.39    5465905         NA    Africa Middle Africa        Angola
## 18                  Cameroon 1962            160.5           44.53      5.77    5593768 2870510257    Africa Middle Africa      Cameroon
## 19  Central African Republic 1962            160.4           38.36      5.89    1556656  540628554    Africa Middle Africa           CAR
## 20                      Chad 1962               NA           41.76      6.29    3122357  801431143    Africa Middle Africa          Chad
## 21          Congo, Dem. Rep. 1962               NA           44.61      6.03   16041247 5394833319    Africa Middle Africa           DRC
## 22               Congo, Rep. 1962            106.1           49.47      5.97    1067611  713837650    Africa Middle Africa   Congo, Rep.
## 23         Equatorial Guinea 1962               NA           38.38      5.53     257940         NA    Africa Middle Africa    Eq. Guinea
## 24                     Gabon 1962               NA           39.56      4.54     509806 1094165180    Africa Middle Africa         Gabon
## 25                    Angola 1963               NA           37.63      7.41    5565808         NA    Africa Middle Africa        Angola
## 26                  Cameroon 1963            158.1           45.07      5.83    5719135 2977940547    Africa Middle Africa      Cameroon
## 27  Central African Republic 1963            157.6           38.85      5.91    1585765  536804991    Africa Middle Africa           CAR
## 28                      Chad 1963               NA           42.17      6.30    3184775  788612621    Africa Middle Africa          Chad
## 29          Congo, Dem. Rep. 1963               NA           44.98      6.05   16461914 5676119396    Africa Middle Africa           DRC
## 30               Congo, Rep. 1963            104.2           50.04      6.01    1096502  685074987    Africa Middle Africa   Congo, Rep.
## 31         Equatorial Guinea 1963               NA           38.73      5.55     260990         NA    Africa Middle Africa    Eq. Guinea
## 32                     Gabon 1963               NA           40.07      4.62     516270 1160826485    Africa Middle Africa         Gabon
## 33                    Angola 1964               NA           38.18      7.43    5665701         NA    Africa Middle Africa        Angola
## 34                  Cameroon 1964            155.5           45.59      5.89    5850454 3083572854    Africa Middle Africa      Cameroon
## 35  Central African Republic 1964            154.7           39.36      5.93    1616515  547972474    Africa Middle Africa           CAR
## 36                      Chad 1964               NA           42.58      6.32    3247798  768811034    Africa Middle Africa          Chad
## 37          Congo, Dem. Rep. 1964               NA           45.36      6.07   16903899 5537609393    Africa Middle Africa           DRC
## 38               Congo, Rep. 1964            102.1           50.55      6.06    1126602  711222903    Africa Middle Africa   Congo, Rep.
## 39         Equatorial Guinea 1964               NA           39.08      5.57     264743         NA    Africa Middle Africa    Eq. Guinea
## 40                     Gabon 1964               NA           40.70      4.69     523793 1213695790    Africa Middle Africa         Gabon
## 41                    Angola 1965               NA           38.74      7.43    5765025         NA    Africa Middle Africa        Angola
## 42                  Cameroon 1965            152.2           46.13      5.95    5987671 3146047697    Africa Middle Africa      Cameroon
## 43  Central African Republic 1965            151.7           39.92      5.94    1648830  553164891    Africa Middle Africa           CAR
## 44                      Chad 1965               NA           43.01      6.34    3310921  773471780    Africa Middle Africa          Chad
## 45          Congo, Dem. Rep. 1965               NA           45.77      6.09   17369859 5592838673    Africa Middle Africa           DRC
## 46               Congo, Rep. 1965             99.7           51.02      6.10    1157905  737370784    Africa Middle Africa   Congo, Rep.
## 47         Equatorial Guinea 1965               NA           39.44      5.60     269427         NA    Africa Middle Africa    Eq. Guinea
## 48                     Gabon 1965               NA           41.42      4.77     532512 1314837134    Africa Middle Africa         Gabon
## 49                    Angola 1966               NA           39.28      7.42    5863568         NA    Africa Middle Africa        Angola
## 50                  Cameroon 1966            148.1           46.67      6.01    6130990 3291236402    Africa Middle Africa      Cameroon
## 51  Central African Republic 1966            148.6           40.50      5.95    1682874  556732800    Africa Middle Africa           CAR
## 52                      Chad 1966               NA           43.48      6.36    3373563  759494431    Africa Middle Africa          Chad
## 53          Congo, Dem. Rep. 1966               NA           46.20      6.11   17861860 5971780635    Africa Middle Africa           DRC
## 54               Congo, Rep. 1966             97.3           51.45      6.14    1190361  747391524    Africa Middle Africa   Congo, Rep.
## 55         Equatorial Guinea 1966               NA           39.78      5.62     275470         NA    Africa Middle Africa    Eq. Guinea
## 56                     Gabon 1966               NA           42.21      4.83     542562 1374110052    Africa Middle Africa         Gabon
## 57                    Angola 1967               NA           39.84      7.40    5962831         NA    Africa Middle Africa        Angola
## 58                  Cameroon 1967            143.1           47.22      6.06    6280743 2932094527    Africa Middle Africa      Cameroon
## 59  Central African Republic 1967            145.6           41.15      5.95    1718558  582768491    Africa Middle Africa           CAR
## 60                      Chad 1967               NA           43.98      6.39    3436227  765321282    Africa Middle Africa          Chad
## 61          Congo, Dem. Rep. 1967               NA           46.66      6.14   18378189 5912914485    Africa Middle Africa           DRC
## 62               Congo, Rep. 1967             94.9           51.84      6.17    1224041  763208362    Africa Middle Africa   Congo, Rep.
## 63         Equatorial Guinea 1967               NA           40.13      5.64     282445         NA    Africa Middle Africa    Eq. Guinea
## 64                     Gabon 1967               NA           43.06      4.90     553829 1430656781    Africa Middle Africa         Gabon
## 65                    Angola 1968               NA           40.39      7.38    6066094         NA    Africa Middle Africa        Angola
## 66                  Cameroon 1968            137.3           47.79      6.11    6437157 3118174741    Africa Middle Africa      Cameroon
## 67  Central African Republic 1968            142.6           41.84      5.95    1755260  590951707    Africa Middle Africa           CAR
## 68                      Chad 1968               NA           44.54      6.43    3500778  761822089    Africa Middle Africa          Chad
## 69          Congo, Dem. Rep. 1968               NA           47.14      6.16   18913177 6169103240    Africa Middle Africa           DRC
## 70               Congo, Rep. 1968             92.7           52.21      6.21    1259190  821451282    Africa Middle Africa   Congo, Rep.
## 71         Equatorial Guinea 1968               NA           40.48      5.66     288701         NA    Africa Middle Africa    Eq. Guinea
## 72                     Gabon 1968               NA           43.90      4.96     565878 1466549111    Africa Middle Africa         Gabon
## 73                    Angola 1969               NA           40.95      7.34    6177703         NA    Africa Middle Africa        Angola
## 74                  Cameroon 1969            131.5           48.37      6.16    6600479 3271011438    Africa Middle Africa      Cameroon
## 75  Central African Republic 1969            139.8           42.57      5.95    1792150  632858495    Africa Middle Africa           CAR
## 76                      Chad 1969            137.3           45.12      6.48    3569778  814245430    Africa Middle Africa          Chad
## 77          Congo, Dem. Rep. 1969            150.7           47.63      6.19   19458874 6744608852    Africa Middle Africa           DRC
## 78               Congo, Rep. 1969             90.6           52.54      6.24    1296137  883458739    Africa Middle Africa   Congo, Rep.
## 79         Equatorial Guinea 1969               NA           40.82      5.67     292014         NA    Africa Middle Africa    Eq. Guinea
## 80                     Gabon 1969               NA           44.74      5.02     578114 1585088962    Africa Middle Africa         Gabon
## 81                    Angola 1970            180.0           41.50      7.30    6300969         NA    Africa Middle Africa        Angola
## 82                  Cameroon 1970            126.2           48.97      6.21    6770967 3372153343    Africa Middle Africa      Cameroon
## 83  Central African Republic 1970            137.0           43.36      5.95    1828710  647622869    Africa Middle Africa           CAR
## 84                      Chad 1970            135.9           45.72      6.53    3644911  829387598    Africa Middle Africa          Chad
## 85          Congo, Dem. Rep. 1970            149.0           48.13      6.21   20009902 6728080745    Africa Middle Africa           DRC
## 86               Congo, Rep. 1970             88.5           52.85      6.26    1335090  939633199    Africa Middle Africa   Congo, Rep.
## 87         Equatorial Guinea 1970               NA           41.17      5.68     290905         NA    Africa Middle Africa    Eq. Guinea
## 88                     Gabon 1970               NA           45.55      5.08     590119 1722664256    Africa Middle Africa         Gabon
## 89                    Angola 1971               NA           42.06      7.26    6437645         NA    Africa Middle Africa        Angola
## 90                  Cameroon 1971            121.6           49.59      6.25    6948847 3489494427    Africa Middle Africa      Cameroon
## 91  Central African Republic 1971            134.5           44.19      5.95    1864757  654941830    Africa Middle Africa           CAR
## 92                      Chad 1971            134.5           46.33      6.58    3727382  810746064    Africa Middle Africa          Chad
## 93          Congo, Dem. Rep. 1971            147.5           48.60      6.24   20563111 7132103209    Africa Middle Africa           DRC
## 94               Congo, Rep. 1971             86.5           53.14      6.28    1376189 1012483298    Africa Middle Africa   Congo, Rep.
## 95         Equatorial Guinea 1971               NA           41.52      5.68     284915         NA    Africa Middle Africa    Eq. Guinea
## 96                     Gabon 1971               NA           46.35      5.14     601734 1899387747    Africa Middle Africa         Gabon
## 97                    Angola 1972               NA           42.62      7.23    6587647         NA    Africa Middle Africa        Angola
## 98                  Cameroon 1972            118.2           50.22      6.29    7134374 3582798039    Africa Middle Africa      Cameroon
## 99  Central African Republic 1972            132.1           45.04      5.95    1900702  654936703    Africa Middle Africa           CAR
## 100                     Chad 1972            131.8           46.91      6.64    3816299  820066531    Africa Middle Africa          Chad
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 356 rows ]</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A.</li>
</ul>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="section-3-overview.html#cb484-1" aria-hidden="true"></a>dat &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(region <span class="op">==</span><span class="st"> &quot;Middle Africa&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb484-2"><a href="section-3-overview.html#cb484-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">recode</span>(country, </span>
<span id="cb484-3"><a href="section-3-overview.html#cb484-3" aria-hidden="true"></a>                          <span class="st">&quot;Central African Republic&quot;</span> =<span class="st"> &quot;CAR&quot;</span>, </span>
<span id="cb484-4"><a href="section-3-overview.html#cb484-4" aria-hidden="true"></a>                          <span class="st">&quot;Congo, Dem. Rep.&quot;</span> =<span class="st"> &quot;DRC&quot;</span>,</span>
<span id="cb484-5"><a href="section-3-overview.html#cb484-5" aria-hidden="true"></a>                          <span class="st">&quot;Equatorial Guinea&quot;</span> =<span class="st"> &quot;Eq. Guinea&quot;</span>))</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
B.</li>
</ul>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="section-3-overview.html#cb485-1" aria-hidden="true"></a>dat &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(region <span class="op">==</span><span class="st"> &quot;Middle Africa&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb485-2"><a href="section-3-overview.html#cb485-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country_short =</span> <span class="kw">recode</span>(country, </span>
<span id="cb485-3"><a href="section-3-overview.html#cb485-3" aria-hidden="true"></a>                          <span class="kw">c</span>(<span class="st">&quot;Central African Republic&quot;</span>, <span class="st">&quot;Congo, Dem. Rep.&quot;</span>, <span class="st">&quot;Equatorial Guinea&quot;</span>),</span>
<span id="cb485-4"><a href="section-3-overview.html#cb485-4" aria-hidden="true"></a>                          <span class="kw">c</span>(<span class="st">&quot;CAR&quot;</span>, <span class="st">&quot;DRC&quot;</span>, <span class="st">&quot;Eq. Guinea&quot;</span>)))</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
C.</li>
</ul>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="section-3-overview.html#cb486-1" aria-hidden="true"></a>dat &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(region <span class="op">==</span><span class="st"> &quot;Middle Africa&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb486-2"><a href="section-3-overview.html#cb486-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">recode</span>(country, </span>
<span id="cb486-3"><a href="section-3-overview.html#cb486-3" aria-hidden="true"></a>                          <span class="st">&quot;Central African Republic&quot;</span> =<span class="st"> &quot;CAR&quot;</span>, </span>
<span id="cb486-4"><a href="section-3-overview.html#cb486-4" aria-hidden="true"></a>                          <span class="st">&quot;Congo, Dem. Rep.&quot;</span> =<span class="st"> &quot;DRC&quot;</span>,</span>
<span id="cb486-5"><a href="section-3-overview.html#cb486-5" aria-hidden="true"></a>                          <span class="st">&quot;Equatorial Guinea&quot;</span> =<span class="st"> &quot;Eq. Guinea&quot;</span>))</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
D.</li>
</ul>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="section-3-overview.html#cb487-1" aria-hidden="true"></a>dat &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(region <span class="op">==</span><span class="st"> &quot;Middle Africa&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb487-2"><a href="section-3-overview.html#cb487-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country_short =</span> <span class="kw">recode</span>(country, </span>
<span id="cb487-3"><a href="section-3-overview.html#cb487-3" aria-hidden="true"></a>                          <span class="st">&quot;Central African Republic&quot;</span> =<span class="st"> &quot;CAR&quot;</span>, </span>
<span id="cb487-4"><a href="section-3-overview.html#cb487-4" aria-hidden="true"></a>                          <span class="st">&quot;Congo, Dem. Rep.&quot;</span> =<span class="st"> &quot;DRC&quot;</span>,</span>
<span id="cb487-5"><a href="section-3-overview.html#cb487-5" aria-hidden="true"></a>                          <span class="st">&quot;Equatorial Guinea&quot;</span> =<span class="st"> &quot;Eq. Guinea&quot;</span>))</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Import raw Brexit referendum polling data from Wikipedia:</li>
</ol>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="section-3-overview.html#cb488-1" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(stringr)) <span class="kw">install.packages</span>(<span class="st">&quot;stringr&quot;</span>)</span>
<span id="cb488-2"><a href="section-3-overview.html#cb488-2" aria-hidden="true"></a></span>
<span id="cb488-3"><a href="section-3-overview.html#cb488-3" aria-hidden="true"></a><span class="kw">library</span>(stringr)</span>
<span id="cb488-4"><a href="section-3-overview.html#cb488-4" aria-hidden="true"></a>url &lt;-<span class="st"> &quot;https://en.wikipedia.org/w/index.php?title=Opinion_polling_for_the_United_Kingdom_European_Union_membership_referendum&amp;oldid=896735054&quot;</span></span>
<span id="cb488-5"><a href="section-3-overview.html#cb488-5" aria-hidden="true"></a>tab &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;table&quot;</span>)</span>
<span id="cb488-6"><a href="section-3-overview.html#cb488-6" aria-hidden="true"></a>polls &lt;-<span class="st"> </span>tab[[<span class="dv">5</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>(<span class="dt">fill =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>You will use a variety of string processing techniques learned in this section to reformat these data.</p>
<p>Some rows in this table do not contain polls. You can identify these by the lack of the percent sign (%) in the Remain column.</p>
<p>Update <code>polls</code> by changing the column names to <code>c("dates", "remain", "leave", "undecided", "lead", "samplesize", "pollster", "poll_type", "notes")</code> and only keeping rows that have a percent sign (%) in the remain column.</p>
<p>How many rows remain in the <code>polls</code> data frame?</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="section-3-overview.html#cb489-1" aria-hidden="true"></a><span class="kw">names</span>(polls) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;dates&quot;</span>, <span class="st">&quot;remain&quot;</span>, <span class="st">&quot;leave&quot;</span>, <span class="st">&quot;undecided&quot;</span>, <span class="st">&quot;lead&quot;</span>, <span class="st">&quot;samplesize&quot;</span>, <span class="st">&quot;pollster&quot;</span>, <span class="st">&quot;poll_type&quot;</span>, <span class="st">&quot;notes&quot;</span>)</span>
<span id="cb489-2"><a href="section-3-overview.html#cb489-2" aria-hidden="true"></a>polls &lt;-<span class="st"> </span>polls[<span class="kw">str_detect</span>(polls<span class="op">$</span>remain, <span class="st">&quot;%&quot;</span>), <span class="dv">-9</span>]</span>
<span id="cb489-3"><a href="section-3-overview.html#cb489-3" aria-hidden="true"></a><span class="kw">nrow</span>(polls)</span></code></pre></div>
<pre><code>## [1] 129</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>The <code>remain</code> and <code>leave</code> columns are both given in the format “48.1%”: percentages out of 100% with a percent symbol.</li>
</ol>
<p>Which of these commands converts the <code>remain</code> vector to a proportion between 0 and 1?</p>
<p>Check all correct answers.</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. <code>as.numeric(str_remove(polls$remain, "%"))</code></li>
<li><input type="checkbox" disabled="" />
B. <code>as.numeric(polls$remain)/100</code></li>
<li><input type="checkbox" disabled="" />
C. <code>parse_number(polls$remain)</code></li>
<li><input type="checkbox" disabled="" />
D. <code>str_remove(polls$remain, "%")/100</code></li>
<li><input type="checkbox" disabled="" checked="" />
E. <code>as.numeric(str_replace(polls$remain, "%", ""))/100</code></li>
<li><input type="checkbox" disabled="" checked="" />
F. <code>parse_number(polls$remain)/100</code></li>
</ul>
<ol start="7" style="list-style-type: decimal">
<li>The <code>undecided</code> column has some “N/A” values. These “N/A”s are only present when the <code>remain</code> and <code>leave</code> columns total 100%, so they should actually be zeros.</li>
</ol>
<p>Use a function from <strong>stringr</strong> to convert “N/A” in the <code>undecided</code> column to 0. The format of your command should be <code>function_name(polls$undecided, "arg1", "arg2")</code>.</p>
<p>What function replaces <code>function_name</code>? <code>str_replace</code></p>
<p>What argument replaces <code>arg1</code>? <code>N/A</code></p>
<p>What argument replaces <code>arg2</code>? <code>0</code></p>
<ol start="8" style="list-style-type: decimal">
<li>The <code>dates</code> column contains the range of dates over which the poll was conducted. The format is “8-10 Jan” where the poll had a start date of 2016-01-08 and end date of 2016-01-10. Some polls go across month boundaries (16 May-12 June).</li>
</ol>
<p>The end date of the poll will always be one or two digits, followed by a space, followed by the month as one or more letters (either capital or lowercase). In these data, all month abbreviations or names have 3, 4 or 5 letters.</p>
<p>Write a regular expression to extract the end day and month from <code>dates</code>. Insert it into the skeleton code below:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="section-3-overview.html#cb491-1" aria-hidden="true"></a>temp &lt;-<span class="st"> </span><span class="kw">str_extract_all</span>(polls<span class="op">$</span>dates, _____)</span>
<span id="cb491-2"><a href="section-3-overview.html#cb491-2" aria-hidden="true"></a>end_date &lt;-<span class="st"> </span><span class="kw">sapply</span>(temp, <span class="cf">function</span>(x) x[<span class="kw">length</span>(x)]) <span class="co"># take last element (handles polls that cross month boundaries)</span></span></code></pre></div>
<p>Which of the following regular expressions correctly extracts the end day and month when inserted into the blank in the code above? Check all correct answers.</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. <code>"\\d?\\s[a-zA-Z]?"</code></li>
<li><input type="checkbox" disabled="" checked="" />
B. <code>"\\d+\\s[a-zA-Z]+"</code></li>
<li><input type="checkbox" disabled="" />
C. <code>"\\d+\\s[A-Z]+"</code></li>
<li><input type="checkbox" disabled="" checked="" />
D. <code>"[0-9]+\\s[a-zA-Z]+"</code></li>
<li><input type="checkbox" disabled="" checked="" />
E. <code>"\\d{1,2}\\s[a-zA-Z]+"</code></li>
<li><input type="checkbox" disabled="" />
F. <code>"\\d{1,2}[a-zA-Z]+"</code></li>
<li><input type="checkbox" disabled="" checked="" />
G. <code>"\\d+\\s[a-zA-Z]{3,5}"</code></li>
</ul>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-2-overview.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-4-overview.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
